# 多店铺扫码点餐系统 - 全流程测试指南

## 🎯 测试目标

本测试平台模拟真实的餐饮点餐场景，支持你扮演五种不同角色进行完整的点餐流程测试：

1. **👤 顾客** - 扫码点餐、浏览菜单、下单支付
2. **👨‍🍳 厨师** - 查看待制作订单、制作菜品、语音确认
3. **🤵 传菜员** - 查看待传菜品、在顾客面前确认上菜
4. **💰 收银员** - 处理支付、打印小票
5. **👔 店长** - 查看运营数据、订单管理

## 🚀 快速开始

### 1. 启动API服务

在终端运行：

```bash
cd /workspace/projects
python scripts/start_restaurant_api.py
```

服务将在 `http://localhost:8000` 启动

### 2. 打开测试页面

在浏览器中打开：`assets/restaurant_full_test.html`

或者使用本地服务器：

```bash
cd assets
python -m http.server 8080
```

然后访问：`http://localhost:8080/restaurant_full_test.html`

## 📋 完整测试流程

### 场景：你是8号桌的顾客，到店后扫码点餐

#### 步骤1：顾客角色 - 扫码选择桌号

1. 点击顶部角色切换器中的 **👤 顾客** 按钮
2. 页面会显示桌号选择界面（模拟扫码成功后的页面）
3. 点击 **8号** 桌格
4. 点击 **确认桌号** 按钮
5. 成功进入8号桌点餐页面

#### 步骤2：顾客角色 - 浏览菜单并选择菜品

1. 在分类标签中选择菜品类别（热菜、凉菜、主食、饮品）
2. 点击喜欢的菜品添加到购物车
3. 可以多次点击增加数量
4. 底部会显示购物车信息（商品数量和总金额）
5. 点击底部购物车栏查看已选商品
6. 可以调整商品数量或删除
7. 点击 **提交订单** 完成下单

#### 步骤3：顾客角色 - 选择支付方式（模拟）

订单会自动选择微信支付，并完成支付流程

#### 步骤4：切换到厨师角色

1. 点击顶部 **👨‍🍳 厨师** 按钮
2. 你会看到8号桌的订单出现在待制作列表中
3. 订单卡片显示：桌号、时间、菜品列表

#### 步骤5：厨师角色 - 开始制作菜品

1. 找到8号桌的订单
2. 对每个菜品点击 **开始制作** 按钮
3. 菜品状态变为 "制作中"（黄色标签）
4. 可以点击 **🖨️ 打印制作单** 打印厨房单据

#### 步骤6：厨师角色 - 完成菜品制作（支持语音确认）

**方法A：点击按钮**
1. 菜品制作完成后，点击 **完成制作** 按钮
2. 菜品状态变为 "已完成"（绿色标签）
3. 系统会通知传菜员

**方法B：语音确认**
1. 点击右下角的 🎤 语音按钮
2. 系统开始录音（2秒后自动结束，模拟语音识别）
3. 说出 "完成" 或 "做好"
4. 系统自动识别并标记当前制作的菜品为完成

#### 步骤7：厨师角色 - 确认所有菜品完成

1. 当所有菜品都标记为 "已完成" 后
2. 点击 **✅ 全部完成** 按钮
3. 订单状态更新为 "ready"，通知传菜员

#### 步骤8：切换到传菜员角色

1. 点击顶部 **🤵 传菜员** 按钮
2. 你会看到8号桌的订单，显示待传菜品

#### 步骤9：传菜员角色 - 打印传菜单

1. 点击 **🖨️ 打印传菜单** 按钮
2. 打印出包含所有已完成的菜品的传菜单
3. 拿着传菜单和菜品一起送到8号桌

#### 步骤10：传菜员角色 - 逐一确认上菜

1. 找到第一道已完成的菜品
2. 点击 **确认上菜** 按钮
3. 弹出确认对话框："请确认已将 [菜品名称] 上到 8号桌"
4. 走到8号桌，在顾客面前核对菜品
5. 确认无误后，点击 **确认已上菜**
6. 菜品状态变为 "已上菜"（灰色并带删除线）

**重要：** 
- 必须逐一菜品进行确认，不能一次性多道菜
- 每道菜都要在顾客面前核对并确认

#### 步骤11：传菜员角色 - 完成订单

1. 当所有菜品都确认上菜后
2. 点击 **✅ 完成订单** 按钮
3. 订单状态更新为 "completed"

#### 步骤12：切换到收银员角色（可选）

1. 点击顶部 **💰 收银员** 按钮
2. 查看支付状态
3. 点击 **🖨️ 打印小票** 打印账单小票

#### 步骤13：切换到店长角色查看数据

1. 点击顶部 **👔 店长** 按钮
2. 查看今日统计数据：
   - 今日订单数
   - 今日营收金额
   - 当前用餐桌数
   - 在线员工数
3. 查看所有订单列表
4. 查看桌位状态（8号桌应该显示"用餐中"或"空闲"）

## 🎮 高级功能测试

### 测试语音输入确认

1. 在厨师角色下，点击右下角 🎤 按钮
2. 系统会显示"正在录音..."
3. 2秒后模拟识别成功，自动完成当前制作中的菜品
4. 适用于厨师双手忙碌时快速确认

### 测试多桌同时点餐

1. 切换到顾客角色
2. 选择不同的桌号（如1号、2号、3号）
3. 分别提交订单
4. 切换到厨师角色，会看到多个桌号待制作
5. 切换到传菜员角色，会看到多个桌号待传菜

### 测试支付方式切换

1. 在顾客下单后，切换到收银员角色
2. 选择不同的支付方式：
   - 微信支付（绿色）
   - 支付宝（蓝色）
   - 银行卡
   - 现金
   - 信用卡
   - 其他

### 测试订单取消

1. 在店长角色下
2. 找到状态为"待确认"的订单
3. 点击 **取消** 按钮
4. 确认取消操作

### 测试订单详情查看

1. 在店长角色下
2. 点击任意订单的 **详情** 按钮
3. 查看完整订单信息（桌号、时间、菜品、金额、支付方式等）

## 🔍 状态流转说明

### 订单状态流转

```
pending（待确认） → confirmed（已确认） → preparing（准备中） → ready（已完成） → serving（上菜中） → completed（已完成）
                              ↓
                        cancelled（已取消）
```

### 菜品状态流转

```
pending（待制作） → preparing（制作中） → ready（已完成） → served（已上菜）
```

## 📊 系统功能说明

### 自动刷新

系统每3秒自动刷新订单数据和桌位状态，确保各角色看到的是最新信息。

### 实时通知

- 顾客下单后，厨房会收到通知
- 厨师完成菜品后，传菜员会收到通知
- 支付成功后，会显示成功通知
- 通知会自动在3秒后消失

### 数据持久化

所有订单数据存储在PostgreSQL数据库中，刷新页面数据不会丢失。

## 🛠️ 故障排查

### 问题1：看不到订单

**可能原因：** API服务未启动

**解决方法：**
```bash
cd /workspace/projects
python scripts/start_restaurant_api.py
```

### 问题2：提交订单失败

**可能原因：** 
- 桌号未选择
- 菜品库存不足
- 菜品已下架

**解决方法：**
- 确保已选择桌号
- 查看菜品库存
- 确认菜品处于上架状态

### 问题3：状态更新不生效

**可能原因：** 状态流转不符合规则

**解决方法：**
- 检查状态流转是否符合规范
- 订单状态和菜品状态有严格的流转规则
- 查看控制台错误信息

## 📝 测试检查清单

完成以下所有项表示测试通过：

- [ ] 顾客能选择桌号
- [ ] 顾客能浏览菜单并添加菜品
- [ ] 顾客能查看购物车并提交订单
- [ ] 厨师能看到待制作订单
- [ ] 厨师能开始制作菜品
- [ ] 厨师能完成菜品制作
- [ ] 厨师能使用语音确认功能
- [ ] 厨师能打印制作单
- [ ] 传菜员能看到待传菜品
- [ ] 传菜员能打印传菜单
- [ ] 传菜员能逐一确认上菜
- [ ] 传菜员能完成订单
- [ ] 收银员能查看支付状态
- [ ] 收银员能打印小票
- [ ] 店长能查看统计数据
- [ ] 店长能查看订单详情
- [ ] 店长能查看桌位状态
- [ ] 各角色切换正常
- [ ] 自动刷新功能正常
- [ ] 通知功能正常

## 🎉 测试完成

如果以上所有功能都测试通过，说明餐饮点餐系统功能完善，可以投入实际使用！

有任何问题，请及时反馈。祝测试愉快！🍽️
