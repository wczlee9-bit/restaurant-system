<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåº—é“ºæ‰«ç ç‚¹é¤ç³»ç»Ÿ - å…¨æµç¨‹æµ‹è¯•å¹³å°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus/dist/index.full.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif; background: #f0f2f5; }
        
        .role-switcher {
            position: fixed; top: 0; left: 0; right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .role-switcher h1 { color: white; font-size: 20px; margin: 0; }
        .role-buttons { display: flex; gap: 10px; }
        .role-btn {
            padding: 8px 16px; border: 2px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.1); color: white; border-radius: 20px;
            cursor: pointer; transition: all 0.3s; font-size: 14px;
        }
        .role-btn:hover, .role-btn.active {
            background: white; color: #667eea; transform: scale(1.05);
        }
        
        .main-container { padding: 80px 20px 20px; max-width: 1400px; margin: 0 auto; }
        
        .customer-mobile {
            max-width: 375px; margin: 0 auto; background: white;
            border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .mobile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; text-align: center;
        }
        .mobile-header h2 { font-size: 22px; margin-bottom: 5px; }
        .mobile-header p { font-size: 14px; opacity: 0.9; }
        .mobile-body { padding: 15px; }
        
        .category-tabs {
            display: flex; gap: 10px; overflow-x: auto; padding: 10px 0;
            border-bottom: 1px solid #eee; margin-bottom: 15px;
        }
        .category-tab {
            padding: 8px 16px; border-radius: 20px; white-space: nowrap;
            cursor: pointer; transition: all 0.3s; font-size: 14px;
            border: 1px solid #eee; background: white;
        }
        .category-tab.active { background: #667eea; color: white; border-color: #667eea; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .menu-card {
            border: 1px solid #eee; border-radius: 10px; overflow: hidden;
            transition: all 0.3s; background: white;
        }
        .menu-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .menu-card img { width: 100%; height: 80px; object-fit: cover; }
        .menu-card-body { padding: 10px; }
        .menu-card-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .menu-card-price { color: #f56c6c; font-size: 16px; font-weight: bold; }
        .menu-card-stock { font-size: 12px; color: #909399; }
        
        .cart-bar {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 375px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; cursor: pointer; border-radius: 10px 10px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        }
        
        .kitchen-display {
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .kitchen-card {
            border: 2px solid #eee; border-radius: 12px; padding: 20px;
            margin-bottom: 20px; transition: all 0.3s;
        }
        .kitchen-card.urgent { border-color: #f56c6c; background: #fef0f0; }
        .kitchen-card.normal { border-color: #67c23a; background: #f0f9eb; }
        .kitchen-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .kitchen-table { font-size: 24px; font-weight: bold; color: #667eea; }
        .kitchen-time { color: #909399; font-size: 14px; }
        
        .kitchen-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; margin: 8px 0; background: white; border-radius: 8px;
            border-left: 4px solid #67c23a;
        }
        .kitchen-item.preparing { border-left-color: #e6a23c; }
        .kitchen-item.ready { border-left-color: #67c23a; background: #f0f9eb; }
        .kitchen-item.done { border-left-color: #909399; opacity: 0.6; }
        
        .waiter-display {
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .waiter-card {
            border: 2px solid #409eff; border-radius: 12px; padding: 20px;
            margin-bottom: 20px; background: #ecf5ff;
        }
        .waiter-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; margin: 8px 0; background: white; border-radius: 8px;
        }
        .waiter-item.served { background: #f0f9eb; opacity: 0.5; text-decoration: line-through; }
        
        .cashier-display {
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .payment-methods { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .payment-method {
            padding: 20px; border: 2px solid #eee; border-radius: 10px;
            text-align: center; cursor: pointer; transition: all 0.3s;
        }
        .payment-method:hover, .payment-method.selected {
            border-color: #667eea; background: #ecf5ff;
        }
        .payment-icon { font-size: 32px; margin-bottom: 10px; }
        
        .manager-dashboard {
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .stat-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card {
            padding: 20px; border-radius: 10px; text-align: center;
            color: white; font-weight: bold;
        }
        .stat-card.blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-card.orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-number { font-size: 32px; margin-bottom: 5px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
        
        .voice-btn {
            position: fixed; bottom: 100px; right: 30px;
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; font-size: 28px; cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s; z-index: 100;
        }
        .voice-btn:hover { transform: scale(1.1); }
        .voice-btn.recording { animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        .notification {
            position: fixed; top: 80px; right: 20px;
            padding: 15px 25px; border-radius: 10px; color: white;
            font-weight: bold; z-index: 9999; animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .tag { padding: 4px 10px; border-radius: 4px; font-size: 12px; }
        .tag-pending { background: #f0f9eb; color: #67c23a; }
        .tag-preparing { background: #fdf6ec; color: #e6a23c; }
        .tag-ready { background: #ecf5ff; color: #409eff; }
        .tag-served { background: #fef0f0; color: #f56c6c; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); display: flex; align-items: center;
            justify-content: center; z-index: 2000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 15px;
            max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;
        }
        
        .table-selector {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;
        }
        .table-cell {
            padding: 25px; text-align: center; border: 3px solid #eee;
            border-radius: 10px; cursor: pointer; transition: all 0.3s;
            font-size: 24px; font-weight: bold;
        }
        .table-cell:hover { border-color: #667eea; transform: translateY(-3px); }
        .table-cell.selected { border-color: #667eea; background: #ecf5ff; }
        .table-cell.occupied { border-color: #f56c6c; background: #fef0f0; }
        
        .order-status-bar {
            height: 4px; background: #eee; border-radius: 2px; margin-top: 15px;
            overflow: hidden;
        }
        .order-status-progress {
            height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- è§’è‰²åˆ‡æ¢å™¨ -->
        <div class="role-switcher">
            <h1>ğŸ½ï¸ é¤é¥®ç‚¹é¤ç³»ç»Ÿ - æµ‹è¯•å¹³å°</h1>
            <div class="role-buttons">
                <button class="role-btn" :class="{active: currentRole === 'customer'}" @click="switchRole('customer')">
                    ğŸ‘¤ é¡¾å®¢
                </button>
                <button class="role-btn" :class="{active: currentRole === 'kitchen'}" @click="switchRole('kitchen')">
                    ğŸ‘¨â€ğŸ³ å¨å¸ˆ
                </button>
                <button class="role-btn" :class="{active: currentRole === 'waiter'}" @click="switchRole('waiter')">
                    ğŸ¤µ ä¼ èœå‘˜
                </button>
                <button class="role-btn" :class="{active: currentRole === 'cashier'}" @click="switchRole('cashier')">
                    ğŸ’° æ”¶é“¶å‘˜
                </button>
                <button class="role-btn" :class="{active: currentRole === 'manager'}" @click="switchRole('manager')">
                    ğŸ‘” åº—é•¿
                </button>
            </div>
        </div>

        <div class="main-container">
            <!-- é¡¾å®¢ç«¯ -->
            <div v-if="currentRole === 'customer'" class="customer-mobile">
                <div class="mobile-header">
                    <h2>ğŸ½ï¸ ç¾å‘³é¤å…</h2>
                    <p v-if="selectedTable">å½“å‰æ¡Œå·: {{ selectedTable.table_number }}</p>
                    <p v-else>è¯·é€‰æ‹©æ¡Œå·</p>
                </div>
                <div class="mobile-body">
                    <!-- æ¡Œå·é€‰æ‹© -->
                    <div v-if="!selectedTable" style="text-align: center; padding: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ“± æ‰«ç æˆåŠŸï¼è¯·é€‰æ‹©æ¡Œå·</h3>
                        <div class="table-selector">
                            <div v-for="table in tables" :key="table.id"
                                 class="table-cell"
                                 :class="{selected: tempTableId === table.id, occupied: table.is_occupied}"
                                 @click="selectTable(table)">
                                {{ table.table_number }}å·
                            </div>
                        </div>
                        <el-button type="primary" size="large" style="width: 100%; margin-top: 20px;"
                                   :disabled="!tempTableId" @click="confirmTable()">
                            ç¡®è®¤æ¡Œå·
                        </el-button>
                    </div>

                    <!-- èœå•å’Œè´­ç‰©è½¦ -->
                    <div v-else>
                        <!-- åˆ†ç±»æ ‡ç­¾ -->
                        <div class="category-tabs">
                            <div class="category-tab" :class="{active: selectedCategory === null}"
                                 @click="selectedCategory = null">å…¨éƒ¨</div>
                            <div v-for="cat in categories" :key="cat.id"
                                 class="category-tab"
                                 :class="{active: selectedCategory === cat.id}"
                                 @click="selectedCategory = cat.id">
                                {{ cat.name }}
                            </div>
                        </div>

                        <!-- èœå“åˆ—è¡¨ -->
                        <div class="menu-grid">
                            <div v-for="item in filteredMenuItems" :key="item.id" class="menu-card"
                                 @click="addToCart(item)">
                                <img :src="item.image_url || 'https://via.placeholder.com/150'" alt="">
                                <div class="menu-card-body">
                                    <div class="menu-card-title">{{ item.name }}</div>
                                    <div class="menu-card-price">Â¥{{ item.price }}</div>
                                    <div class="menu-card-stock">åº“å­˜: {{ item.stock }}</div>
                                </div>
                            </div>
                        </div>

                        <!-- è´­ç‰©è½¦æ  -->
                        <div class="cart-bar" v-if="cart.length > 0" @click="showCart = true">
                            <div>
                                <span style="font-size: 18px; font-weight: bold;">{{ cart.length }}ä»¶å•†å“</span>
                                <span style="margin-left: 10px;">Â¥{{ cartTotal }}</span>
                            </div>
                            <div>å»ç»“ç®— â†’</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¨å¸ˆç«¯ -->
            <div v-if="currentRole === 'kitchen'" class="kitchen-display">
                <h2 style="margin-bottom: 20px;">ğŸ‘¨â€ğŸ³ å¨æˆ¿åˆ¶ä½œä¸­å¿ƒ</h2>
                <div v-if="kitchenOrders.length === 0" style="text-align: center; padding: 60px; color: #909399;">
                    <div style="font-size: 64px;">ğŸ³</div>
                    <p style="margin-top: 20px; font-size: 18px;">æš‚æ— å¾…åˆ¶ä½œè®¢å•</p>
                </div>
                <div v-else>
                    <div v-for="order in kitchenOrders" :key="order.id"
                         class="kitchen-card"
                         :class="{urgent: isUrgent(order), normal: !isUrgent(order)}">
                        <div class="kitchen-header">
                            <span class="kitchen-table">{{ order.table_number }}å·æ¡Œ</span>
                            <span class="kitchen-time">{{ formatTime(order.created_at) }}</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <el-tag type="info">è®¢å•å·: {{ order.id }}</el-tag>
                            <el-tag type="success">å…±{{ order.items.length }}é“èœ</el-tag>
                        </div>
                        <div v-for="item in order.items" :key="item.id" class="kitchen-item"
                             :class="getItemClass(item)">
                            <div>
                                <div style="font-weight: bold; font-size: 16px;">{{ item.menu_item_name }}</div>
                                <div style="font-size: 14px; color: #909399; margin-top: 5px;">
                                    æ•°é‡: {{ item.quantity }}
                                    <span v-if="item.special_instructions" style="margin-left: 10px; color: #e6a23c;">
                                        å¤‡æ³¨: {{ item.special_instructions }}
                                    </span>
                                </div>
                            </div>
                            <div>
                                <el-tag :type="getItemStatusType(item)" size="large">
                                    {{ getItemStatusText(item) }}
                                </el-tag>
                                <el-button v-if="item.item_status === 'pending' || item.item_status === 'preparing'"
                                           type="primary" size="small"
                                           style="margin-left: 10px;"
                                           @click="startCooking(order.id, item.id)">
                                    å¼€å§‹åˆ¶ä½œ
                                </el-button>
                                <el-button v-if="item.item_status === 'preparing'"
                                           type="success" size="small"
                                           style="margin-left: 10px;"
                                           @click="finishCooking(order.id, item.id)">
                                    å®Œæˆåˆ¶ä½œ
                                </el-button>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <el-button type="primary" @click="printKitchenOrder(order)">
                                ğŸ–¨ï¸ æ‰“å°åˆ¶ä½œå•
                            </el-button>
                            <el-button type="success" @click="markOrderReady(order.id)"
                                       v-if="allItemsReady(order)">
                                âœ… å…¨éƒ¨å®Œæˆ
                            </el-button>
                        </div>
                    </div>
                </div>

                <!-- è¯­éŸ³ç¡®è®¤æŒ‰é’® -->
                <button class="voice-btn" :class="{recording: isRecording}"
                        @click="toggleVoiceRecording">
                    ğŸ¤
                </button>
                <div v-if="isRecording" style="position: fixed; bottom: 170px; right: 30px;
                                           background: white; padding: 15px 20px; border-radius: 10px;
                                           box-shadow: 0 4px 20px rgba(0,0,0,0.15); text-align: center;">
                    <p>æ­£åœ¨å½•éŸ³...è¯·è¯´"å®Œæˆ"æˆ–"åšå¥½"</p>
                    <div style="font-size: 12px; color: #909399; margin-top: 5px;">
                        (æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«åŠŸèƒ½)
                    </div>
                </div>
            </div>

            <!-- ä¼ èœå‘˜ç«¯ -->
            <div v-if="currentRole === 'waiter'" class="waiter-display">
                <h2 style="margin-bottom: 20px;">ğŸ¤µ ä¼ èœç®¡ç†ä¸­å¿ƒ</h2>
                <div v-if="waiterOrders.length === 0" style="text-align: center; padding: 60px; color: #909399;">
                    <div style="font-size: 64px;">ğŸ½ï¸</div>
                    <p style="margin-top: 20px; font-size: 18px;">æš‚æ— å¾…ä¼ èœå“</p>
                </div>
                <div v-else>
                    <div v-for="order in waiterOrders" :key="order.id" class="waiter-card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span style="font-size: 24px; font-weight: bold;">{{ order.table_number }}å·æ¡Œ</span>
                            <el-tag type="info">{{ formatTime(order.created_at) }}</el-tag>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <el-button type="primary" @click="printServingOrder(order)">
                                ğŸ–¨ï¸ æ‰“å°ä¼ èœå•
                            </el-button>
                        </div>
                        <p style="margin-bottom: 10px; font-weight: bold;">å¾…ä¼ èœå“:</p>
                        <div v-for="item in order.items" :key="item.id" class="waiter-item"
                             :class="{served: item.item_status === 'served'}">
                            <div>
                                <div style="font-weight: bold;">{{ item.menu_item_name }}</div>
                                <div style="font-size: 14px; color: #909399;">æ•°é‡: {{ item.quantity }}</div>
                            </div>
                            <div>
                                <el-tag v-if="item.item_status === 'ready'" type="success">
                                    å¾…ä¼ èœ
                                </el-tag>
                                <el-tag v-else-if="item.item_status === 'served'" type="info">
                                    å·²ä¸Šèœ
                                </el-tag>
                                <el-button v-if="item.item_status === 'ready'"
                                           type="primary" size="small"
                                           @click="serveDish(order.id, item.id, order.table_number)">
                                    ç¡®è®¤ä¸Šèœ
                                </el-button>
                            </div>
                        </div>
                        <div v-if="allItemsServed(order)" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <el-tag type="success">å…¨éƒ¨èœå“å·²ä¸Šå®Œ</el-tag>
                            <el-button type="success" style="margin-left: 10px;" @click="completeOrder(order.id)">
                                å®Œæˆè®¢å•
                            </el-button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ”¶é“¶å‘˜ç«¯ -->
            <div v-if="currentRole === 'cashier'" class="cashier-display">
                <h2 style="margin-bottom: 20px;">ğŸ’° æ”¶é“¶å°</h2>
                <div v-if="cashierOrders.length === 0" style="text-align: center; padding: 60px; color: #909399;">
                    <div style="font-size: 64px;">ğŸ’µ</div>
                    <p style="margin-top: 20px; font-size: 18px;">æš‚æ— å¾…æ”¯ä»˜è®¢å•</p>
                </div>
                <div v-else>
                    <div v-for="order in cashierOrders" :key="order.id" style="border: 2px solid #eee; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <div>
                                <span style="font-size: 20px; font-weight: bold;">{{ order.table_number }}å·æ¡Œ</span>
                                <el-tag style="margin-left: 10px;">è®¢å•å·: {{ order.id }}</el-tag>
                            </div>
                            <span style="font-size: 24px; font-weight: bold; color: #f56c6c;">Â¥{{ order.total_amount }}</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <p v-for="item in order.items" :key="item.id" style="padding: 5px 0;">
                                {{ item.menu_item_name }} Ã— {{ item.quantity }} = Â¥{{ item.subtotal }}
                            </p>
                        </div>
                        <div v-if="order.payment_method === 'pending' || !order.payment_method || order.payment_method === 'unpaid'">
                            <p style="margin-bottom: 10px; font-weight: bold;">è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼:</p>
                            <div class="payment-methods">
                                <div class="payment-method" :class="{selected: selectedPaymentMethod === 'wechat'}"
                                     @click="selectedPaymentMethod = 'wechat'">
                                    <div class="payment-icon">ğŸ’š</div>
                                    <div>å¾®ä¿¡æ”¯ä»˜</div>
                                </div>
                                <div class="payment-method" :class="{selected: selectedPaymentMethod === 'alipay'}"
                                     @click="selectedPaymentMethod = 'alipay'">
                                    <div class="payment-icon">ğŸ’™</div>
                                    <div>æ”¯ä»˜å®</div>
                                </div>
                                <div class="payment-method" :class="{selected: selectedPaymentMethod === 'card'}"
                                     @click="selectedPaymentMethod = 'card'">
                                    <div class="payment-icon">ğŸ’³</div>
                                    <div>é“¶è¡Œå¡</div>
                                </div>
                                <div class="payment-method" :class="{selected: selectedPaymentMethod === 'cash'}"
                                     @click="selectedPaymentMethod = 'cash'">
                                    <div class="payment-icon">ğŸ’°</div>
                                    <div>ç°é‡‘</div>
                                </div>
                                <div class="payment-method" :class="{selected: selectedPaymentMethod === 'credit'}"
                                     @click="selectedPaymentMethod = 'credit'">
                                    <div class="payment-icon">ğŸ’</div>
                                    <div>ä¿¡ç”¨å¡</div>
                                </div>
                                <div class="payment-method" :class="{selected: selectedPaymentMethod === 'other'}"
                                     @click="selectedPaymentMethod = 'other'">
                                    <div class="payment-icon">ğŸ“</div>
                                    <div>å…¶ä»–</div>
                                </div>
                            </div>
                            <el-button type="primary" size="large" style="width: 100%; margin-top: 20px;"
                                       :disabled="!selectedPaymentMethod"
                                       @click="processPayment(order.id)">
                                ç¡®è®¤æ”¯ä»˜
                            </el-button>
                        </div>
                        <div v-else>
                            <el-tag type="success">å·²æ”¯ä»˜ - {{ getPaymentMethodText(order.payment_method) }}</el-tag>
                            <el-button type="success" style="margin-left: 10px;" @click="printReceipt(order)">
                                ğŸ–¨ï¸ æ‰“å°å°ç¥¨
                            </el-button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åº—é•¿ç«¯ -->
            <div v-if="currentRole === 'manager'" class="manager-dashboard">
                <h2 style="margin-bottom: 20px;">ğŸ‘” åº—é•¿ç®¡ç†åå°</h2>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stat-cards">
                    <div class="stat-card blue">
                        <div class="stat-number">{{ stats.totalOrders }}</div>
                        <div class="stat-label">ä»Šæ—¥è®¢å•</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-number">Â¥{{ stats.totalRevenue }}</div>
                        <div class="stat-label">ä»Šæ—¥è¥æ”¶</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-number">{{ stats.activeTables }}</div>
                        <div class="stat-label">ç”¨é¤æ¡Œæ•°</div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-number">{{ stats.staffCount }}</div>
                        <div class="stat-label">åœ¨çº¿å‘˜å·¥</div>
                    </div>
                </div>

                <!-- è®¢å•åˆ—è¡¨ -->
                <h3 style="margin-bottom: 15px;">æ‰€æœ‰è®¢å•</h3>
                <el-table :data="allOrders" style="width: 100%" stripe>
                    <el-table-column prop="id" label="è®¢å•å·" width="80"></el-table-column>
                    <el-table-column prop="table_number" label="æ¡Œå·" width="80"></el-table-column>
                    <el-table-column prop="total_amount" label="é‡‘é¢" width="100">
                        <template #default="scope">
                            Â¥{{ scope.row.total_amount }}
                        </template>
                    </el-table-column>
                    <el-table-column prop="status" label="çŠ¶æ€" width="100">
                        <template #default="scope">
                            <el-tag :type="getOrderStatusType(scope.row.status)">
                                {{ getOrderStatusText(scope.row.status) }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="payment_method" label="æ”¯ä»˜æ–¹å¼" width="100">
                        <template #default="scope">
                            {{ getPaymentMethodText(scope.row.payment_method) }}
                        </template>
                    </el-table-column>
                    <el-table-column prop="created_at" label="ä¸‹å•æ—¶é—´" width="180">
                        <template #default="scope">
                            {{ formatTime(scope.row.created_at) }}
                        </template>
                    </el-table-column>
                    <el-table-column label="æ“ä½œ" width="150">
                        <template #default="scope">
                            <el-button size="small" @click="viewOrderDetail(scope.row)">è¯¦æƒ…</el-button>
                            <el-button size="small" type="danger" @click="cancelOrder(scope.row.id)"
                                       v-if="scope.row.status === 'pending'">
                                å–æ¶ˆ
                            </el-button>
                        </template>
                    </el-table-column>
                </el-table>

                <!-- æ¡Œä½çŠ¶æ€ -->
                <h3 style="margin: 30px 0 15px;">æ¡Œä½çŠ¶æ€</h3>
                <div class="table-selector">
                    <div v-for="table in tables" :key="table.id" class="table-cell"
                         :class="{occupied: table.is_occupied}">
                        {{ table.table_number }}å·
                        <div style="font-size: 12px; font-weight: normal; margin-top: 5px;">
                            {{ table.is_occupied ? 'ç”¨é¤ä¸­' : 'ç©ºé—²' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è´­ç‰©è½¦å¼¹çª— - æ­¥éª¤1ï¼šç¡®è®¤è®¢å• -->
        <div v-if="showCart" class="modal-overlay" @click.self="showCart = false">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px;">ğŸ›’ è´­ç‰©è½¦</h3>
                <div v-for="(item, index) in cart" :key="index" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee;">
                    <div>
                        <div style="font-weight: bold;">{{ item.name }}</div>
                        <div style="color: #f56c6c; font-weight: bold;">Â¥{{ item.price }}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <el-button size="small" @click="updateCartItem(index, -1)">-</el-button>
                        <span>{{ item.quantity }}</span>
                        <el-button size="small" @click="updateCartItem(index, 1)">+</el-button>
                    </div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #eee;">
                    <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold;">
                        <span>åˆè®¡:</span>
                        <span style="color: #f56c6c;">Â¥{{ cartTotal }}</span>
                    </div>
                </div>
                <el-button type="primary" size="large" style="width: 100%; margin-top: 20px;"
                           @click="showPaymentSelection = true; showCart = false;">
                    ç¡®è®¤è®¢å•
                </el-button>
            </div>
        </div>

        <!-- æ”¯ä»˜æ–¹å¼é€‰æ‹©å¼¹çª— -->
        <div v-if="showPaymentSelection" class="modal-overlay" @click.self="showPaymentSelection = false">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px;">ğŸ’³ é€‰æ‹©æ”¯ä»˜æ–¹å¼</h3>
                <div style="margin-bottom: 20px;">
                    <el-radio v-model="selectedPaymentMethod" label="immediate" style="display: block; margin-bottom: 15px; padding: 15px; background: #f5f7fa; border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong style="font-size: 16px;">ğŸ’³ é©¬ä¸Šä»˜æ¬¾</strong>
                                <div style="font-size: 12px; color: #666; margin-top: 4px;">åœ¨çº¿æ”¯ä»˜ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰</div>
                            </div>
                            <span style="color: #67c23a; font-size: 14px; font-weight: bold;">ç«‹å³ç»“ç®—</span>
                        </div>
                    </el-radio>
                    <el-radio v-model="selectedPaymentMethod" label="counter" style="display: block; padding: 15px; background: #f5f7fa; border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong style="font-size: 16px;">ğŸª é¤åä»˜æ¬¾</strong>
                                <div style="font-size: 12px; color: #666; margin-top: 4px;">å…ˆç”¨é¤ï¼Œç¦»åº—æ—¶åˆ°æ”¶é“¶å°æ”¯ä»˜</div>
                            </div>
                            <span style="color: #e6a23c; font-size: 14px; font-weight: bold;">çµæ´»ä¾¿æ·</span>
                        </div>
                    </el-radio>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <el-button size="large" style="flex: 1;" @click="showPaymentSelection = false">è¿”å›</el-button>
                    <el-button type="primary" size="large" style="flex: 1;"
                               :disabled="!selectedPaymentMethod"
                               @click="submitOrder()">
                        {{ selectedPaymentMethod === 'immediate' ? 'é©¬ä¸Šä»˜æ¬¾' : 'é¤åä»˜æ¬¾' }}
                    </el-button>
                </div>
            </div>
        </div>

        <!-- ä¸Šèœç¡®è®¤å¼¹çª— -->
        <div v-if="showServingConfirm" class="modal-overlay" @click.self="showServingConfirm = false">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px;">ğŸ½ï¸ ä¸Šèœç¡®è®¤</h3>
                <p style="margin-bottom: 15px; font-size: 16px;">
                    è¯·ç¡®è®¤å·²å°† <strong>{{ servingItem?.menu_item_name }}</strong> ä¸Šåˆ° <strong>{{ servingTable }}å·æ¡Œ</strong>
                </p>
                <p style="color: #909399; font-size: 14px; margin-bottom: 20px;">
                    âš ï¸ è¯·åœ¨é¡¾å®¢é¢å‰ç¡®è®¤èœå“æ— è¯¯åç‚¹å‡»ç¡®è®¤
                </p>
                <el-button type="primary" size="large" style="width: 100%;" @click="confirmServing()">
                    ç¡®è®¤å·²ä¸Šèœ
                </el-button>
            </div>
        </div>

        <!-- é€šçŸ¥æç¤º -->
        <div v-for="notif in notifications" :key="notif.id" class="notification"
             :style="{background: notif.type === 'success' ? '#67c23a' : '#409eff', top: (80 + notif.index * 60) + 'px'}">
            {{ notif.message }}
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        const app = createApp({
            setup() {
                // çŠ¶æ€
                const currentRole = ref('customer');
                const showCart = ref(false);
                const showServingConfirm = ref(false);
                const showPaymentSelection = ref(false);
                const selectedCategory = ref(null);
                const selectedTable = ref(null);
                const tempTableId = ref(null);
                const selectedPaymentMethod = ref(null);
                const servingItem = ref(null);
                const servingOrderId = ref(null);
                const servingTable = ref(null);
                const isRecording = ref(false);
                const notifications = ref([]);
                let notificationId = 0;
                let autoRefreshInterval = null;

                // æ•°æ®
                const tables = ref([]);
                const categories = ref([]);
                const menuItems = ref([]);
                const cart = ref([]);
                const orders = ref([]);
                const currentOrder = ref(null);

                // APIåŸºç¡€URL - è‡ªåŠ¨æ£€æµ‹
                let API_BASE = '';
                try {
                    const currentHost = window.location.hostname;
                    const currentPort = window.location.port;
                    // åªåœ¨æœ¬åœ°å¼€å‘æ—¶æ£€æµ‹ç«¯å£
                    if (currentPort && currentPort !== '80') {
                        API_BASE = ''; // ä½¿ç”¨ç›¸å¯¹è·¯å¾„
                    }
                    console.log('ä½¿ç”¨ç›¸å¯¹è·¯å¾„è®¿é—®API');
                } catch (e) {
                    console.log('ä½¿ç”¨ç›¸å¯¹è·¯å¾„è®¿é—®API');
                }

                // åˆå§‹åŒ–
                onMounted(() => {
                    // ä»URLå‚æ•°è¯»å–æ¡Œå·ï¼ˆæ”¯æŒå¤šç§å‚æ•°åï¼štableã€table_numberã€table_idï¼‰
                    const urlParams = new URLSearchParams(window.location.search);
                    let tableParam = urlParams.get('table') || urlParams.get('table_number') || urlParams.get('table_id');

                    loadData().then(() => {
                        // å¦‚æœURLä¸­æœ‰æ¡Œå·å‚æ•°ï¼Œè‡ªåŠ¨é€‰æ‹©è¯¥æ¡Œå·
                        if (tableParam) {
                            // å°è¯•å¤šç§åŒ¹é…æ–¹å¼ï¼šç²¾ç¡®åŒ¹é…ã€æ•°å­—åŒ¹é…ã€Tå‰ç¼€åŒ¹é…
                            let table = tables.value.find(t => t.table_number === tableParam);

                            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°è¯•å»æ‰Tå‰ç¼€åçš„æ•°å­—åŒ¹é…
                            if (!table && tableParam.toLowerCase().startsWith('t')) {
                                const numPart = tableParam.substring(1);
                                table = tables.value.find(t => t.table_number === numPart);
                            }

                            // å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°è¯•æ•°å­—åŒ¹é…ï¼ˆä¾‹å¦‚ tableParam æ˜¯ '1'ï¼ŒåŒ¹é… '1' æˆ– 'T01'ï¼‰
                            if (!table && !isNaN(tableParam)) {
                                const num = parseInt(tableParam);
                                table = tables.value.find(t =>
                                    t.table_number === num.toString() ||
                                    t.table_number === `T${num.toString().padStart(2, '0')}`
                                );
                            }

                            if (table) {
                                selectedTable.value = table;
                                ElMessage.success(`å·²è‡ªåŠ¨é€‰æ‹©${table.table_number}å·æ¡Œ`);
                            } else {
                                ElMessage.warning(`æœªæ‰¾åˆ°æ¡Œå·: ${tableParam}`);
                            }
                        }
                        startAutoRefresh();
                    });
                });

                onUnmounted(() => {
                    stopAutoRefresh();
                });

                // æ•°æ®åŠ è½½
                const loadData = async () => {
                    try {
                        await Promise.all([
                            loadTables(),
                            loadCategories(),
                            loadMenuItems(),
                            loadOrders()
                        ]);
                    } catch (error) {
                        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    }
                };

                const loadTables = async () => {
                    try {
                        const response = await axios.get(`${API_BASE}/api/tables/`);
                        tables.value = response.data;
                    } catch (error) {
                        console.error('åŠ è½½æ¡Œå·å¤±è´¥:', error);
                        // åˆ›å»ºé»˜è®¤æ¡Œå·
                        tables.value = Array.from({length: 12}, (_, i) => ({
                            id: i + 1,
                            table_number: (i + 1).toString(),
                            seats: 4,
                            is_active: true,
                            is_occupied: false
                        }));
                    }
                };

                const loadCategories = async () => {
                    try {
                        const response = await axios.get(`${API_BASE}/api/menu-categories/`);
                        categories.value = response.data;
                    } catch (error) {
                        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
                        categories.value = [
                            { id: 1, name: 'çƒ­èœ' },
                            { id: 2, name: 'å‡‰èœ' },
                            { id: 3, name: 'ä¸»é£Ÿ' },
                            { id: 4, name: 'é¥®å“' }
                        ];
                    }
                };

                const loadMenuItems = async () => {
                    try {
                        const response = await axios.get(`${API_BASE}/api/menu-items/`);
                        menuItems.value = response.data;
                    } catch (error) {
                        console.error('åŠ è½½èœå“å¤±è´¥:', error);
                        menuItems.value = [
                            { id: 1, name: 'å®«ä¿é¸¡ä¸', price: 38, stock: 100, is_available: true, category_id: 1 },
                            { id: 2, name: 'é±¼é¦™è‚‰ä¸', price: 35, stock: 100, is_available: true, category_id: 1 },
                            { id: 3, name: 'å‡‰æ‹Œé»„ç“œ', price: 18, stock: 100, is_available: true, category_id: 2 },
                            { id: 4, name: 'ç±³é¥­', price: 2, stock: 200, is_available: true, category_id: 3 },
                            { id: 5, name: 'å¯ä¹', price: 6, stock: 100, is_available: true, category_id: 4 },
                            { id: 6, name: 'é›ªç¢§', price: 6, stock: 100, is_available: true, category_id: 4 },
                            { id: 7, name: 'ç³–é†‹æ’éª¨', price: 48, stock: 80, is_available: true, category_id: 1 },
                            { id: 8, name: 'éº»å©†è±†è…', price: 28, stock: 100, is_available: true, category_id: 1 }
                        ];
                    }
                };

                const loadOrders = async () => {
                    try {
                        const response = await axios.get(`${API_BASE}/api/orders/`);
                        orders.value = response.data;
                    } catch (error) {
                        console.error('åŠ è½½è®¢å•å¤±è´¥:', error);
                    }
                };

                // è‡ªåŠ¨åˆ·æ–°
                const startAutoRefresh = () => {
                    autoRefreshInterval = setInterval(() => {
                        loadOrders();
                        loadTables();
                    }, 3000);
                };

                const stopAutoRefresh = () => {
                    if (autoRefreshInterval) {
                        clearInterval(autoRefreshInterval);
                        autoRefreshInterval = null;
                    }
                };

                // è§’è‰²åˆ‡æ¢
                const switchRole = (role) => {
                    currentRole.value = role;
                    showNotification(`åˆ‡æ¢åˆ°${getRoleName(role)}æ¨¡å¼`, 'info');
                };

                const getRoleName = (role) => {
                    const names = {
                        'customer': 'é¡¾å®¢',
                        'kitchen': 'å¨å¸ˆ',
                        'waiter': 'ä¼ èœå‘˜',
                        'cashier': 'æ”¶é“¶å‘˜',
                        'manager': 'åº—é•¿'
                    };
                    return names[role] || role;
                };

                // é¡¾å®¢ç«¯åŠŸèƒ½
                const selectTable = (table) => {
                    // å…è®¸é€‰æ‹©æ¡Œå·ï¼Œå³ä½¿è¢«å ç”¨ï¼ˆæ¨¡æ‹Ÿæ–°é¡¾å®¢åˆ°æ¥ï¼‰
                    tempTableId.value = table.id;
                    if (table.is_occupied) {
                        ElMessage.warning('è¯¥æ¡Œå½“å‰æœ‰è¿›è¡Œä¸­çš„è®¢å•ï¼Œç»§ç»­å°†åˆå¹¶è®¢å•');
                    }
                };

                const confirmTable = async () => {
                    const table = tables.value.find(t => t.id === tempTableId.value);
                    if (table) {
                        selectedTable.value = table;
                        ElMessage.success(`å·²é€‰æ‹©${table.table_number}å·æ¡Œ`);
                        // é‡æ–°åŠ è½½è®¢å•åˆ—è¡¨ï¼Œä»¥ä¾¿æ˜¾ç¤ºè¯¥æ¡Œå·çš„ç°æœ‰è®¢å•
                        await loadOrders();
                    }
                };

                const addToCart = (item) => {
                    if (!item.is_available) {
                        ElMessage.warning('è¯¥èœå“å·²ä¸‹æ¶');
                        return;
                    }
                    if (item.stock <= 0) {
                        ElMessage.warning('è¯¥èœå“åº“å­˜ä¸è¶³');
                        return;
                    }
                    const existingItem = cart.value.find(c => c.id === item.id);
                    if (existingItem) {
                        existingItem.quantity++;
                    } else {
                        cart.value.push({ ...item, quantity: 1 });
                    }
                };

                const updateCartItem = (index, delta) => {
                    cart.value[index].quantity += delta;
                    if (cart.value[index].quantity <= 0) {
                        cart.value.splice(index, 1);
                    }
                };

                const cartTotal = computed(() => {
                    return cart.value.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);
                });

                const submitOrder = async () => {
                    try {
                        const orderData = {
                            table_id: selectedTable.value.id,
                            items: cart.value.map(item => ({
                                menu_item_id: item.id,
                                quantity: item.quantity
                            }))
                        };

                        const response = await axios.post(`${API_BASE}/api/orders/`, orderData);
                        currentOrder.value = response.data;

                        // ç¡®è®¤æ”¯ä»˜
                        await axios.post(`${API_BASE}/api/orders/${response.data.id}/confirm-payment`, {
                            payment_method: selectedPaymentMethod.value
                        });

                        cart.value = [];
                        showPaymentSelection.value = false;
                        ElMessage.success('è®¢å•æäº¤æˆåŠŸï¼');
                        showNotification('æ–°è®¢å•å·²æäº¤ï¼Œå¨æˆ¿æ­£åœ¨å‡†å¤‡', 'success');
                        await loadOrders();
                        await loadTables();
                    } catch (error) {
                        console.error('æäº¤è®¢å•å¤±è´¥:', error);
                        ElMessage.error('è®¢å•æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                };

                // å¨å¸ˆç«¯åŠŸèƒ½
                const kitchenOrders = computed(() => {
                    return orders.value.filter(order => 
                        ['pending', 'confirmed', 'preparing'].includes(order.status) &&
                        order.items.some(item => ['pending', 'preparing'].includes(item.item_status))
                    );
                });

                const isUrgent = (order) => {
                    const orderTime = new Date(order.created_at);
                    const now = new Date();
                    const diff = (now - orderTime) / 1000 / 60;
                    return diff > 15;
                };

                const getItemClass = (item) => {
                    return item.item_status;
                };

                const getItemStatusType = (item) => {
                    const types = {
                        'pending': 'warning',
                        'preparing': 'primary',
                        'ready': 'success',
                        'served': 'info'
                    };
                    return types[item.item_status] || 'info';
                };

                const getItemStatusText = (item) => {
                    const texts = {
                        'pending': 'å¾…åˆ¶ä½œ',
                        'preparing': 'åˆ¶ä½œä¸­',
                        'ready': 'å·²å®Œæˆ',
                        'served': 'å·²ä¸Šèœ'
                    };
                    return texts[item.item_status] || item.item_status;
                };

                const startCooking = async (orderId, itemId) => {
                    try {
                        await axios.patch(`${API_BASE}/api/orders/${orderId}/items/${itemId}/status`, {
                            item_status: 'preparing'
                        });
                        ElMessage.success('å¼€å§‹åˆ¶ä½œ');
                        await loadOrders();
                    } catch (error) {
                        console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                        ElMessage.error('æ›´æ–°å¤±è´¥');
                    }
                };

                const finishCooking = async (orderId, itemId) => {
                    try {
                        await axios.patch(`${API_BASE}/api/orders/${orderId}/items/${itemId}/status`, {
                            item_status: 'ready'
                        });
                        ElMessage.success('åˆ¶ä½œå®Œæˆ');
                        showNotification('èœå“åˆ¶ä½œå®Œæˆï¼Œè¯·ä¼ èœ', 'success');
                        await loadOrders();
                    } catch (error) {
                        console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                        ElMessage.error('æ›´æ–°å¤±è´¥');
                    }
                };

                const allItemsReady = (order) => {
                    return order.items.every(item => item.item_status === 'ready');
                };

                const markOrderReady = async (orderId) => {
                    try {
                        await axios.patch(`${API_BASE}/api/orders/${orderId}/status`, {
                            status: 'ready'
                        });
                        ElMessage.success('è®¢å•å‡†å¤‡å®Œæˆ');
                        await loadOrders();
                    } catch (error) {
                        console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                        ElMessage.error('æ›´æ–°å¤±è´¥');
                    }
                };

                const printKitchenOrder = (order) => {
                    let content = `=== å¨æˆ¿åˆ¶ä½œå• ===\n`;
                    content += `æ¡Œå·: ${order.table_number}\n`;
                    content += `è®¢å•å·: ${order.id}\n`;
                    content += `æ—¶é—´: ${formatTime(order.created_at)}\n`;
                    content += `-------------------\n`;
                    order.items.forEach(item => {
                        content += `${item.menu_item_name} x${item.quantity}\n`;
                        if (item.special_instructions) {
                            content += `å¤‡æ³¨: ${item.special_instructions}\n`;
                        }
                    });
                    content += `===================\n`;
                    console.log(content);
                    ElMessage.success('åˆ¶ä½œå•å·²æ‰“å°');
                };

                // è¯­éŸ³è¯†åˆ«
                const toggleVoiceRecording = () => {
                    isRecording.value = !isRecording.value;
                    if (isRecording.value) {
                        ElMessage.info('æ­£åœ¨å½•éŸ³...');
                        setTimeout(() => {
                            if (isRecording.value) {
                                isRecording.value = false;
                                ElMessage.success('è¯­éŸ³è¯†åˆ«: "å®Œæˆ"');
                                const firstPreparingItem = kitchenOrders.value[0]?.items.find(
                                    item => item.item_status === 'preparing'
                                );
                                if (firstPreparingItem) {
                                    finishCooking(kitchenOrders.value[0].id, firstPreparingItem.id);
                                }
                            }
                        }, 2000);
                    }
                };

                // ä¼ èœå‘˜ç«¯åŠŸèƒ½
                const waiterOrders = computed(() => {
                    return orders.value.filter(order => 
                        ['preparing', 'ready', 'serving'].includes(order.status) &&
                        order.items.some(item => ['ready'].includes(item.item_status))
                    );
                });

                const printServingOrder = (order) => {
                    let content = `=== ä¼ èœå• ===\n`;
                    content += `æ¡Œå·: ${order.table_number}\n`;
                    content += `è®¢å•å·: ${order.id}\n`;
                    content += `-------------------\n`;
                    order.items.forEach(item => {
                        if (item.item_status === 'ready') {
                            content += `${item.menu_item_name} x${item.quantity}\n`;
                        }
                    });
                    content += `===================\n`;
                    console.log(content);
                    ElMessage.success('ä¼ èœå•å·²æ‰“å°');
                };

                const serveDish = (orderId, itemId, tableNumber) => {
                    const order = orders.value.find(o => o.id === orderId);
                    const item = order?.items.find(i => i.id === itemId);
                    servingItem.value = item;
                    servingOrderId.value = orderId;
                    servingTable.value = tableNumber;
                    showServingConfirm.value = true;
                };

                const confirmServing = async () => {
                    try {
                        await axios.patch(`${API_BASE}/api/orders/${servingOrderId.value}/items/${servingItem.value.id}/status`, {
                            item_status: 'served'
                        });
                        showServingConfirm.value = false;
                        ElMessage.success('ä¸Šèœç¡®è®¤æˆåŠŸ');
                        await loadOrders();
                    } catch (error) {
                        console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                        ElMessage.error('æ›´æ–°å¤±è´¥');
                    }
                };

                const allItemsServed = (order) => {
                    return order.items.every(item => item.item_status === 'served');
                };

                const completeOrder = async (orderId) => {
                    try {
                        await axios.patch(`${API_BASE}/api/orders/${orderId}/status`, {
                            status: 'completed'
                        });
                        ElMessage.success('è®¢å•å®Œæˆ');
                        await loadOrders();
                        await loadTables();
                    } catch (error) {
                        console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                        ElMessage.error('æ›´æ–°å¤±è´¥');
                    }
                };

                // æ”¶é“¶å‘˜ç«¯åŠŸèƒ½
                const cashierOrders = computed(() => {
                    return orders.value.filter(order => 
                        ['pending', 'paid', 'completed'].includes(order.status) || 
                        !['paid', 'completed'].includes(order.payment_status)
                    );
                });

                const getPaymentMethodText = (method) => {
                    const texts = {
                        'wechat': 'å¾®ä¿¡æ”¯ä»˜',
                        'alipay': 'æ”¯ä»˜å®',
                        'card': 'é“¶è¡Œå¡',
                        'cash': 'ç°é‡‘',
                        'credit': 'ä¿¡ç”¨å¡',
                        'other': 'å…¶ä»–'
                    };
                    return texts[method] || method;
                };

                const processPayment = async (orderId) => {
                    try {
                        const order = cashierOrders.value.find(o => o.id === orderId);
                        if (order) {
                            await axios.patch(`${API_BASE}/api/orders/${orderId}/status`, {
                                status: 'paid'
                            });
                            selectedPaymentMethod.value = null;
                            ElMessage.success('æ”¯ä»˜æˆåŠŸ');
                            showNotification('æ”¯ä»˜æˆåŠŸ', 'success');
                            await loadOrders();
                        }
                    } catch (error) {
                        console.error('æ”¯ä»˜å¤±è´¥:', error);
                        ElMessage.error('æ”¯ä»˜å¤±è´¥');
                    }
                };

                const printReceipt = (order) => {
                    let content = `=== å°ç¥¨ ===\n`;
                    content += `æ¡Œå·: ${order.table_number}\n`;
                    content += `è®¢å•å·: ${order.id}\n`;
                    content += `æ—¶é—´: ${formatTime(order.created_at)}\n`;
                    content += `æ”¯ä»˜æ–¹å¼: ${getPaymentMethodText(order.payment_method)}\n`;
                    content += `-------------------\n`;
                    order.items.forEach(item => {
                        content += `${item.menu_item_name} x${item.quantity} = Â¥${item.subtotal}\n`;
                    });
                    content += `-------------------\n`;
                    content += `åˆè®¡: Â¥${order.total_amount}\n`;
                    content += `===================\n`;
                    console.log(content);
                    ElMessage.success('å°ç¥¨å·²æ‰“å°');
                };

                // åº—é•¿ç«¯åŠŸèƒ½
                const allOrders = computed(() => {
                    return orders.value;
                });

                const stats = computed(() => {
                    const today = new Date().toDateString();
                    const todayOrders = orders.value.filter(o => 
                        new Date(o.created_at).toDateString() === today
                    );
                    return {
                        totalOrders: todayOrders.length,
                        totalRevenue: todayOrders.reduce((sum, o) => sum + parseFloat(o.total_amount), 0).toFixed(2),
                        activeTables: tables.value.filter(t => t.is_occupied).length,
                        staffCount: 5
                    };
                });

                const getOrderStatusType = (status) => {
                    const types = {
                        'pending': 'warning',
                        'confirmed': 'primary',
                        'preparing': 'primary',
                        'ready': 'success',
                        'serving': 'info',
                        'completed': 'success',
                        'cancelled': 'danger'
                    };
                    return types[status] || 'info';
                };

                const getOrderStatusText = (status) => {
                    const texts = {
                        'pending': 'å¾…ç¡®è®¤',
                        'confirmed': 'å·²ç¡®è®¤',
                        'preparing': 'å‡†å¤‡ä¸­',
                        'ready': 'å·²å®Œæˆ',
                        'serving': 'ä¸Šèœä¸­',
                        'completed': 'å·²å®Œæˆ',
                        'cancelled': 'å·²å–æ¶ˆ'
                    };
                    return texts[status] || status;
                };

                const viewOrderDetail = (order) => {
                    let detail = `è®¢å•è¯¦æƒ…:\n`;
                    detail += `æ¡Œå·: ${order.table_number}\n`;
                    detail += `è®¢å•å·: ${order.id}\n`;
                    detail += `çŠ¶æ€: ${getOrderStatusText(order.status)}\n`;
                    detail += `æ”¯ä»˜: ${getPaymentMethodText(order.payment_method)}\n`;
                    detail += `-------------------\n`;
                    order.items.forEach(item => {
                        detail += `${item.menu_item_name} x${item.quantity} = Â¥${item.subtotal}\n`;
                    });
                    detail += `-------------------\n`;
                    detail += `åˆè®¡: Â¥${order.total_amount}\n`;
                    ElMessageBox.alert(detail, 'è®¢å•è¯¦æƒ…');
                };

                const cancelOrder = async (orderId) => {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ', 'ç¡®è®¤å–æ¶ˆ', {
                            type: 'warning'
                        });
                        await axios.patch(`${API_BASE}/api/orders/${orderId}/status`, {
                            status: 'cancelled'
                        });
                        ElMessage.success('è®¢å•å·²å–æ¶ˆ');
                        await loadOrders();
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('å–æ¶ˆè®¢å•å¤±è´¥:', error);
                        }
                    }
                };

                // å·¥å…·å‡½æ•°
                const filteredMenuItems = computed(() => {
                    if (selectedCategory.value === null) {
                        return menuItems.value.filter(item => item.is_available);
                    }
                    return menuItems.value.filter(item => 
                        item.is_available && item.category_id === selectedCategory.value
                    );
                });

                const formatTime = (timeStr) => {
                    if (!timeStr) return '';
                    const date = new Date(timeStr);
                    return date.toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                };

                const showNotification = (message, type = 'info') => {
                    const id = notificationId++;
                    notifications.value.push({ id, message, type, index: notifications.value.length });
                    setTimeout(() => {
                        const idx = notifications.value.findIndex(n => n.id === id);
                        if (idx !== -1) {
                            notifications.value.splice(idx, 1);
                        }
                    }, 3000);
                };

                return {
                    // çŠ¶æ€
                    currentRole,
                    showCart,
                    showServingConfirm,
                    selectedCategory,
                    selectedTable,
                    tempTableId,
                    selectedPaymentMethod,
                    servingItem,
                    servingOrderId,
                    servingTable,
                    isRecording,
                    notifications,

                    // æ•°æ®
                    tables,
                    categories,
                    menuItems,
                    cart,
                    orders,
                    currentOrder,

                    // è®¡ç®—å±æ€§
                    filteredMenuItems,
                    cartTotal,
                    kitchenOrders,
                    waiterOrders,
                    cashierOrders,
                    allOrders,
                    stats,

                    // æ–¹æ³•
                    switchRole,
                    selectTable,
                    confirmTable,
                    addToCart,
                    updateCartItem,
                    submitOrder,
                    isUrgent,
                    getItemClass,
                    getItemStatusType,
                    getItemStatusText,
                    startCooking,
                    finishCooking,
                    allItemsReady,
                    markOrderReady,
                    printKitchenOrder,
                    toggleVoiceRecording,
                    printServingOrder,
                    serveDish,
                    confirmServing,
                    allItemsServed,
                    completeOrder,
                    getPaymentMethodText,
                    processPayment,
                    printReceipt,
                    getOrderStatusType,
                    getOrderStatusText,
                    viewOrderDetail,
                    cancelOrder,
                    formatTime
                };
            }
        });

        app.use(ElementPlus);
        app.mount('#app');
    </script>
</body>
</html>
