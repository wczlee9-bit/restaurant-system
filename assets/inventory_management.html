<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áâ©ÊñôÈááË¥≠ - Êâ´Á†ÅÁÇπÈ§êÁ≥ªÁªü</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus/dist/index.full.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif; background: #f5f7fa; min-height: 100vh; }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        .header p { opacity: 0.9; font-size: 14px; }
        
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; }
        
        .page-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }
        .back-btn {
            color: white; text-decoration: none; padding: 8px 20px;
            background: rgba(255,255,255,0.2); border-radius: 4px; transition: all 0.3s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); }
        
        .tabs { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }
        .tab-content { background: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }
        
        .section-title {
            font-size: 18px; font-weight: bold; margin-bottom: 20px;
            color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px;
        }
        
        .toolbar {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;
        }
        
        .search-box { width: 300px; }
        
        .stat-card {
            padding: 20px; border-radius: 8px; text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .stat-value { font-size: 32px; font-weight: bold; margin: 10px 0; }
        .stat-label { color: #666; font-size: 14px; }
        
        .empty-state {
            text-align: center; padding: 60px 20px; color: #999;
        }
        .empty-icon { font-size: 48px; margin-bottom: 20px; }
        
        .stock-low { color: #f56c6c; }
        .stock-normal { color: #67c23a; }
        .stock-warning { color: #e6a23c; }
        
        .status-badge {
            padding: 4px 12px; border-radius: 4px; font-size: 12px;
        }
        .status-pending { background: #fef0f0; color: #f56c6c; }
        .status-approved { background: #ecf5ff; color: #667eea; }
        .status-completed { background: #f0f9ff; color: #67c23a; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .toolbar { flex-direction: column; }
            .search-box { width: 100%; }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üì¶ Áâ©ÊñôÈááË¥≠ÁÆ°ÁêÜ</h1>
                    <p>ÁÆ°ÁêÜÂ∫ìÂ≠ò„ÄÅÈááË¥≠ËÆ¢ÂçïÂíåÁâ©Êñô‰ø°ÊÅØ</p>
                </div>
                <div>
                    <a href="portal.html" class="back-btn">‚Üê ËøîÂõûÈó®Êà∑</a>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="tabs">
                <el-tabs v-model="activeTab" @tab-change="handleTabChange">
                    <el-tab-pane label="Â∫ìÂ≠òÊ¶ÇËßà" name="overview"></el-tab-pane>
                    <el-tab-pane label="Áâ©ÊñôÂàóË°®" name="materials">
                        <span>Áâ©ÊñôÂàóË°®</span>
                        <el-badge :value="materials.length" class="item" v-if="materials.length > 0"></el-badge>
                    </el-tab-pane>
                    <el-tab-pane label="ÈááË¥≠ËÆ¢Âçï" name="orders">
                        <span>ÈááË¥≠ËÆ¢Âçï</span>
                        <el-badge :value="purchaseOrders.length" class="item" v-if="purchaseOrders.length > 0"></el-badge>
                    </el-tab-pane>
                </el-tabs>
            </div>

            <!-- Â∫ìÂ≠òÊ¶ÇËßà -->
            <div class="tab-content" v-show="activeTab === 'overview'">
                <div class="section-title">üìä Â∫ìÂ≠òÁªüËÆ°</div>
                
                <el-row :gutter="20" style="margin-bottom: 30px;">
                    <el-col :xs="12" :sm="6">
                        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <div class="stat-label">Áâ©ÊñôÊÄªÊï∞</div>
                            <div class="stat-value">{{ materials.length }}</div>
                        </div>
                    </el-col>
                    <el-col :xs="12" :sm="6">
                        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <div class="stat-label">Â∫ìÂ≠òÈ¢ÑË≠¶</div>
                            <div class="stat-value">{{ lowStockCount }}</div>
                        </div>
                    </el-col>
                    <el-col :xs="12" :sm="6">
                        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                            <div class="stat-label">ÂæÖÂ§ÑÁêÜËÆ¢Âçï</div>
                            <div class="stat-value">{{ pendingOrdersCount }}</div>
                        </div>
                    </el-col>
                    <el-col :xs="12" :sm="6">
                        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                            <div class="stat-label">Êú¨ÊúàÈááË¥≠ÈáëÈ¢ù</div>
                            <div class="stat-value">¬•{{ monthlyPurchaseAmount }}</div>
                        </div>
                    </el-col>
                </el-row>

                <div class="section-title">‚ö†Ô∏è Â∫ìÂ≠òÈ¢ÑË≠¶</div>
                <el-table :data="lowStockMaterials" style="width: 100%">
                    <el-table-column prop="name" label="Áâ©ÊñôÂêçÁß∞" min-width="150"></el-table-column>
                    <el-table-column prop="category" label="ÂàÜÁ±ª" width="120"></el-table-column>
                    <el-table-column prop="current_stock" label="ÂΩìÂâçÂ∫ìÂ≠ò" width="100">
                        <template #default="scope">
                            <span class="stock-low">{{ scope.row.current_stock }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="min_stock" label="ÊúÄ‰ΩéÂ∫ìÂ≠ò" width="100"></el-table-column>
                    <el-table-column prop="unit" label="Âçï‰Ωç" width="80"></el-table-column>
                    <el-table-column label="Âª∫ËÆÆÈááË¥≠Èáè" width="120">
                        <template #default="scope">
                            {{ scope.row.min_stock * 2 - scope.row.current_stock }}
                        </template>
                    </el-table-column>
                    <el-table-column label="Êìç‰Ωú" width="120">
                        <template #default="scope">
                            <el-button size="small" type="primary" @click="createPurchaseOrder(scope.row)">ÈááË¥≠</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>

            <!-- Áâ©ÊñôÂàóË°® -->
            <div class="tab-content" v-show="activeTab === 'materials'">
                <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>üìã Áâ©ÊñôÁÆ°ÁêÜ</span>
                    <el-button type="primary" @click="showMaterialDialog = true">+ Ê∑ªÂä†Áâ©Êñô</el-button>
                </div>

                <div class="toolbar">
                    <el-input
                        v-model="searchKeyword"
                        placeholder="ÊêúÁ¥¢Áâ©ÊñôÂêçÁß∞..."
                        class="search-box"
                        clearable>
                        <template #prefix>
                            <el-icon><Search /></el-icon>
                        </template>
                    </el-input>
                    <el-select v-model="filterCategory" placeholder="ÈÄâÊã©ÂàÜÁ±ª" clearable style="width: 150px;">
                        <el-option label="ÂÖ®ÈÉ®ÂàÜÁ±ª" value=""></el-option>
                        <el-option label="Ëî¨ËèúÁ±ª" value="Ëî¨ËèúÁ±ª"></el-option>
                        <el-option label="ËÇâÁ±ª" value="ËÇâÁ±ª"></el-option>
                        <el-option label="Êµ∑È≤úÁ±ª" value="Êµ∑È≤úÁ±ª"></el-option>
                        <el-option label="Ë∞ÉÊñô" value="Ë∞ÉÊñô"></el-option>
                        <el-option label="‰∏ªÈ£ü" value="‰∏ªÈ£ü"></el-option>
                    </el-select>
                    <el-select v-model="filterStock" placeholder="Â∫ìÂ≠òÁä∂ÊÄÅ" clearable style="width: 150px;">
                        <el-option label="ÂÖ®ÈÉ®Áä∂ÊÄÅ" value=""></el-option>
                        <el-option label="Â∫ìÂ≠òÂÖÖË∂≥" value="normal"></el-option>
                        <el-option label="Â∫ìÂ≠òÈ¢ÑË≠¶" value="low"></el-option>
                    </el-select>
                </div>

                <el-table :data="filteredMaterials" style="width: 100%">
                    <el-table-column prop="id" label="ID" width="60"></el-table-column>
                    <el-table-column prop="name" label="Áâ©ÊñôÂêçÁß∞" min-width="150">
                        <template #default="scope">
                            <strong>{{ scope.row.name }}</strong>
                        </template>
                    </el-table-column>
                    <el-table-column prop="category" label="ÂàÜÁ±ª" width="100"></el-table-column>
                    <el-table-column prop="current_stock" label="ÂΩìÂâçÂ∫ìÂ≠ò" width="100">
                        <template #default="scope">
                            <span :class="getStockClass(scope.row)">{{ scope.row.current_stock }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="min_stock" label="ÊúÄ‰ΩéÂ∫ìÂ≠ò" width="100"></el-table-column>
                    <el-table-column prop="unit" label="Âçï‰Ωç" width="80"></el-table-column>
                    <el-table-column prop="price" label="Âçï‰ª∑(¬•)" width="100"></el-table-column>
                    <el-table-column prop="supplier" label="‰æõÂ∫îÂïÜ" min-width="150"></el-table-column>
                    <el-table-column label="Áä∂ÊÄÅ" width="100">
                        <template #default="scope">
                            <el-tag :type="scope.row.is_active ? 'success' : 'info'">
                                {{ scope.row.is_active ? 'ÂêØÁî®' : 'Á¶ÅÁî®' }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column label="Êìç‰Ωú" width="180" fixed="right">
                        <template #default="scope">
                            <el-button size="small" @click="editMaterial(scope.row)">ÁºñËæë</el-button>
                            <el-button size="small" type="primary" @click="createPurchaseOrder(scope.row)">ÈááË¥≠</el-button>
                            <el-button size="small" type="danger" @click="deleteMaterial(scope.row)">Âà†Èô§</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>

            <!-- ÈááË¥≠ËÆ¢Âçï -->
            <div class="tab-content" v-show="activeTab === 'orders'">
                <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>üìù ÈááË¥≠ËÆ¢Âçï</span>
                    <div>
                        <el-button type="primary" @click="showOrderDialog = true; isEditingOrder = false; resetOrderForm()">
                            + Êñ∞Âª∫ËÆ¢Âçï
                        </el-button>
                    </div>
                </div>

                <div class="toolbar">
                    <el-select v-model="filterOrderStatus" placeholder="ËÆ¢ÂçïÁä∂ÊÄÅ" clearable style="width: 150px;">
                        <el-option label="ÂÖ®ÈÉ®Áä∂ÊÄÅ" value=""></el-option>
                        <el-option label="ÂæÖÂÆ°Ê†∏" value="pending"></el-option>
                        <el-option label="Â∑≤ÊâπÂáÜ" value="approved"></el-option>
                        <el-option label="Â∑≤ÂÆåÊàê" value="completed"></el-option>
                    </el-select>
                    <el-date-picker
                        v-model="orderDateRange"
                        type="daterange"
                        range-separator="Ëá≥"
                        start-placeholder="ÂºÄÂßãÊó•Êúü"
                        end-placeholder="ÁªìÊùüÊó•Êúü"
                        style="width: 300px;">
                    </el-date-picker>
                </div>

                <el-table :data="filteredPurchaseOrders" style="width: 100%">
                    <el-table-column prop="id" label="ËÆ¢ÂçïÂè∑" width="120"></el-table-column>
                    <el-table-column prop="material_name" label="Áâ©ÊñôÂêçÁß∞" min-width="150"></el-table-column>
                    <el-table-column prop="quantity" label="ÈááË¥≠Êï∞Èáè" width="100"></el-table-column>
                    <el-table-column prop="unit" label="Âçï‰Ωç" width="80"></el-table-column>
                    <el-table-column prop="unit_price" label="Âçï‰ª∑(¬•)" width="100"></el-table-column>
                    <el-table-column prop="total_amount" label="ÊÄªÈáëÈ¢ù(¬•)" width="120">
                        <template #default="scope">
                            <strong>{{ scope.row.total_amount }}</strong>
                        </template>
                    </el-table-column>
                    <el-table-column prop="supplier" label="‰æõÂ∫îÂïÜ" min-width="150"></el-table-column>
                    <el-table-column label="Áä∂ÊÄÅ" width="100">
                        <template #default="scope">
                            <span class="status-badge" :class="'status-' + scope.row.status">
                                {{ getOrderStatusText(scope.row.status) }}
                            </span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="created_at" label="ÂàõÂª∫Êó∂Èó¥" width="180"></el-table-column>
                    <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
                        <template #default="scope">
                            <el-button size="small" @click="viewOrder(scope.row)">Êü•Áúã</el-button>
                            <el-button 
                                v-if="scope.row.status === 'pending'"
                                size="small" 
                                type="success" 
                                @click="approveOrder(scope.row)">
                                ÊâπÂáÜ
                            </el-button>
                            <el-button 
                                v-if="scope.row.status === 'approved'"
                                size="small" 
                                type="primary" 
                                @click="completeOrder(scope.row)">
                                ÂÆåÊàê
                            </el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
        </div>

        <!-- Áâ©ÊñôÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showMaterialDialog"
            :title="editingMaterial ? 'ÁºñËæëÁâ©Êñô' : 'Ê∑ªÂä†Áâ©Êñô'"
            width="600px">
            <el-form :model="materialForm" label-width="100px">
                <el-form-item label="Áâ©ÊñôÂêçÁß∞" required>
                    <el-input v-model="materialForm.name" placeholder="ËØ∑ËæìÂÖ•Áâ©ÊñôÂêçÁß∞"></el-input>
                </el-form-item>
                <el-form-item label="ÂàÜÁ±ª" required>
                    <el-select v-model="materialForm.category" placeholder="ËØ∑ÈÄâÊã©ÂàÜÁ±ª" style="width: 100%;">
                        <el-option label="Ëî¨ËèúÁ±ª" value="Ëî¨ËèúÁ±ª"></el-option>
                        <el-option label="ËÇâÁ±ª" value="ËÇâÁ±ª"></el-option>
                        <el-option label="Êµ∑È≤úÁ±ª" value="Êµ∑È≤úÁ±ª"></el-option>
                        <el-option label="Ë∞ÉÊñô" value="Ë∞ÉÊñô"></el-option>
                        <el-option label="‰∏ªÈ£ü" value="‰∏ªÈ£ü"></el-option>
                        <el-option label="ÂÖ∂‰ªñ" value="ÂÖ∂‰ªñ"></el-option>
                    </el-select>
                </el-form-item>
                <div class="form-grid">
                    <el-form-item label="ÂΩìÂâçÂ∫ìÂ≠ò">
                        <el-input-number v-model="materialForm.current_stock" :min="0"></el-input-number>
                    </el-form-item>
                    <el-form-item label="ÊúÄ‰ΩéÂ∫ìÂ≠ò">
                        <el-input-number v-model="materialForm.min_stock" :min="0"></el-input-number>
                    </el-form-item>
                </div>
                <div class="form-grid">
                    <el-form-item label="Âçï‰Ωç">
                        <el-input v-model="materialForm.unit" placeholder="Â¶ÇÔºökg„ÄÅ‰ª∂„ÄÅÁÆ±"></el-input>
                    </el-form-item>
                    <el-form-item label="Âçï‰ª∑(¬•)">
                        <el-input-number v-model="materialForm.price" :min="0" :precision="2"></el-input-number>
                    </el-form-item>
                </div>
                <el-form-item label="‰æõÂ∫îÂïÜ">
                    <el-input v-model="materialForm.supplier" placeholder="ËØ∑ËæìÂÖ•‰æõÂ∫îÂïÜÂêçÁß∞"></el-input>
                </el-form-item>
                <el-form-item label="Â§áÊ≥®">
                    <el-input v-model="materialForm.remark" type="textarea" :rows="3" placeholder="ËØ∑ËæìÂÖ•Â§áÊ≥®"></el-input>
                </el-form-item>
                <el-form-item label="Áä∂ÊÄÅ">
                    <el-switch v-model="materialForm.is_active" active-text="ÂêØÁî®" inactive-text="Á¶ÅÁî®"></el-switch>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showMaterialDialog = false">ÂèñÊ∂à</el-button>
                    <el-button type="primary" @click="saveMaterial">Á°ÆÂÆö</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- ÈááË¥≠ËÆ¢ÂçïÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showOrderDialog"
            :title="isEditingOrder ? 'ÁºñËæëÈááË¥≠ËÆ¢Âçï' : 'Êñ∞Âª∫ÈááË¥≠ËÆ¢Âçï'"
            width="600px">
            <el-form :model="orderForm" label-width="100px">
                <el-form-item label="Áâ©Êñô" required>
                    <el-select v-model="orderForm.material_id" placeholder="ËØ∑ÈÄâÊã©Áâ©Êñô" style="width: 100%;">
                        <el-option
                            v-for="material in materials"
                            :key="material.id"
                            :label="material.name"
                            :value="material.id">
                            <span>{{ material.name }}</span>
                            <span style="color: #999; font-size: 12px; margin-left: 10px;">
                                Â∫ìÂ≠ò: {{ material.current_stock }}{{ material.unit }}
                            </span>
                        </el-option>
                    </el-select>
                </el-form-item>
                <div class="form-grid">
                    <el-form-item label="ÈááË¥≠Êï∞Èáè" required>
                        <el-input-number v-model="orderForm.quantity" :min="1"></el-input-number>
                    </el-form-item>
                    <el-form-item label="Âçï‰ª∑(¬•)" required>
                        <el-input-number v-model="orderForm.unit_price" :min="0" :precision="2"></el-input-number>
                    </el-form-item>
                </div>
                <el-form-item label="ÊÄªÈáëÈ¢ù">
                    <el-input v-model="orderTotal" disabled></el-input>
                </el-form-item>
                <el-form-item label="‰æõÂ∫îÂïÜ">
                    <el-input v-model="orderForm.supplier" placeholder="ËØ∑ËæìÂÖ•‰æõÂ∫îÂïÜÂêçÁß∞"></el-input>
                </el-form-item>
                <el-form-item label="Â§áÊ≥®">
                    <el-input v-model="orderForm.remark" type="textarea" :rows="3" placeholder="ËØ∑ËæìÂÖ•Â§áÊ≥®"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showOrderDialog = false">ÂèñÊ∂à</el-button>
                    <el-button type="primary" @click="saveOrder">Á°ÆÂÆö</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- ËÆ¢ÂçïËØ¶ÊÉÖÂØπËØùÊ°Ü -->
        <el-dialog
            v-model="showOrderDetailDialog"
            title="ËÆ¢ÂçïËØ¶ÊÉÖ"
            width="600px">
            <el-descriptions :column="2" border>
                <el-descriptions-item label="ËÆ¢ÂçïÂè∑">{{ currentOrder.id }}</el-descriptions-item>
                <el-descriptions-item label="Áä∂ÊÄÅ">
                    <span class="status-badge" :class="'status-' + currentOrder.status">
                        {{ getOrderStatusText(currentOrder.status) }}
                    </span>
                </el-descriptions-item>
                <el-descriptions-item label="Áâ©ÊñôÂêçÁß∞">{{ currentOrder.material_name }}</el-descriptions-item>
                <el-descriptions-item label="ÈááË¥≠Êï∞Èáè">{{ currentOrder.quantity }} {{ currentOrder.unit }}</el-descriptions-item>
                <el-descriptions-item label="Âçï‰ª∑">¬•{{ currentOrder.unit_price }}</el-descriptions-item>
                <el-descriptions-item label="ÊÄªÈáëÈ¢ù">¬•{{ currentOrder.total_amount }}</el-descriptions-item>
                <el-descriptions-item label="‰æõÂ∫îÂïÜ">{{ currentOrder.supplier }}</el-descriptions-item>
                <el-descriptions-item label="ÂàõÂª∫Êó∂Èó¥">{{ currentOrder.created_at }}</el-descriptions-item>
                <el-descriptions-item label="Â§áÊ≥®" :span="2">{{ currentOrder.remark || 'Êó†' }}</el-descriptions-item>
            </el-descriptions>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showOrderDetailDialog = false">ÂÖ≥Èó≠</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp, ref, reactive, computed } = Vue;

        createApp({
            setup() {
                const activeTab = ref('overview');
                const searchKeyword = ref('');
                const filterCategory = ref('');
                const filterStock = ref('');
                const filterOrderStatus = ref('');
                const orderDateRange = ref([]);
                const showMaterialDialog = ref(false);
                const showOrderDialog = ref(false);
                const showOrderDetailDialog = ref(false);
                const editingMaterial = ref(null);
                const isEditingOrder = ref(false);
                const currentOrder = ref({});

                // Áâ©ÊñôÊï∞ÊçÆ
                const materials = ref([
                    { id: 1, name: 'ÂúüË±Ü', category: 'Ëî¨ËèúÁ±ª', current_stock: 50, min_stock: 30, unit: 'kg', price: 3.50, supplier: 'XXËî¨ËèúÊâπÂèëÂ∏ÇÂú∫', remark: '', is_active: true },
                    { id: 2, name: 'Ë•øÁ∫¢Êüø', category: 'Ëî¨ËèúÁ±ª', current_stock: 20, min_stock: 25, unit: 'kg', price: 5.00, supplier: 'XXËî¨ËèúÊâπÂèëÂ∏ÇÂú∫', remark: '', is_active: true },
                    { id: 3, name: 'Áå™ËÇâ', category: 'ËÇâÁ±ª', current_stock: 15, min_stock: 20, unit: 'kg', price: 45.00, supplier: 'XXËÇâÁ±ª‰æõÂ∫îÂïÜ', remark: '', is_active: true },
                    { id: 4, name: 'È∏°Ëõã', category: 'ÂÖ∂‰ªñ', current_stock: 100, min_stock: 50, unit: 'kg', price: 12.00, supplier: 'XXÂÜúÂú∫', remark: '', is_active: true },
                    { id: 5, name: 'È£üÁî®Ê≤π', category: 'Ë∞ÉÊñô', current_stock: 10, min_stock: 15, unit: 'Ê°∂', price: 85.00, supplier: 'XXÁ≤ÆÊ≤πÂÖ¨Âè∏', remark: '', is_active: true },
                    { id: 6, name: 'Â§ßÁ±≥', category: '‰∏ªÈ£ü', current_stock: 80, min_stock: 50, unit: 'kg', price: 6.00, supplier: 'XXÁ≤ÆÊ≤πÂÖ¨Âè∏', remark: '', is_active: true }
                ]);

                // ÈááË¥≠ËÆ¢ÂçïÊï∞ÊçÆ
                const purchaseOrders = ref([
                    { id: 'PO202401001', material_id: 1, material_name: 'ÂúüË±Ü', quantity: 100, unit: 'kg', unit_price: 3.50, total_amount: 350.00, supplier: 'XXËî¨ËèúÊâπÂèëÂ∏ÇÂú∫', status: 'completed', remark: 'ÂÆöÊúüË°•Ë¥ß', created_at: '2024-01-15 10:30:00' },
                    { id: 'PO202401002', material_id: 2, material_name: 'Ë•øÁ∫¢Êüø', quantity: 50, unit: 'kg', unit_price: 5.00, total_amount: 250.00, supplier: 'XXËî¨ËèúÊâπÂèëÂ∏ÇÂú∫', status: 'approved', remark: '', created_at: '2024-01-16 14:20:00' },
                    { id: 'PO202401003', material_id: 3, material_name: 'Áå™ËÇâ', quantity: 30, unit: 'kg', unit_price: 45.00, total_amount: 1350.00, supplier: 'XXËÇâÁ±ª‰æõÂ∫îÂïÜ', status: 'pending', remark: 'ÊÄ•Áî®', created_at: '2024-01-17 09:00:00' }
                ]);

                // Áâ©ÊñôË°®Âçï
                const materialForm = reactive({
                    id: null,
                    name: '',
                    category: '',
                    current_stock: 0,
                    min_stock: 0,
                    unit: '',
                    price: 0,
                    supplier: '',
                    remark: '',
                    is_active: true
                });

                // ÈááË¥≠ËÆ¢ÂçïË°®Âçï
                const orderForm = reactive({
                    id: null,
                    material_id: null,
                    quantity: 1,
                    unit_price: 0,
                    total_amount: 0,
                    supplier: '',
                    remark: '',
                    status: 'pending'
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - Â∫ìÂ≠òÈ¢ÑË≠¶Êï∞Èáè
                const lowStockCount = computed(() => {
                    return materials.value.filter(m => m.current_stock < m.min_stock).length;
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - ÂæÖÂ§ÑÁêÜËÆ¢ÂçïÊï∞Èáè
                const pendingOrdersCount = computed(() => {
                    return purchaseOrders.value.filter(o => o.status === 'pending').length;
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - Êú¨ÊúàÈááË¥≠ÈáëÈ¢ù
                const monthlyPurchaseAmount = computed(() => {
                    return purchaseOrders.value
                        .filter(o => o.status === 'completed')
                        .reduce((sum, o) => sum + o.total_amount, 0)
                        .toFixed(2);
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - Â∫ìÂ≠òÈ¢ÑË≠¶Áâ©ÊñôÂàóË°®
                const lowStockMaterials = computed(() => {
                    return materials.value.filter(m => m.current_stock < m.min_stock);
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - ËøáÊª§ÂêéÁöÑÁâ©ÊñôÂàóË°®
                const filteredMaterials = computed(() => {
                    return materials.value.filter(material => {
                        const matchKeyword = !searchKeyword.value || 
                            material.name.toLowerCase().includes(searchKeyword.value.toLowerCase());
                        const matchCategory = !filterCategory.value || 
                            material.category === filterCategory.value;
                        
                        let matchStock = true;
                        if (filterStock.value === 'low') {
                            matchStock = material.current_stock < material.min_stock;
                        } else if (filterStock.value === 'normal') {
                            matchStock = material.current_stock >= material.min_stock;
                        }
                        
                        return matchKeyword && matchCategory && matchStock;
                    });
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - ËøáÊª§ÂêéÁöÑËÆ¢ÂçïÂàóË°®
                const filteredPurchaseOrders = computed(() => {
                    return purchaseOrders.value.filter(order => {
                        const matchStatus = !filterOrderStatus.value || order.status === filterOrderStatus.value;
                        // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†Êó•ÊúüËøáÊª§ÈÄªËæë
                        return matchStatus;
                    });
                });

                // ËÆ°ÁÆóÂ±ûÊÄß - ËÆ¢ÂçïÊÄªÈáëÈ¢ù
                const orderTotal = computed(() => {
                    const total = orderForm.quantity * orderForm.unit_price;
                    orderForm.total_amount = total.toFixed(2);
                    return `¬•${total.toFixed(2)}`;
                });

                // Ëé∑ÂèñÂ∫ìÂ≠òÊ†∑ÂºèÁ±ª
                const getStockClass = (material) => {
                    if (material.current_stock < material.min_stock) {
                        return 'stock-low';
                    }
                    return 'stock-normal';
                };

                // Ëé∑ÂèñËÆ¢ÂçïÁä∂ÊÄÅÊñáÊú¨
                const getOrderStatusText = (status) => {
                    const statusMap = {
                        'pending': 'ÂæÖÂÆ°Ê†∏',
                        'approved': 'Â∑≤ÊâπÂáÜ',
                        'completed': 'Â∑≤ÂÆåÊàê'
                    };
                    return statusMap[status] || status;
                };

                // ÈáçÁΩÆÁâ©ÊñôË°®Âçï
                const resetMaterialForm = () => {
                    materialForm.id = null;
                    materialForm.name = '';
                    materialForm.category = '';
                    materialForm.current_stock = 0;
                    materialForm.min_stock = 0;
                    materialForm.unit = '';
                    materialForm.price = 0;
                    materialForm.supplier = '';
                    materialForm.remark = '';
                    materialForm.is_active = true;
                };

                // ÈáçÁΩÆËÆ¢ÂçïË°®Âçï
                const resetOrderForm = () => {
                    orderForm.id = null;
                    orderForm.material_id = null;
                    orderForm.quantity = 1;
                    orderForm.unit_price = 0;
                    orderForm.total_amount = 0;
                    orderForm.supplier = '';
                    orderForm.remark = '';
                    orderForm.status = 'pending';
                };

                // ÂàõÂª∫ÈááË¥≠ËÆ¢Âçï
                const createPurchaseOrder = (material) => {
                    resetOrderForm();
                    orderForm.material_id = material.id;
                    orderForm.unit = material.unit;
                    orderForm.unit_price = material.price;
                    orderForm.supplier = material.supplier;
                    showOrderDialog.value = true;
                };

                // ‰øùÂ≠òÁâ©Êñô
                const saveMaterial = () => {
                    if (!materialForm.name || !materialForm.category) {
                        ElementPlus.ElMessage.warning('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑÁâ©Êñô‰ø°ÊÅØ');
                        return;
                    }

                    if (editingMaterial.value) {
                        // ÁºñËæë
                        const index = materials.value.findIndex(m => m.id === editingMaterial.value.id);
                        if (index !== -1) {
                            materials.value[index] = { ...materialForm, id: editingMaterial.value.id };
                        }
                    } else {
                        // Êñ∞Â¢û
                        const newId = Math.max(...materials.value.map(m => m.id), 0) + 1;
                        materials.value.push({
                            id: newId,
                            ...materialForm
                        });
                    }

                    saveData();
                    showMaterialDialog.value = false;
                    editingMaterial.value = null;
                    ElementPlus.ElMessage.success(editingMaterial.value ? 'Áâ©ÊñôÂ∑≤Êõ¥Êñ∞' : 'Áâ©ÊñôÂ∑≤Ê∑ªÂä†');
                };

                // ÁºñËæëÁâ©Êñô
                const editMaterial = (material) => {
                    editingMaterial.value = material;
                    Object.assign(materialForm, material);
                    showMaterialDialog.value = true;
                };

                // Âà†Èô§Áâ©Êñô
                const deleteMaterial = (material) => {
                    ElementPlus.ElMessageBox.confirm(
                        `Á°ÆÂÆöË¶ÅÂà†Èô§Áâ©Êñô"${material.name}"ÂêóÔºü`,
                        'ÊèêÁ§∫',
                        {
                            confirmButtonText: 'Á°ÆÂÆö',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning'
                        }
                    ).then(() => {
                        const index = materials.value.findIndex(m => m.id === material.id);
                        if (index !== -1) {
                            materials.value.splice(index, 1);
                            saveData();
                            ElementPlus.ElMessage.success('Áâ©ÊñôÂ∑≤Âà†Èô§');
                        }
                    }).catch(() => {});
                };

                // ‰øùÂ≠òÈááË¥≠ËÆ¢Âçï
                const saveOrder = () => {
                    if (!orderForm.material_id || !orderForm.quantity || orderForm.unit_price <= 0) {
                        ElementPlus.ElMessage.warning('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑËÆ¢Âçï‰ø°ÊÅØ');
                        return;
                    }

                    const material = materials.value.find(m => m.id === orderForm.material_id);
                    
                    if (isEditingOrder.value) {
                        // ÁºñËæë
                        const index = purchaseOrders.value.findIndex(o => o.id === orderForm.id);
                        if (index !== -1) {
                            purchaseOrders.value[index] = {
                                ...orderForm,
                                material_name: material.name,
                                unit: material.unit
                            };
                        }
                    } else {
                        // Êñ∞Â¢û
                        const newId = 'PO' + Date.now();
                        purchaseOrders.value.unshift({
                            id: newId,
                            ...orderForm,
                            material_name: material.name,
                            unit: material.unit,
                            created_at: new Date().toLocaleString('zh-CN')
                        });
                    }

                    saveData();
                    showOrderDialog.value = false;
                    isEditingOrder.value = false;
                    ElementPlus.ElMessage.success(isEditingOrder.value ? 'ËÆ¢ÂçïÂ∑≤Êõ¥Êñ∞' : 'ËÆ¢ÂçïÂ∑≤ÂàõÂª∫');
                };

                // Êü•ÁúãËÆ¢ÂçïËØ¶ÊÉÖ
                const viewOrder = (order) => {
                    currentOrder.value = order;
                    showOrderDetailDialog.value = true;
                };

                // ÊâπÂáÜËÆ¢Âçï
                const approveOrder = (order) => {
                    order.status = 'approved';
                    saveData();
                    ElementPlus.ElMessage.success('ËÆ¢ÂçïÂ∑≤ÊâπÂáÜ');
                };

                // ÂÆåÊàêËÆ¢Âçï
                const completeOrder = (order) => {
                    ElementPlus.ElMessageBox.confirm(
                        'ÂÆåÊàêËÆ¢ÂçïÂ∞ÜÂ¢ûÂä†Áâ©ÊñôÂ∫ìÂ≠òÔºåÁ°ÆÂÆöÂêóÔºü',
                        'ÊèêÁ§∫',
                        {
                            confirmButtonText: 'Á°ÆÂÆö',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'info'
                        }
                    ).then(() => {
                        order.status = 'completed';
                        
                        // Â¢ûÂä†ÂØπÂ∫îÁâ©ÊñôÁöÑÂ∫ìÂ≠ò
                        const material = materials.value.find(m => m.id === order.material_id);
                        if (material) {
                            material.current_stock += order.quantity;
                        }
                        
                        saveData();
                        ElementPlus.ElMessage.success('ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºåÂ∫ìÂ≠òÂ∑≤Êõ¥Êñ∞');
                    }).catch(() => {});
                };

                // ‰øùÂ≠òÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
                const saveData = () => {
                    localStorage.setItem('inventoryMaterials', JSON.stringify(materials.value));
                    localStorage.setItem('purchaseOrders', JSON.stringify(purchaseOrders.value));
                };

                // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
                const loadData = () => {
                    const savedMaterials = localStorage.getItem('inventoryMaterials');
                    if (savedMaterials) {
                        materials.value = JSON.parse(savedMaterials);
                    }

                    const savedOrders = localStorage.getItem('purchaseOrders');
                    if (savedOrders) {
                        purchaseOrders.value = JSON.parse(savedOrders);
                    }
                };

                const handleTabChange = () => {
                    // Tab ÂàáÊç¢Â§ÑÁêÜ
                };

                // ÂàùÂßãÂåñ
                loadData();

                return {
                    activeTab,
                    searchKeyword,
                    filterCategory,
                    filterStock,
                    filterOrderStatus,
                    orderDateRange,
                    showMaterialDialog,
                    showOrderDialog,
                    showOrderDetailDialog,
                    editingMaterial,
                    isEditingOrder,
                    currentOrder,
                    materials,
                    purchaseOrders,
                    materialForm,
                    orderForm,
                    lowStockCount,
                    pendingOrdersCount,
                    monthlyPurchaseAmount,
                    lowStockMaterials,
                    filteredMaterials,
                    filteredPurchaseOrders,
                    orderTotal,
                    getStockClass,
                    getOrderStatusText,
                    resetMaterialForm,
                    resetOrderForm,
                    createPurchaseOrder,
                    saveMaterial,
                    editMaterial,
                    deleteMaterial,
                    saveOrder,
                    viewOrder,
                    approveOrder,
                    completeOrder,
                    handleTabChange
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
