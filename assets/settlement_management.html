<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¨åº—é“ºç»“ç®—ç®¡ç†</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 8px;
        }
        
        .main-content {
            flex: 1;
            padding: 20px 40px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .section-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
            line-height: 1.6;
        }
        
        .tab-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: #667eea;
            color: white;
        }
        
        .tab-button:hover {
            background: #5568d3;
            color: white;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .form-row {
            margin-bottom: 16px;
        }
        
        .form-row label {
            display: block;
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #1976d2;
        }
        
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #2e7d32;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #e65100;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .back-link:hover {
            color: #5568d3;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 13px;
            color: #666;
        }
        
        .data-table td {
            font-size: 14px;
            color: #333;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3e0;
            color: #e65100;
        }
        
        .status-completed {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-failed {
            background: #ffebee;
            color: #c62828;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #f5f5f5;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination .active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <header class="header">
            <h1>è·¨åº—é“ºç»“ç®—ç®¡ç†</h1>
            <p>ç®¡ç†è·¨åº—é“ºç§¯åˆ†ç»“ç®—å’Œç¬¬ä¸‰æ–¹ç§¯åˆ†äº’é€š</p>
        </header>

        <main class="main-content">
            <a href="portal.html" class="back-link">â† è¿”å›é—¨æˆ·</a>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>æ€»ç»“ç®—æ•°</h3>
                    <div class="value">{{ statistics.cross_store_settlements?.total_settlements || 0 }}</div>
                </div>
                <div class="stat-card">
                    <h3>æ€»ç§¯åˆ†</h3>
                    <div class="value">{{ statistics.cross_store_settlements?.total_points || 0 }}</div>
                </div>
                <div class="stat-card">
                    <h3>ç¬¬ä¸‰æ–¹å…‘æ¢</h3>
                    <div class="value">{{ statistics.third_party_exchanges?.total_exchanges || 0 }}</div>
                </div>
                <div class="stat-card">
                    <h3>æ´»è·ƒåè®®</h3>
                    <div class="value">{{ statistics.agreements?.active_agreements || 0 }}</div>
                </div>
            </div>

            <!-- Tab åˆ‡æ¢ -->
            <div class="tab-buttons">
                <button class="tab-button" :class="{ active: activeTab === 'settlements' }" @click="activeTab = 'settlements'">
                    è·¨åº—é“ºç»“ç®—
                </button>
                <button class="tab-button" :class="{ active: activeTab === 'agreements' }" @click="activeTab = 'agreements'">
                    ç¬¬ä¸‰æ–¹åè®®
                </button>
                <button class="tab-button" :class="{ active: activeTab === 'exchanges' }" @click="activeTab = 'exchanges'">
                    ç§¯åˆ†å…‘æ¢
                </button>
            </div>

            <!-- è·¨åº—é“ºç»“ç®— -->
            <div v-if="activeTab === 'settlements'" class="section">
                <h2 class="section-title">è·¨åº—é“ºç»“ç®—</h2>
                <p class="section-description">
                    è®°å½•ä¼šå‘˜åœ¨ä¸€ä¸ªåº—é“ºæ¶ˆè´¹æ—¶ä½¿ç”¨å¦ä¸€ä¸ªåº—é“ºçš„ç§¯åˆ†ï¼Œæ”¯æŒ1:1ç§¯åˆ†ç»“ç®—ã€‚
                </p>

                <div class="info-box">
                    <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong>ä¼šå‘˜åœ¨åº—é“ºAæ¶ˆè´¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åº—é“ºBçš„ç§¯åˆ†ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•ç»“ç®—å…³ç³»ï¼Œ
                    æ”¯æŒå®šæœŸå¯¹è´¦å’Œç»“ç®—ç»Ÿè®¡ã€‚
                </div>

                <h3>åˆ›å»ºè·¨åº—é“ºç»“ç®—</h3>
                <div class="form-row">
                    <label>ç§¯åˆ†æ¥æºåº—é“º</label>
                    <select v-model="settlementForm.source_store_id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">è¯·é€‰æ‹©åº—é“º</option>
                        <option v-for="store in stores" :key="store.id" :value="store.id">
                            {{ store.name }} (ID: {{ store.id }})
                        </option>
                    </select>
                </div>

                <div class="form-row">
                    <label>ç§¯åˆ†ç›®æ ‡åº—é“ºï¼ˆæ¶ˆè´¹åº—é“ºï¼‰</label>
                    <select v-model="settlementForm.target_store_id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">è¯·é€‰æ‹©åº—é“º</option>
                        <option v-for="store in stores" :key="store.id" :value="store.id">
                            {{ store.name }} (ID: {{ store.id }})
                        </option>
                    </select>
                </div>

                <div class="form-row">
                    <label>ä¼šå‘˜æ‰‹æœºå·</label>
                    <input 
                        type="text" 
                        v-model="settlementForm.member_phone" 
                        placeholder="è¯·è¾“å…¥ä¼šå‘˜æ‰‹æœºå·"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>ç§¯åˆ†æ•°é‡</label>
                    <input 
                        type="number" 
                        v-model.number="settlementForm.points" 
                        placeholder="è¯·è¾“å…¥ç§¯åˆ†æ•°é‡"
                        min="1"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>ç»“ç®—æ±‡ç‡ï¼ˆå¯é€‰ï¼‰</label>
                    <input 
                        type="number" 
                        v-model.number="settlementForm.settlement_rate" 
                        placeholder="é»˜è®¤1.0ï¼ˆ1:1ç»“ç®—ï¼‰"
                        min="0"
                        step="0.1"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea 
                        v-model="settlementForm.remarks" 
                        placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"
                        rows="3"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                    ></textarea>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" @click="createSettlement">åˆ›å»ºç»“ç®—</button>
                    <button class="btn-secondary" @click="resetSettlementForm">é‡ç½®</button>
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                <h3>ç»“ç®—è®°å½•</h3>
                <div v-if="loading.settlements" class="loading">åŠ è½½ä¸­...</div>
                <div v-else-if="settlements.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ“‹</div>
                    <p>æš‚æ— ç»“ç®—è®°å½•</p>
                </div>
                <div v-else>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æ¥æºåº—é“º</th>
                                <th>ç›®æ ‡åº—é“º</th>
                                <th>ä¼šå‘˜</th>
                                <th>ç§¯åˆ†</th>
                                <th>ç»“ç®—é‡‘é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>æ—¥æœŸ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in settlements" :key="item.id">
                                <td>{{ item.id }}</td>
                                <td>{{ item.source_store_name }}</td>
                                <td>{{ item.target_store_name }}</td>
                                <td>
                                    <div>{{ item.member_name || '-' }}</div>
                                    <div style="font-size: 12px; color: #999;">{{ item.member_phone }}</div>
                                </td>
                                <td>{{ item.points }}</td>
                                <td>{{ item.settlement_amount || '-' }}</td>
                                <td>
                                    <span class="status-badge" :class="'status-' + item.status">
                                        {{ item.status }}
                                    </span>
                                </td>
                                <td>{{ formatDate(item.settlement_date) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ç¬¬ä¸‰æ–¹åè®® -->
            <div v-if="activeTab === 'agreements'" class="section">
                <h2 class="section-title">ç¬¬ä¸‰æ–¹ç§¯åˆ†åè®®</h2>
                <p class="section-description">
                    ç®¡ç†ä¸ç¬¬ä¸‰æ–¹å…¬å¸çš„ç§¯åˆ†åˆä½œåè®®ï¼Œæ”¯æŒåŒå‘ã€å•å‘ç§¯åˆ†äº’é€šã€‚
                </p>

                <div class="info-box">
                    <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong>åˆ›å»ºä¸ç¬¬ä¸‰æ–¹å…¬å¸ï¼ˆå¦‚æ˜Ÿå·´å…‹ã€è‚¯å¾·åŸºç­‰ï¼‰çš„ç§¯åˆ†åˆä½œåè®®ã€‚
                    å¯ä»¥å®šä¹‰ç§¯åˆ†å…‘æ¢æ¯”ä¾‹ã€æ¯æ—¥é™é¢ç­‰è§„åˆ™ï¼Œæ”¯æŒçµæ´»çš„ç§¯åˆ†äº’é€šé…ç½®ã€‚
                </div>

                <h3>åˆ›å»ºç¬¬ä¸‰æ–¹åè®®</h3>
                <div class="form-row">
                    <label>æœ¬åº—é“º</label>
                    <select v-model="agreementForm.store_id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">è¯·é€‰æ‹©åº—é“º</option>
                        <option v-for="store in stores" :key="store.id" :value="store.id">
                            {{ store.name }} (ID: {{ store.id }})
                        </option>
                    </select>
                </div>

                <div class="form-row">
                    <label>ç¬¬ä¸‰æ–¹å…¬å¸åç§°</label>
                    <input 
                        type="text" 
                        v-model="agreementForm.third_party_name" 
                        placeholder="ä¾‹å¦‚ï¼šæ˜Ÿå·´å…‹å’–å•¡ã€è‚¯å¾·åŸº"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>åè®®ç±»å‹</label>
                    <select v-model="agreementForm.agreement_type" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="bidirectional">åŒå‘äº’é€šï¼ˆç§¯åˆ†å¯ä»¥äº’ç›¸å…‘æ¢ï¼‰</option>
                        <option value="inbound">åªè¿›ï¼ˆç¬¬ä¸‰æ–¹ç§¯åˆ† -> æœ¬æ–¹ç§¯åˆ†ï¼‰</option>
                        <option value="outbound">åªå‡ºï¼ˆæœ¬æ–¹ç§¯åˆ† -> ç¬¬ä¸‰æ–¹ç§¯åˆ†ï¼‰</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>ç§¯åˆ†å…‘æ¢æ¯”ä¾‹ï¼ˆ1ç¬¬ä¸‰æ–¹ç§¯åˆ† = Xæœ¬æ–¹ç§¯åˆ†ï¼‰</label>
                    <input 
                        type="number" 
                        v-model.number="agreementForm.exchange_rate" 
                        placeholder="ä¾‹å¦‚ï¼š0.8ï¼ˆ1ç¬¬ä¸‰æ–¹ç§¯åˆ† = 0.8æœ¬æ–¹ç§¯åˆ†ï¼‰"
                        min="0.01"
                        step="0.1"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>æ¯æ—¥æœ€å¤§å…‘æ¢ç§¯åˆ†æ•°ï¼ˆå¯é€‰ï¼‰</label>
                    <input 
                        type="number" 
                        v-model.number="agreementForm.max_points_per_day" 
                        placeholder="ä¸å¡«åˆ™æ— é™åˆ¶"
                        min="0"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>å•ç¬”è®¢å•æœ€å¤§å…‘æ¢ç§¯åˆ†æ•°ï¼ˆå¯é€‰ï¼‰</label>
                    <input 
                        type="number" 
                        v-model.number="agreementForm.max_points_per_order" 
                        placeholder="ä¸å¡«åˆ™æ— é™åˆ¶"
                        min="0"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>ç»“ç®—å‘¨æœŸ</label>
                    <select v-model="agreementForm.settlement_cycle" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="daily">æ¯æ—¥ç»“ç®—</option>
                        <option value="weekly">æ¯å‘¨ç»“ç®—</option>
                        <option value="monthly">æ¯æœˆç»“ç®—</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>è”ç³»äººï¼ˆå¯é€‰ï¼‰</label>
                    <input 
                        type="text" 
                        v-model="agreementForm.contact_person" 
                        placeholder="ç¬¬ä¸‰æ–¹è”ç³»äººå§“å"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>è”ç³»ç”µè¯ï¼ˆå¯é€‰ï¼‰</label>
                    <input 
                        type="text" 
                        v-model="agreementForm.contact_phone" 
                        placeholder="ç¬¬ä¸‰æ–¹è”ç³»ç”µè¯"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea 
                        v-model="agreementForm.remarks" 
                        placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"
                        rows="3"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                    ></textarea>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" @click="createAgreement">åˆ›å»ºåè®®</button>
                    <button class="btn-secondary" @click="resetAgreementForm">é‡ç½®</button>
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                <h3>åè®®åˆ—è¡¨</h3>
                <div v-if="loading.agreements" class="loading">åŠ è½½ä¸­...</div>
                <div v-else-if="agreements.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>æš‚æ— åè®®è®°å½•</p>
                </div>
                <div v-else>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æœ¬åº—é“º</th>
                                <th>ç¬¬ä¸‰æ–¹å…¬å¸</th>
                                <th>åè®®ç±»å‹</th>
                                <th>å…‘æ¢æ¯”ä¾‹</th>
                                <th>çŠ¶æ€</th>
                                <th>ç»“ç®—ä½™é¢</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in agreements" :key="item.id">
                                <td>{{ item.id }}</td>
                                <td>{{ item.store_name }}</td>
                                <td>{{ item.third_party_name }}</td>
                                <td>{{ getAgreementTypeText(item.agreement_type) }}</td>
                                <td>{{ item.exchange_rate }}</td>
                                <td>
                                    <span class="status-badge" :class="'status-' + (item.status === 'active' ? 'completed' : 'pending')">
                                        {{ item.status }}
                                    </span>
                                </td>
                                <td>{{ item.settlement_balance }}</td>
                                <td>{{ formatDate(item.created_at) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ç§¯åˆ†å…‘æ¢ -->
            <div v-if="activeTab === 'exchanges'" class="section">
                <h2 class="section-title">ç§¯åˆ†å…‘æ¢</h2>
                <p class="section-description">
                    æ‰§è¡Œç¬¬ä¸‰æ–¹ç§¯åˆ†å…‘æ¢ï¼Œæ”¯æŒä¼šå‘˜ä½¿ç”¨ç¬¬ä¸‰æ–¹ç§¯åˆ†æˆ–å…‘æ¢ç¬¬ä¸‰æ–¹ç§¯åˆ†ã€‚
                </p>

                <div class="info-box">
                    <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong>ä¼šå‘˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹å…¬å¸çš„ç§¯åˆ†åœ¨æœ¬åº—é“ºæ¶ˆè´¹ï¼Œ
                    ä¹Ÿå¯ä»¥å°†æœ¬åº—é“ºç§¯åˆ†å…‘æ¢ä¸ºç¬¬ä¸‰æ–¹ç§¯åˆ†ã€‚ç³»ç»Ÿä¼šæ ¹æ®åè®®è‡ªåŠ¨è®¡ç®—å…‘æ¢æ¯”ä¾‹ã€‚
                </div>

                <h3>ç§¯åˆ†å…‘æ¢</h3>
                <div class="form-row">
                    <label>ç¬¬ä¸‰æ–¹åè®®</label>
                    <select v-model="exchangeForm.agreement_id" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">è¯·é€‰æ‹©åè®®</option>
                        <option v-for="agreement in agreements" :key="agreement.id" :value="agreement.id">
                            {{ agreement.third_party_name }} ({{ getAgreementTypeText(agreement.agreement_type) }})
                        </option>
                    </select>
                </div>

                <div class="form-row">
                    <label>ä¼šå‘˜æ‰‹æœºå·</label>
                    <input 
                        type="text" 
                        v-model="exchangeForm.member_phone" 
                        placeholder="è¯·è¾“å…¥ä¼šå‘˜æ‰‹æœºå·"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>å…‘æ¢ç±»å‹</label>
                    <select v-model="exchangeForm.exchange_type" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="inbound">ç¬¬ä¸‰æ–¹ç§¯åˆ† -> æœ¬æ–¹ç§¯åˆ†ï¼ˆå¢åŠ ä¼šå‘˜ç§¯åˆ†ï¼‰</option>
                        <option value="outbound">æœ¬æ–¹ç§¯åˆ† -> ç¬¬ä¸‰æ–¹ç§¯åˆ†ï¼ˆæ‰£é™¤ä¼šå‘˜ç§¯åˆ†ï¼‰</option>
                    </select>
                </div>

                <div class="form-row">
                    <label>ç§¯åˆ†æ•°é‡</label>
                    <input 
                        type="number" 
                        v-model.number="exchangeForm.points" 
                        placeholder="è¯·è¾“å…¥ç§¯åˆ†æ•°é‡"
                        min="1"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                    >
                </div>

                <div class="form-row">
                    <label>å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea 
                        v-model="exchangeForm.remarks" 
                        placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"
                        rows="3"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                    ></textarea>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" @click="exchangePoints">æ‰§è¡Œå…‘æ¢</button>
                    <button class="btn-secondary" @click="resetExchangeForm">é‡ç½®</button>
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                <h3>å…‘æ¢æ—¥å¿—</h3>
                <div v-if="loading.exchanges" class="loading">åŠ è½½ä¸­...</div>
                <div v-else-if="exchanges.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ”„</div>
                    <p>æš‚æ— å…‘æ¢è®°å½•</p>
                </div>
                <div v-else>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ä¼šå‘˜</th>
                                <th>åº—é“º</th>
                                <th>åè®®</th>
                                <th>å…‘æ¢ç±»å‹</th>
                                <th>æºç§¯åˆ†</th>
                                <th>ç›®æ ‡ç§¯åˆ†</th>
                                <th>çŠ¶æ€</th>
                                <th>æ—¥æœŸ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in exchanges" :key="item.id">
                                <td>{{ item.id }}</td>
                                <td>
                                    <div>{{ item.member_name || '-' }}</div>
                                    <div style="font-size: 12px; color: #999;">{{ item.member_phone }}</div>
                                </td>
                                <td>{{ item.store_name }}</td>
                                <td>{{ item.agreement_name }}</td>
                                <td>
                                    <span v-if="item.exchange_type === 'inbound'" style="color: #4caf50;">
                                        â† ç¬¬ä¸‰æ–¹
                                    </span>
                                    <span v-else style="color: #ff9800;">
                                        â†’ ç¬¬ä¸‰æ–¹
                                    </span>
                                </td>
                                <td>{{ item.source_points }}</td>
                                <td>{{ item.target_points }}</td>
                                <td>
                                    <span class="status-badge" :class="'status-' + item.status">
                                        {{ item.status }}
                                    </span>
                                </td>
                                <td>{{ formatDate(item.created_at) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>è·¨åº—é“ºç»“ç®—ç®¡ç†ç³»ç»Ÿ v1.0.0</p>
        </footer>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    activeTab: 'settlements',
                    API_BASE: '/api/settlement',
                    
                    // ç»Ÿè®¡æ•°æ®
                    statistics: {
                        cross_store_settlements: {},
                        third_party_exchanges: {},
                        agreements: {}
                    },
                    
                    // åº—é“ºåˆ—è¡¨
                    stores: [],
                    
                    // è·¨åº—é“ºç»“ç®—è¡¨å•
                    settlementForm: {
                        source_store_id: '',
                        target_store_id: '',
                        member_phone: '',
                        points: '',
                        settlement_rate: 1.0,
                        remarks: ''
                    },
                    
                    // ç¬¬ä¸‰æ–¹åè®®è¡¨å•
                    agreementForm: {
                        store_id: '',
                        third_party_name: '',
                        agreement_type: 'bidirectional',
                        exchange_rate: 1.0,
                        max_points_per_day: '',
                        max_points_per_order: '',
                        settlement_cycle: 'daily',
                        contact_person: '',
                        contact_phone: '',
                        remarks: ''
                    },
                    
                    // ç§¯åˆ†å…‘æ¢è¡¨å•
                    exchangeForm: {
                        agreement_id: '',
                        member_phone: '',
                        exchange_type: 'inbound',
                        points: '',
                        remarks: ''
                    },
                    
                    // æ•°æ®åˆ—è¡¨
                    settlements: [],
                    agreements: [],
                    exchanges: [],
                    
                    // åŠ è½½çŠ¶æ€
                    loading: {
                        settlements: false,
                        agreements: false,
                        exchanges: false
                    }
                };
            },
            
            mounted() {
                this.loadStatistics();
                this.loadStores();
                this.loadSettlements();
                this.loadAgreements();
                this.loadExchanges();
            },
            
            methods: {
                // åŠ è½½ç»Ÿè®¡æ•°æ®
                async loadStatistics() {
                    try {
                        const response = await fetch(`${this.API_BASE}/statistics`);
                        const data = await response.json();
                        this.statistics = data;
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                    }
                },
                
                // åŠ è½½åº—é“ºåˆ—è¡¨
                async loadStores() {
                    try {
                        const response = await fetch('/api/stores');
                        const data = await response.json();
                        this.stores = data.stores || [];
                    } catch (error) {
                        console.error('åŠ è½½åº—é“ºåˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                
                // åŠ è½½ç»“ç®—è®°å½•
                async loadSettlements() {
                    this.loading.settlements = true;
                    try {
                        const response = await fetch(`${this.API_BASE}/store/list`);
                        const data = await response.json();
                        this.settlements = data.data || [];
                    } catch (error) {
                        console.error('åŠ è½½ç»“ç®—è®°å½•å¤±è´¥:', error);
                    } finally {
                        this.loading.settlements = false;
                    }
                },
                
                // åŠ è½½åè®®åˆ—è¡¨
                async loadAgreements() {
                    this.loading.agreements = true;
                    try {
                        const response = await fetch(`${this.API_BASE}/third-party-agreements`);
                        const data = await response.json();
                        this.agreements = data.data || [];
                    } catch (error) {
                        console.error('åŠ è½½åè®®åˆ—è¡¨å¤±è´¥:', error);
                    } finally {
                        this.loading.agreements = false;
                    }
                },
                
                // åŠ è½½å…‘æ¢æ—¥å¿—
                async loadExchanges() {
                    this.loading.exchanges = true;
                    try {
                        const response = await fetch(`${this.API_BASE}/exchange-logs`);
                        const data = await response.json();
                        this.exchanges = data.data || [];
                    } catch (error) {
                        console.error('åŠ è½½å…‘æ¢æ—¥å¿—å¤±è´¥:', error);
                    } finally {
                        this.loading.exchanges = false;
                    }
                },
                
                // åˆ›å»ºè·¨åº—é“ºç»“ç®—
                async createSettlement() {
                    // éªŒè¯è¡¨å•
                    if (!this.settlementForm.source_store_id) {
                        alert('è¯·é€‰æ‹©ç§¯åˆ†æ¥æºåº—é“º');
                        return;
                    }
                    if (!this.settlementForm.target_store_id) {
                        alert('è¯·é€‰æ‹©ç§¯åˆ†ç›®æ ‡åº—é“º');
                        return;
                    }
                    if (this.settlementForm.source_store_id === this.settlementForm.target_store_id) {
                        alert('æ¥æºåº—é“ºå’Œç›®æ ‡åº—é“ºä¸èƒ½ç›¸åŒ');
                        return;
                    }
                    if (!this.settlementForm.member_phone) {
                        alert('è¯·è¾“å…¥ä¼šå‘˜æ‰‹æœºå·');
                        return;
                    }
                    if (!this.settlementForm.points || this.settlementForm.points <= 0) {
                        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°é‡');
                        return;
                    }
                    
                    // å…ˆè·å–ä¼šå‘˜ID
                    try {
                        const memberResponse = await fetch(`/api/member/phone/${this.settlementForm.member_phone}`);
                        if (!memberResponse.ok) {
                            alert('ä¼šå‘˜ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå·');
                            return;
                        }
                        const memberData = await memberResponse.json();
                        const member_id = memberData.member.id;
                        
                        // åˆ›å»ºç»“ç®—
                        const settlementData = {
                            source_store_id: this.settlementForm.source_store_id,
                            target_store_id: this.settlementForm.target_store_id,
                            member_id: member_id,
                            points: this.settlementForm.points,
                            settlement_rate: this.settlementForm.settlement_rate || 1.0,
                            remarks: this.settlementForm.remarks
                        };
                        
                        const response = await fetch(`${this.API_BASE}/store`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(settlementData)
                        });
                        
                        if (response.ok) {
                            alert('è·¨åº—é“ºç»“ç®—åˆ›å»ºæˆåŠŸï¼');
                            this.resetSettlementForm();
                            this.loadSettlements();
                            this.loadStatistics();
                        } else {
                            const error = await response.json();
                            alert('åˆ›å»ºå¤±è´¥ï¼š' + (error.detail || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        console.error('åˆ›å»ºç»“ç®—å¤±è´¥:', error);
                        alert('åˆ›å»ºå¤±è´¥ï¼š' + error.message);
                    }
                },
                
                // åˆ›å»ºç¬¬ä¸‰æ–¹åè®®
                async createAgreement() {
                    // éªŒè¯è¡¨å•
                    if (!this.agreementForm.store_id) {
                        alert('è¯·é€‰æ‹©æœ¬åº—é“º');
                        return;
                    }
                    if (!this.agreementForm.third_party_name) {
                        alert('è¯·è¾“å…¥ç¬¬ä¸‰æ–¹å…¬å¸åç§°');
                        return;
                    }
                    if (!this.agreementForm.exchange_rate || this.agreementForm.exchange_rate <= 0) {
                        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å…‘æ¢æ¯”ä¾‹');
                        return;
                    }
                    
                    try {
                        const response = await fetch(`${this.API_BASE}/third-party-agreements`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.agreementForm)
                        });
                        
                        if (response.ok) {
                            alert('ç¬¬ä¸‰æ–¹åè®®åˆ›å»ºæˆåŠŸï¼');
                            this.resetAgreementForm();
                            this.loadAgreements();
                            this.loadStatistics();
                        } else {
                            const error = await response.json();
                            alert('åˆ›å»ºå¤±è´¥ï¼š' + (error.detail || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        console.error('åˆ›å»ºåè®®å¤±è´¥:', error);
                        alert('åˆ›å»ºå¤±è´¥ï¼š' + error.message);
                    }
                },
                
                // ç§¯åˆ†å…‘æ¢
                async exchangePoints() {
                    // éªŒè¯è¡¨å•
                    if (!this.exchangeForm.agreement_id) {
                        alert('è¯·é€‰æ‹©ç¬¬ä¸‰æ–¹åè®®');
                        return;
                    }
                    if (!this.exchangeForm.member_phone) {
                        alert('è¯·è¾“å…¥ä¼šå‘˜æ‰‹æœºå·');
                        return;
                    }
                    if (!this.exchangeForm.points || this.exchangeForm.points <= 0) {
                        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°é‡');
                        return;
                    }
                    
                    // å…ˆè·å–ä¼šå‘˜ID
                    try {
                        const memberResponse = await fetch(`/api/member/phone/${this.exchangeForm.member_phone}`);
                        if (!memberResponse.ok) {
                            alert('ä¼šå‘˜ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå·');
                            return;
                        }
                        const memberData = await memberResponse.json();
                        
                        // è·å–åè®®ä¿¡æ¯
                        const agreement = this.agreements.find(a => a.id === this.exchangeForm.agreement_id);
                        if (!agreement) {
                            alert('åè®®ä¸å­˜åœ¨');
                            return;
                        }
                        
                        // æ‰§è¡Œå…‘æ¢
                        const exchangeData = {
                            member_id: memberData.member.id,
                            store_id: agreement.store_id,
                            agreement_id: this.exchangeForm.agreement_id,
                            exchange_type: this.exchangeForm.exchange_type,
                            points: this.exchangeForm.points,
                            remarks: this.exchangeForm.remarks
                        };
                        
                        const response = await fetch(`${this.API_BASE}/exchange-points`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(exchangeData)
                        });
                        
                        if (response.ok) {
                            alert('ç§¯åˆ†å…‘æ¢æˆåŠŸï¼');
                            this.resetExchangeForm();
                            this.loadExchanges();
                            this.loadStatistics();
                        } else {
                            const error = await response.json();
                            alert('å…‘æ¢å¤±è´¥ï¼š' + (error.detail || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        console.error('ç§¯åˆ†å…‘æ¢å¤±è´¥:', error);
                        alert('å…‘æ¢å¤±è´¥ï¼š' + error.message);
                    }
                },
                
                // é‡ç½®è¡¨å•
                resetSettlementForm() {
                    this.settlementForm = {
                        source_store_id: '',
                        target_store_id: '',
                        member_phone: '',
                        points: '',
                        settlement_rate: 1.0,
                        remarks: ''
                    };
                },
                
                resetAgreementForm() {
                    this.agreementForm = {
                        store_id: '',
                        third_party_name: '',
                        agreement_type: 'bidirectional',
                        exchange_rate: 1.0,
                        max_points_per_day: '',
                        max_points_per_order: '',
                        settlement_cycle: 'daily',
                        contact_person: '',
                        contact_phone: '',
                        remarks: ''
                    };
                },
                
                resetExchangeForm() {
                    this.exchangeForm = {
                        agreement_id: '',
                        member_phone: '',
                        exchange_type: 'inbound',
                        points: '',
                        remarks: ''
                    };
                },
                
                // æ ¼å¼åŒ–æ—¥æœŸ
                formatDate(dateString) {
                    if (!dateString) return '-';
                    const date = new Date(dateString);
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                
                // è·å–åè®®ç±»å‹æ–‡æœ¬
                getAgreementTypeText(type) {
                    const typeMap = {
                        'bidirectional': 'åŒå‘äº’é€š',
                        'inbound': 'åªè¿›',
                        'outbound': 'åªå‡º'
                    };
                    return typeMap[type] || type;
                }
            }
        });
    </script>
</body>
</html>
