<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁôªÂΩï - Login</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
    <script src="https://cdn.jsdelivr.net/npm/element-plus/dist/index.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 60px 50px;
            width: 100%;
            max-width: 420px;
            position: relative;
        }

        .language-switch {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .language-switch button {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .language-switch button:hover {
            background: #667eea;
            color: white;
        }

        .language-switch button.active {
            background: #667eea;
            color: white;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo h1 {
            font-size: 28px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .logo p {
            color: #999;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            outline: none;
        }

        .form-group input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .login-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .forgot-password {
            text-align: center;
            margin-top: 20px;
        }

        .forgot-password a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .divider {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e0e0;
        }

        .divider span {
            background: white;
            padding: 0 20px;
            position: relative;
            color: #999;
            font-size: 14px;
        }

        .demo-accounts {
            margin-top: 30px;
        }

        .demo-accounts h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .demo-account {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .demo-account:hover {
            background: #f0f0f0;
            border-color: #667eea;
        }

        .demo-account-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .demo-account-info {
            flex: 1;
        }

        .demo-account-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .demo-account-credentials {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        .back-link {
            text-align: center;
            margin-top: 20px;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 40px 30px;
                margin: 20px;
            }

            .logo h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="login-container">
            <!-- ËØ≠Ë®ÄÂàáÊç¢ -->
            <div class="language-switch">
                <button
                    :class="{ active: currentLanguage === 'zh' }"
                    @click="switchLanguage('zh')"
                >
                    ‰∏≠Êñá
                </button>
                <button
                    :class="{ active: currentLanguage === 'en' }"
                    @click="switchLanguage('en')"
                >
                    EN
                </button>
            </div>

            <!-- Logo -->
            <div class="logo">
                <h1>{{ texts.logoTitle }}</h1>
                <p>{{ texts.logoSubtitle }}</p>
            </div>

            <!-- ÁôªÂΩïË°®Âçï -->
            <div class="form-group">
                <label>{{ texts.usernameLabel }}</label>
                <input
                    type="text"
                    v-model="form.username"
                    :placeholder="texts.usernamePlaceholder"
                    @keyup.enter="handleLogin"
                >
            </div>

            <div class="form-group">
                <label>{{ texts.passwordLabel }}</label>
                <input
                    type="password"
                    v-model="form.password"
                    :placeholder="texts.passwordPlaceholder"
                    @keyup.enter="handleLogin"
                    show-password
                >
            </div>

            <button
                class="login-button"
                @click="handleLogin"
                :disabled="loading"
            >
                {{ loading ? texts.loading : texts.loginButton }}
            </button>

            <div class="forgot-password">
                <a href="#" @click.prevent="showForgotPassword">{{ texts.forgotPassword }}</a>
            </div>

            <!-- ÂàÜÈöîÁ∫ø -->
            <div class="divider">
                <span>{{ texts.divider }}</span>
            </div>

            <!-- ÊºîÁ§∫Ë¥¶Âè∑ -->
            <div class="demo-accounts">
                <h3>{{ texts.demoAccountsTitle }}</h3>

                <div
                    class="demo-account"
                    v-for="user in demoUsers"
                    :key="user.username"
                    @click="useDemoAccount(user)"
                >
                    <div class="demo-account-icon">{{ user.icon }}</div>
                    <div class="demo-account-info">
                        <div class="demo-account-name">{{ user.name[currentLanguage] }}</div>
                        <div class="demo-account-credentials">{{ texts.username }}: {{ user.username }} | {{ texts.password }}: {{ user.password }}</div>
                    </div>
                </div>
            </div>

            <!-- ËøîÂõûÈ¶ñÈ°µ -->
            <div class="back-link">
                <a href="index.html">‚Üê {{ texts.backToHome }}</a>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, onMounted } = Vue;

        createApp({
            setup() {
                const currentLanguage = ref('zh');
                const loading = ref(false);
                const users = ref([]);
                const apiBase = ref('');

                const form = reactive({
                    username: '',
                    password: ''
                });

                // ‰∏≠Ëã±ÊñáÊñáÊú¨
                const textsMap = {
                    zh: {
                        logoTitle: 'Êâ´Á†ÅÁÇπÈ§êÁ≥ªÁªü',
                        logoSubtitle: 'Â∑•‰Ωú‰∫∫ÂëòÁôªÂΩï',
                        usernameLabel: 'Áî®Êà∑Âêç',
                        usernamePlaceholder: 'ËØ∑ËæìÂÖ•Áî®Êà∑Âêç',
                        passwordLabel: 'ÂØÜÁ†Å',
                        passwordPlaceholder: 'ËØ∑ËæìÂÖ•ÂØÜÁ†Å',
                        loginButton: 'ÁôªÂΩï',
                        loading: 'ÁôªÂΩï‰∏≠...',
                        forgotPassword: 'ÂøòËÆ∞ÂØÜÁ†ÅÔºü',
                        divider: 'Êàñ‰ΩøÁî®ÊºîÁ§∫Ë¥¶Âè∑',
                        demoAccountsTitle: 'ÊºîÁ§∫Ë¥¶Âè∑',
                        username: 'Áî®Êà∑Âêç',
                        password: 'ÂØÜÁ†Å',
                        backToHome: 'ËøîÂõûÈ¶ñÈ°µ',
                        loginSuccess: 'ÁôªÂΩïÊàêÂäü',
                        loginFailed: 'Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ',
                        errorOccurred: 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï'
                    },
                    en: {
                        logoTitle: 'Restaurant POS System',
                        logoSubtitle: 'Staff Login',
                        usernameLabel: 'Username',
                        usernamePlaceholder: 'Enter username',
                        passwordLabel: 'Password',
                        passwordPlaceholder: 'Enter password',
                        loginButton: 'Login',
                        loading: 'Logging in...',
                        forgotPassword: 'Forgot password?',
                        divider: 'Or use demo accounts',
                        demoAccountsTitle: 'Demo Accounts',
                        username: 'Username',
                        password: 'Password',
                        backToHome: 'Back to Home',
                        loginSuccess: 'Login successful',
                        loginFailed: 'Invalid username or password',
                        errorOccurred: 'Login failed, please try again later'
                    }
                };

                // ÊºîÁ§∫Áî®Êà∑
                const demoUsers = [
                    {
                        username: 'system_admin',
                        password: 'admin123',
                        icon: 'üëë',
                        name: {
                            zh: 'Á≥ªÁªüÁÆ°ÁêÜÂëò',
                            en: 'System Admin'
                        },
                        role: 'system_admin'
                    },
                    {
                        username: 'company',
                        password: 'company123',
                        icon: 'üè¢',
                        name: {
                            zh: 'ÊÄªÂÖ¨Âè∏',
                            en: 'Company HQ'
                        },
                        role: 'company'
                    },
                    {
                        username: 'admin',
                        password: 'admin123',
                        icon: 'üëî',
                        name: {
                            zh: 'Â∫óÈïø',
                            en: 'Manager'
                        },
                        role: 'manager'
                    },
                    {
                        username: 'chef',
                        password: 'chef123',
                        icon: 'üë®‚Äçüç≥',
                        name: {
                            zh: 'Âé®Â∏à',
                            en: 'Chef'
                        },
                        role: 'chef'
                    },
                    {
                        username: 'waiter',
                        password: 'waiter123',
                        icon: 'ü§µ',
                        name: {
                            zh: '‰º†ËèúÂëò',
                            en: 'Waiter'
                        },
                        role: 'waiter'
                    },
                    {
                        username: 'cashier',
                        password: 'cashier123',
                        icon: 'üí∞',
                        name: {
                            zh: 'Êî∂Èì∂Âëò',
                            en: 'Cashier'
                        },
                        role: 'cashier'
                    }
                ];

                // Ê£ÄÊµã API Âú∞ÂùÄ
                const detectApiBase = () => {
                    if (window.location.hostname.includes('netlify.app')) {
                        return 'http://9.128.251.82:8000/api';
                    } else if (window.location.hostname === 'localhost') {
                        return 'http://localhost:8000/api';
                    }
                    return 'http://localhost:8000/api';
                };

                // Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆ
                const loadUsers = async () => {
                    try {
                        const response = await fetch('config/users.json');
                        if (response.ok) {
                            users.value = await response.json();
                        } else {
                            // Â¶ÇÊûúÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÊºîÁ§∫Áî®Êà∑
                            users.value = demoUsers.map(user => ({
                                username: user.username,
                                password: user.password,
                                role: user.role,
                                name: user.name
                            }));
                        }
                    } catch (error) {
                        console.log('Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÊºîÁ§∫Ë¥¶Âè∑');
                        users.value = demoUsers.map(user => ({
                            username: user.username,
                            password: user.password,
                            role: user.role,
                            name: user.name
                        }));
                    }
                };

                // ËÆ°ÁÆóÂΩìÂâçËØ≠Ë®ÄÊñáÊú¨
                const texts = Vue.computed(() => textsMap[currentLanguage.value]);

                // ÂàáÊç¢ËØ≠Ë®Ä
                const switchLanguage = (lang) => {
                    currentLanguage.value = lang;
                    localStorage.setItem('language', lang);
                };

                // ‰ΩøÁî®ÊºîÁ§∫Ë¥¶Âè∑
                const useDemoAccount = (user) => {
                    form.username = user.username;
                    form.password = user.password;
                };

                // ÁôªÂΩïÂ§ÑÁêÜ
                const handleLogin = async () => {
                    if (!form.username || !form.password) {
                        alert(texts.value.usernameLabel + 'Âíå' + texts.value.passwordLabel + '‰∏çËÉΩ‰∏∫Á©∫');
                        return;
                    }

                    loading.value = true;

                    try {
                        // ÂÖàÂ∞ùËØïÊú¨Âú∞È™åËØÅ
                        const localUser = users.value.find(
                            u => u.username === form.username && u.password === form.password
                        );

                        if (localUser) {
                            // Êú¨Âú∞È™åËØÅÊàêÂäü
                            localStorage.setItem('currentUser', JSON.stringify({
                                username: localUser.username,
                                role: localUser.role,
                                name: localUser.name?.zh || localUser.username,
                                loginTime: new Date().toISOString()
                            }));

                            ElementPlus.ElMessage.success(texts.value.loginSuccess);

                            // Âª∂ËøüË∑≥ËΩ¨
                            setTimeout(() => {
                                window.location.href = 'staff_workflow.html';
                            }, 500);
                            return;
                        }

                        // Â∞ùËØï API È™åËØÅ
                        const response = await fetch(`${apiBase.value}/auth/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                username: form.username,
                                password: form.password
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();

                            localStorage.setItem('currentUser', JSON.stringify({
                                username: data.username,
                                role: data.role,
                                name: data.name || data.username,
                                token: data.token,
                                loginTime: new Date().toISOString()
                            }));

                            ElementPlus.ElMessage.success(texts.value.loginSuccess);

                            setTimeout(() => {
                                window.location.href = 'staff_workflow.html';
                            }, 500);
                        } else {
                            ElementPlus.ElMessage.error(texts.value.loginFailed);
                        }
                    } catch (error) {
                        console.error('ÁôªÂΩïÈîôËØØ:', error);
                        ElementPlus.ElMessage.error(texts.value.errorOccurred);
                    } finally {
                        loading.value = false;
                    }
                };

                // ÂøòËÆ∞ÂØÜÁ†Å
                const showForgotPassword = () => {
                    alert(texts.value.forgotPassword + '\n\nËØ∑ËÅîÁ≥ªÁ≥ªÁªüÁÆ°ÁêÜÂëòÈáçÁΩÆÂØÜÁ†Å\n\nPlease contact system administrator to reset password');
                };

                // ÂàùÂßãÂåñ
                onMounted(() => {
                    // ‰ªéÊú¨Âú∞Â≠òÂÇ®ËØªÂèñËØ≠Ë®ÄËÆæÁΩÆ
                    const savedLanguage = localStorage.getItem('language');
                    if (savedLanguage) {
                        currentLanguage.value = savedLanguage;
                    }

                    // Ê£ÄÊµã API Âú∞ÂùÄ
                    apiBase.value = detectApiBase();

                    // Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆ
                    loadUsers();

                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï
                    const currentUser = localStorage.getItem('currentUser');
                    if (currentUser) {
                        // Â∑≤ÁôªÂΩïÔºåÁõ¥Êé•Ë∑≥ËΩ¨
                        window.location.href = 'staff_workflow.html';
                    }
                });

                return {
                    currentLanguage,
                    loading,
                    texts,
                    form,
                    demoUsers,
                    switchLanguage,
                    useDemoAccount,
                    handleLogin,
                    showForgotPassword
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
