# 多店铺扫码点餐系统 - 测试平台

## 🎯 项目概述

这是一个完整的餐饮点餐系统测试平台，支持你扮演不同角色进行全流程模拟测试，包括：

- **👤 顾客端** - 扫码点餐、浏览菜单、下单支付
- **👨‍🍳 厨师端** - 查看待制作订单、制作菜品、语音确认
- **🤵 传菜员端** - 查看待传菜品、在顾客面前确认上菜
- **💰 收银员端** - 处理支付、打印小票
- **👔 店长端** - 查看运营数据、订单管理

## 📁 项目结构

```
workspace/projects/
├── assets/
│   ├── restaurant_full_test.html      # 完整测试页面（主文件）
│   └── TEST_SYSTEM_GUIDE.md          # 详细测试指南
├── scripts/
│   ├── start_restaurant_api.py        # API服务启动脚本
│   ├── start_test_system.sh           # Linux/Mac启动脚本
│   ├── start_test_system.bat          # Windows启动脚本
│   └── quick_test.py                  # 快速功能测试脚本
└── src/
    └── api/
        └── restaurant_api.py          # 后端API服务
```

## 🚀 快速开始

### 方法1：使用启动脚本（推荐）

**Linux/Mac:**
```bash
cd /workspace/projects
bash scripts/start_test_system.sh
```

**Windows:**
```bash
cd workspace\projects
scripts\start_test_system.bat
```

### 方法2：手动启动

```bash
# 1. 启动API服务
cd /workspace/projects
python scripts/start_restaurant_api.py

# 2. 在浏览器中打开测试页面
# 双击 assets/restaurant_full_test.html
# 或使用本地服务器:
cd assets
python -m http.server 8080
# 然后访问: http://localhost:8080/restaurant_full_test.html
```

### 方法3：运行快速测试

```bash
# 确保API服务已启动后，运行快速测试
python scripts/quick_test.py
```

## 📋 核心测试场景

### 场景1：顾客扫码点餐（8号桌）

```
顾客扫码 → 选择8号桌 → 浏览菜单 → 添加菜品到购物车 → 提交订单 → 选择支付方式
```

### 场景2：厨师制作菜品

```
查看待制作订单 → 开始制作 → 完成制作（点击按钮或语音确认）→ 打印制作单
```

### 场景3：传菜员上菜

```
查看待传菜品 → 打印传菜单 → 拿着菜品到8号桌 → 在顾客面前逐一确认上菜
```

### 场景4：收银员处理

```
查看支付状态 → 确认支付 → 打印小票
```

### 场景5：店长查看数据

```
查看统计数据 → 查看订单列表 → 查看桌位状态
```

## 🎮 功能特性

### 1. 多角色切换
- 顶部角色切换器，一键切换不同角色
- 每个角色有独立的界面和功能

### 2. 实时状态更新
- 每3秒自动刷新数据
- 确保各角色看到最新信息

### 3. 智能通知系统
- 顾客下单通知厨房
- 菜品完成通知传菜员
- 支付成功通知

### 4. 语音确认功能
- 厨师可以使用语音快速确认菜品完成
- 支持说出"完成"或"做好"

### 5. 打印功能
- 打印厨房制作单
- 打印传菜单
- 打印收银小票

### 6. 状态流转管理
- 严格的订单状态流转
- 精细的菜品状态管理
- 防止非法状态转换

## 📱 测试页面说明

### 角色切换器
位于页面顶部，显示5个角色按钮：
- 👤 顾客
- 👨‍🍳 厨师
- 🤵 传菜员
- 💰 收银员
- 👔 店长

点击按钮即可切换角色。

### 顾客端
- **桌号选择**：模拟扫码后选择桌号
- **菜单浏览**：按分类查看菜品
- **购物车**：查看已选商品，调整数量
- **订单提交**：一键提交订单

### 厨师端
- **待制作订单**：显示所有待制作的订单
- **菜品管理**：开始制作、完成制作
- **语音确认**：点击右下角麦克风按钮
- **打印功能**：打印制作单

### 传菜员端
- **待传菜品**：显示已完成的菜品
- **上菜确认**：逐一确认上菜
- **打印功能**：打印传菜单

### 收银员端
- **支付处理**：选择支付方式
- **小票打印**：打印收银小票

### 店长端
- **数据统计**：今日订单、营收、桌数
- **订单管理**：查看所有订单、取消订单
- **桌位状态**：查看桌位占用情况

## 🔍 状态流转说明

### 订单状态
```
pending（待确认） → confirmed（已确认） → preparing（准备中） → ready（已完成） → serving（上菜中） → completed（已完成）
                              ↓
                        cancelled（已取消）
```

### 菜品状态
```
pending（待制作） → preparing（制作中） → ready（已完成） → served（已上菜）
```

## 📊 测试检查清单

完成以下检查确保系统功能正常：

### 基础功能
- [ ] API服务正常启动
- [ ] 测试页面正常加载
- [ ] 角色切换功能正常

### 顾客端
- [ ] 能选择桌号
- [ ] 能浏览菜单
- [ ] 能添加菜品到购物车
- [ ] 能调整购物车商品数量
- [ ] 能提交订单
- [ ] 订单提交成功

### 厨师端
- [ ] 能看到待制作订单
- [ ] 能开始制作菜品
- [ ] 能完成菜品制作
- [ ] 语音确认功能正常
- [ ] 能打印制作单
- [ ] 能查看菜品状态

### 传菜员端
- [ ] 能看到待传菜品
- [ ] 能打印传菜单
- [ ] 能逐一确认上菜
- [ ] 上菜确认对话框正常
- [ ] 能完成订单

### 收银员端
- [ ] 能查看待支付订单
- [ ] 能选择支付方式
- [ ] 能处理支付
- [ ] 能打印小票

### 店长端
- [ ] 能查看统计数据
- [ ] 能查看订单列表
- [ ] 能查看订单详情
- [ ] 能取消订单
- [ ] 能查看桌位状态

### 高级功能
- [ ] 自动刷新功能正常
- [ ] 实时通知功能正常
- [ ] 多桌同时点餐正常
- [ ] 订单状态流转正常
- [ ] 菜品状态流转正常

## 🛠️ 故障排查

### 问题1：API服务无法启动

**可能原因：**
- 端口8000已被占用
- 依赖包未安装

**解决方法：**
```bash
# 检查端口占用
lsof -i:8000  # Linux/Mac
netstat -ano | findstr :8000  # Windows

# 安装依赖
pip install fastapi uvicorn sqlalchemy pydantic
```

### 问题2：测试页面无法加载数据

**可能原因：**
- API服务未启动
- 浏览器CORS限制

**解决方法：**
- 确保API服务正在运行
- 使用本地服务器访问测试页面

### 问题3：订单提交失败

**可能原因：**
- 未选择桌号
- 菜品库存不足
- 菜品已下架

**解决方法：**
- 确保已选择桌号
- 检查菜品库存
- 确认菜品上架状态

### 问题4：状态更新不生效

**可能原因：**
- 状态流转不符合规则
- 数据库连接问题

**解决方法：**
- 检查状态流转规则
- 查看控制台错误信息

## 📖 详细文档

- **[TEST_SYSTEM_GUIDE.md](assets/TEST_SYSTEM_GUIDE.md)** - 完整的测试场景和操作步骤
- **[restaurant_api.py](src/api/restaurant_api.py)** - API接口文档

## 🎯 测试建议

### 1. 单角色测试
先单独测试每个角色的功能，确保基础功能正常。

### 2. 端到端测试
模拟完整流程，从顾客下单到完成上菜。

### 3. 多角色并发测试
切换不同角色，同时进行操作，测试系统并发能力。

### 4. 异常情况测试
- 测试订单取消
- 测试库存不足
- 测试支付失败
- 测试状态非法流转

## 📞 技术支持

如有问题，请查看：
1. 控制台错误信息
2. API服务日志
3. 浏览器开发者工具

## 🎉 开始测试

一切准备就绪，现在可以开始测试了！

1. 启动API服务
2. 打开测试页面
3. 切换到顾客角色
4. 选择8号桌，开始点餐吧！

祝你测试愉快！🍽️
