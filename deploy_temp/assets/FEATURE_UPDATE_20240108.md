# 扫码点餐系统功能更新说明

## 更新日期
2024-01-08

## 更新内容

### 1. 顾客端支付方式优化 ✅

#### 1.1 支付方式选择
在购物车结算界面新增支付方式选择：
- **💳 马上支付**：在线支付（微信/支付宝），立即结算
- **🏪 用餐后柜台支付**：先用餐，离店时到收银台支付

#### 1.2 订单确认详情
- 购物车弹窗中显示完整的订单确认信息
- 商品数量、合计金额清晰展示
- 支付方式必选，防止误操作

#### 1.3 提交按钮优化
根据选择的支付方式显示不同的按钮文案：
- 马上支付：显示"立即支付 (¥XX)"
- 柜台支付：显示"确认下单，用餐后支付 (¥XX)"

### 2. 订单号生成系统 ✅

#### 2.1 订单号格式
采用 `日期+时间+随机数` 的格式，确保唯一性
- 格式：`YYYYMMDDHHMMSSXXX`
- 示例：`20240108143055001`
  - 20240108：日期（2024年1月8日）
  - 143055：时间（14:30:55）
  - 001：随机序号

#### 2.2 订单信息存储
订单信息保存到 localStorage，包含：
- 订单号
- 桌号
- 菜品详情
- 总金额
- 支付方式
- 支付状态
- 订单状态
- 创建时间

### 3. 工作人员端打印订单功能 ✅

#### 3.1 厨师订单打印
**功能入口**：工作人员端 → 厨师角色 → 订单卡片 → "🖨️ 打印订单"按钮

**打印内容**：
- 📋 订单标题（厨师订单）
- 🏪 店铺名称
- 📝 订单号（日期+序号格式）
- 🪑 桌号
- ⏰ 下单时间
- 📊 订单状态
- 🍽️ 菜品清单（菜品名称 + 数量）
- 📝 备注
- ⚠️ 支付提示（柜台支付时特别标记）

**特点**：
- 大字体，清晰易读
- 突出显示菜品数量
- 标注制作状态

#### 3.2 传菜员订单打印
**功能入口**：工作人员端 → 传菜员角色 → 订单卡片 → "🖨️ 打印订单"按钮

**打印内容**：
- 📋 订单标题（传菜员订单）
- 🏪 店铺名称
- 📝 订单号（日期+序号格式）
- 🪑 桌号
- ⏰ 下单时间
- 📊 订单状态
- 🍽️ 菜品清单（菜品名称 + 数量）
- 💰 订单总额
- 💳 支付方式
- ✅ 支付状态
- 📝 备注
- ⚠️ 支付提醒（柜台支付时提醒顾客到收银台）

**特点**：
- 包含金额信息
- 标注支付状态
- 提醒收银台支付

#### 3.3 打印样式优化
- 使用标准的打印样式
- A4纸张适配
- 字体大小适中（14px）
- 行距舒适，便于阅读
- 边距合理，节省纸张

### 4. 顾客端保持纯净 ✅

#### 4.1 确认无其他身份信息
- customer_order.html 只包含顾客点餐功能
- 不显示任何工作人员入口
- 不显示其他角色信息
- 符合扫码即用的场景需求

## 文件变更清单

### 修改的文件
1. `assets/customer_order.html`
   - 添加支付方式选择界面
   - 实现订单号生成逻辑
   - 优化购物车弹窗
   - 添加支付状态管理

2. `assets/staff_workflow.html`
   - 添加厨师打印订单按钮
   - 添加传菜员打印订单按钮
   - 实现 printKitchenOrder 方法
   - 实现 printWaiterOrder 方法
   - 实现 getOrderStatusText 方法

### 未修改的文件
- `assets/portal.html`（无变化）
- `assets/shop_settings.html`（无变化）
- `assets/menu_management.html`（无变化）
- `assets/inventory_management.html`（无变化）

## 使用说明

### 1. 顾客使用流程
1. 扫描桌号二维码
2. 选择桌号（自动识别）
3. 浏览菜单，选择菜品
4. 添加到购物车
5. 点击购物车栏
6. 查看购物车详情
7. 选择支付方式（马上支付/柜台支付）
8. 点击提交订单
9. 收到订单号和确认提示

### 2. 工作人员使用流程

#### 厨师
1. 登录工作人员端（厨师账号：chef / chef123）
2. 切换到厨师角色
3. 查看待制作订单
4. 点击"🖨️ 打印订单"按钮
5. 打印厨师订单（显示桌号、菜品、数量）
6. 开始制作

#### 传菜员
1. 登录工作人员端（传菜员账号：waiter / waiter123）
2. 切换到传菜员角色
3. 查看待传菜订单
4. 点击"🖨️ 打印订单"按钮
5. 打印传菜员订单（显示桌号、菜品、金额、支付状态）
6. 根据订单传菜

## 演示账号

### 工作人员账号
- 👑 店长：manager / manager123
- 👨‍🍳 厨师：chef / chef123
- 🤵 传菜员：waiter / waiter123
- 💰 收银员：cashier / cashier123

## 技术细节

### 1. 订单号生成算法
```javascript
const now = new Date();
const dateStr = now.toISOString().slice(0, 10).replace(/-/g, ''); // 20240108
const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, ''); // 143055
const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
const orderId = `${dateStr}${timeStr}${randomNum}`;
```

### 2. 支付方式枚举
```javascript
paymentMethod: 'immediate'  // 马上支付
paymentMethod: 'counter'   // 柜台支付
```

### 3. 打印订单方法
- `printKitchenOrder(order)` - 打印厨师订单
- `printWaiterOrder(order)` - 打印传菜员订单
- 使用 `window.open()` 打开新窗口
- 使用 `window.print()` 自动触发打印
- 使用 `window.onload` 确保打印对话框自动弹出

### 4. 数据存储
- 订单数据存储在 localStorage 中
- 键名：`orders`
- 数据格式：JSON数组
- 支持订单增删改查

## 测试建议

### 1. 功能测试
- [ ] 测试顾客扫码点餐流程
- [ ] 测试支付方式选择
- [ ] 测试订单号生成（检查唯一性）
- [ ] 测试购物车功能（增删改）
- [ ] 测试订单提交（localStorage存储）
- [ ] 测试厨师打印订单
- [ ] 测试传菜员打印订单
- [ ] 测试打印样式（打印预览）

### 2. 兼容性测试
- [ ] Chrome浏览器
- [ ] Firefox浏览器
- [ ] Safari浏览器
- [ ] Edge浏览器
- [ ] 移动端浏览器

### 3. 打印测试
- [ ] A4纸打印
- [ ] 热敏打印机打印
- [ ] 打印预览检查
- [ ] 打印样式检查

## 注意事项

1. **订单号唯一性**：当前实现基于时间戳和随机数，在高并发场景下可能存在重复风险，建议后端统一生成订单号。

2. **打印功能**：当前使用浏览器原生打印功能，需要允许弹出窗口。

3. **数据持久化**：订单数据存储在 localStorage，清除浏览器数据会丢失订单记录。

4. **支付集成**：当前为模拟支付，需要对接实际的支付接口（微信支付、支付宝）。

5. **角色权限**：不同角色看到的订单卡片和操作按钮不同，已做角色区分。

## 后续优化建议

1. **订单管理**：添加订单列表、订单详情、订单历史等功能
2. **打印模板**：支持自定义打印模板
3. **小票打印**：实现收银台小票打印功能
4. **支付对接**：对接微信支付、支付宝等支付接口
5. **数据同步**：实现前后端数据同步，避免数据不一致
6. **订单追踪**：添加订单实时追踪功能
7. **消息通知**：实现新订单、订单变更的实时通知
8. **报表统计**：添加订单统计、营收分析等功能

## 部署说明

### 1. 本地部署
无需特殊配置，直接打开 HTML 文件即可使用。

### 2. Netlify 部署
1. 将修改后的文件上传到 GitHub 仓库
2. 从 GitHub 拖拽部署到 Netlify
3. 访问门户页面：https://tiny-sprite-65833c.netlify.app/portal.html

### 3. 环境要求
- 现代浏览器（Chrome 90+、Firefox 88+、Safari 14+、Edge 90+）
- 支持本地存储（localStorage）
- 支持打印功能

## 联系与支持

如有问题或建议，请联系开发团队。
