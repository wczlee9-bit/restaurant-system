<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«ç ç‚¹é¤ç³»ç»Ÿ - æµ‹è¯•æ§åˆ¶å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            font-size: 22px;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 13px;
        }

        .system-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .system-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
        }

        .system-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .system-card.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .system-card h3 {
            color: #333;
            font-size: 14px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .system-card p {
            color: #666;
            font-size: 11px;
            line-height: 1.4;
        }

        .system-icon {
            font-size: 20px;
        }

        .test-area {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .test-area.active {
            display: block;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 13px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .form-group textarea {
            min-height: 80px;
            font-family: monospace;
            font-size: 11px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .response-box {
            margin-top: 12px;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 11px;
            overflow-x: auto;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .response-box.success {
            background: #f0fff4;
            border: 1px solid #48bb78;
            color: #2f855a;
            display: block;
        }

        .response-box.error {
            background: #fff5f5;
            border: 1px solid #f56565;
            color: #c53030;
            display: block;
        }

        .response-box.info {
            background: #ebf8ff;
            border: 1px solid #4299e1;
            color: #2b6cb0;
            display: block;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .status-badge.online {
            background: #f0fff4;
            color: #48bb78;
        }

        .status-badge.offline {
            background: #fff5f5;
            color: #f56565;
        }

        .config-section {
            background: #fffaf0;
            border: 1px solid #ed8936;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .config-section h4 {
            color: #744210;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
        }

        .toast {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            font-size: 13px;
            display: none;
        }

        .toast.success {
            background: #48bb78;
        }

        .toast.error {
            background: #f56565;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ æ‰«ç ç‚¹é¤ç³»ç»Ÿ - æµ‹è¯•æ§åˆ¶å°</h1>
            <p>å¿«é€Ÿæµ‹è¯•æƒé™ç®¡ç†ã€æ”¯ä»˜ã€å°ç¥¨ç­‰æ ¸å¿ƒåŠŸèƒ½</p>
        </div>

        <!-- APIé…ç½® -->
        <div class="config-section">
            <h4>âš™ï¸ APIåœ°å€é…ç½®</h4>
            <div class="config-grid">
                <div class="form-group">
                    <label>æƒé™ç®¡ç†API (8007)</label>
                    <input type="text" id="api-permission" value="http://localhost:8007">
                </div>
                <div class="form-group">
                    <label>æ”¯ä»˜API (8002)</label>
                    <input type="text" id="api-payment" value="http://localhost:8002">
                </div>
                <div class="form-group">
                    <label>å°ç¥¨API (8008)</label>
                    <input type="text" id="api-receipt" value="http://localhost:8008">
                </div>
                <div class="form-group">
                    <label>é¡¾å®¢ç«¯API (8003)</label>
                    <input type="text" id="api-customer" value="http://localhost:8003">
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿé€‰æ‹© -->
        <div class="system-grid">
            <div class="system-card" data-system="permission" onclick="selectSystem('permission')">
                <h3><span class="system-icon">ğŸ”</span> æƒé™ç®¡ç† <span class="status-badge" id="status-permission">å¾…æ£€æµ‹</span></h3>
                <p>è§’è‰²æƒé™ç®¡ç†ã€ç”¨æˆ·æƒé™æ£€æŸ¥</p>
            </div>
            <div class="system-card" data-system="payment" onclick="selectSystem('payment')">
                <h3><span class="system-icon">ğŸ’³</span> æ”¯ä»˜ç³»ç»Ÿ <span class="status-badge" id="status-payment">å¾…æ£€æµ‹</span></h3>
                <p>å¤šç§æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜è®°å½•ç®¡ç†</p>
            </div>
            <div class="system-card" data-system="receipt" onclick="selectSystem('receipt')">
                <h3><span class="system-icon">ğŸ§¾</span> å°ç¥¨æ‰“å° <span class="status-badge" id="status-receipt">å¾…æ£€æµ‹</span></h3>
                <p>å°ç¥¨æ‰“å°ã€æ¨¡æ¿é…ç½®ã€åŠŸèƒ½åŒº</p>
            </div>
            <div class="system-card" data-system="customer" onclick="selectSystem('customer')">
                <h3><span class="system-icon">ğŸ‘¤</span> é¡¾å®¢ç«¯ <span class="status-badge" id="status-customer">å¾…æ£€æµ‹</span></h3>
                <p>æ‰«ç ç‚¹é¤ã€èœå“æµè§ˆ</p>
            </div>
        </div>

        <!-- æƒé™ç®¡ç†æµ‹è¯•åŒº -->
        <div class="test-area" id="test-permission">
            <h2>ğŸ” æƒé™ç®¡ç†ç³»ç»Ÿæµ‹è¯•</h2>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="testInitRoles()">åˆå§‹åŒ–è§’è‰²</button>
                <button class="btn btn-success" onclick="testGetRoles()">è·å–è§’è‰²åˆ—è¡¨</button>
            </div>

            <div class="form-group">
                <label>æ£€æŸ¥ç”¨æˆ·æƒé™</label>
                <input type="text" id="check-role-id" placeholder="è§’è‰²IDï¼ˆå¦‚: adminï¼‰">
                <input type="text" id="check-permission" placeholder="æƒé™ï¼ˆå¦‚: order:createï¼‰" style="margin-top: 5px;">
                <button class="btn btn-primary" onclick="testCheckPermission()" style="margin-top: 5px;">æ£€æŸ¥æƒé™</button>
            </div>

            <div class="response-box" id="response-permission"></div>
        </div>

        <!-- æ”¯ä»˜ç³»ç»Ÿæµ‹è¯•åŒº -->
        <div class="test-area" id="test-payment">
            <h2>ğŸ’³ æ”¯ä»˜ç³»ç»Ÿæµ‹è¯•</h2>
            
            <div class="form-group">
                <label>åˆ›å»ºæ”¯ä»˜è®¢å•</label>
                <input type="text" id="pay-order-id" placeholder="è®¢å•ID">
                <input type="text" id="pay-amount" placeholder="é‡‘é¢" style="margin-top: 5px;">
                <select id="pay-method" style="margin-top: 5px;">
                    <option value="wechat">å¾®ä¿¡æ”¯ä»˜</option>
                    <option value="alipay">æ”¯ä»˜å®</option>
                    <option value="cash">ç°é‡‘</option>
                    <option value="credit_card">ä¿¡ç”¨å¡</option>
                    <option value="debit_card">å€Ÿè®°å¡</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <input type="text" id="pay-custom-name" placeholder="è‡ªå®šä¹‰æ”¯ä»˜åç§°ï¼ˆä»…å…¶ä»–ç±»å‹ï¼‰" style="margin-top: 5px; display: none;" id="custom-name-input">
                <button class="btn btn-primary" onclick="testCreatePayment()" style="margin-top: 5px;">åˆ›å»ºæ”¯ä»˜</button>
            </div>

            <div class="form-group">
                <label>æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€</label>
                <input type="text" id="query-payment-id" placeholder="æ”¯ä»˜ID">
                <button class="btn btn-success" onclick="testGetPayment()">æŸ¥è¯¢æ”¯ä»˜</button>
            </div>

            <div class="response-box" id="response-payment"></div>
        </div>

        <!-- å°ç¥¨æ‰“å°æµ‹è¯•åŒº -->
        <div class="test-area" id="test-receipt">
            <h2>ğŸ§¾ å°ç¥¨æ‰“å°ç³»ç»Ÿæµ‹è¯•</h2>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="testCreateTemplate()">åˆ›å»ºå°ç¥¨æ¨¡æ¿</button>
                <button class="btn btn-success" onclick="testGetTemplates()">è·å–æ¨¡æ¿åˆ—è¡¨</button>
            </div>

            <div class="form-group">
                <label>æ‰“å°å°ç¥¨</label>
                <input type="text" id="receipt-order-id" placeholder="è®¢å•ID">
                <input type="text" id="receipt-template-id" placeholder="æ¨¡æ¿ID" style="margin-top: 5px;">
                <button class="btn btn-warning" onclick="testPrintReceipt()" style="margin-top: 5px;">æ‰“å°å°ç¥¨</button>
            </div>

            <div class="response-box" id="response-receipt"></div>
        </div>

        <!-- é¡¾å®¢ç«¯æµ‹è¯•åŒº -->
        <div class="test-area" id="test-customer">
            <h2>ğŸ‘¤ é¡¾å®¢ç«¯ç³»ç»Ÿæµ‹è¯•</h2>
            
            <div class="form-group">
                <label>åˆ›å»ºè®¢å•</label>
                <input type="text" id="customer-store-id" placeholder="åº—é“ºID">
                <input type="text" id="customer-table-id" placeholder="æ¡Œå·" style="margin-top: 5px;">
                <textarea id="customer-items" placeholder='èœå“åˆ—è¡¨ï¼ˆJSONæ ¼å¼ï¼‰ï¼š[{"dish_id": 1, "quantity": 2}]' style="margin-top: 5px;"></textarea>
                <button class="btn btn-primary" onclick="testCreateOrder()" style="margin-top: 5px;">åˆ›å»ºè®¢å•</button>
            </div>

            <div class="form-group">
                <label>è·å–èœå•</label>
                <input type="text" id="menu-store-id" placeholder="åº—é“ºID">
                <button class="btn btn-success" onclick="testGetMenu()">è·å–èœå•</button>
            </div>

            <div class="response-box" id="response-customer"></div>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let selectedSystem = null;

        // é€‰æ‹©ç³»ç»Ÿ
        function selectSystem(system) {
            selectedSystem = system;
            
            // æ›´æ–°å¡ç‰‡æ ·å¼
            document.querySelectorAll('.system-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-system="${system}"]`).classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”æµ‹è¯•åŒºåŸŸ
            document.querySelectorAll('.test-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById(`test-${system}`).classList.add('active');
        }

        // æ˜¾ç¤ºToast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // æ˜¾ç¤ºå“åº”
        function showResponse(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `response-box ${type}`;
            element.textContent = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
        }

        // æ˜¾ç¤ºé”™è¯¯å“åº”
        function showErrorResponse(elementId, error) {
            showResponse(elementId, `é”™è¯¯: ${error.message || error}`, 'error');
        }

        // ========== æƒé™ç®¡ç†æµ‹è¯• ==========
        async function testInitRoles() {
            try {
                const url = document.getElementById('api-permission').value;
                const response = await fetch(`${url}/api/permission/init-roles`, {
                    method: 'POST'
                });
                const data = await response.json();
                showResponse('response-permission', data, 'success');
                showToast('è§’è‰²åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                showErrorResponse('response-permission', error);
                showToast('è§’è‰²åˆå§‹åŒ–å¤±è´¥', 'error');
            }
        }

        async function testGetRoles() {
            try {
                const url = document.getElementById('api-permission').value;
                const response = await fetch(`${url}/api/permission/roles`);
                const data = await response.json();
                showResponse('response-permission', data, 'success');
            } catch (error) {
                showErrorResponse('response-permission', error);
            }
        }

        async function testCheckPermission() {
            try {
                const url = document.getElementById('api-permission').value;
                const roleId = document.getElementById('check-role-id').value;
                const permission = document.getElementById('check-permission').value;

                const response = await fetch(`${url}/api/permission/check`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        role_id: roleId,
                        permission: permission
                    })
                });
                const data = await response.json();
                showResponse('response-permission', data, 'success');
            } catch (error) {
                showErrorResponse('response-permission', error);
            }
        }

        // ========== æ”¯ä»˜ç³»ç»Ÿæµ‹è¯• ==========
        async function testCreatePayment() {
            try {
                const url = document.getElementById('api-payment').value;
                const orderId = document.getElementById('pay-order-id').value;
                const amount = document.getElementById('pay-amount').value;
                const method = document.getElementById('pay-method').value;

                const response = await fetch(`${url}/api/payment/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        order_id: orderId,
                        amount: parseFloat(amount),
                        method: method
                    })
                });
                const data = await response.json();
                showResponse('response-payment', data, 'success');
                showToast('æ”¯ä»˜åˆ›å»ºæˆåŠŸ');
            } catch (error) {
                showErrorResponse('response-payment', error);
                showToast('æ”¯ä»˜åˆ›å»ºå¤±è´¥', 'error');
            }
        }

        async function testGetPayment() {
            try {
                const url = document.getElementById('api-payment').value;
                const paymentId = document.getElementById('query-payment-id').value;

                const response = await fetch(`${url}/api/payment/${paymentId}`);
                const data = await response.json();
                showResponse('response-payment', data, 'success');
            } catch (error) {
                showErrorResponse('response-payment', error);
            }
        }

        // ========== å°ç¥¨æ‰“å°æµ‹è¯• ==========
        async function testCreateTemplate() {
            try {
                const url = document.getElementById('api-receipt').value;
                const response = await fetch(`${url}/api/receipt/template`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: 'é»˜è®¤å°ç¥¨æ¨¡æ¿',
                        sections: ['header', 'content', 'footer']
                    })
                });
                const data = await response.json();
                showResponse('response-receipt', data, 'success');
                showToast('æ¨¡æ¿åˆ›å»ºæˆåŠŸ');
            } catch (error) {
                showErrorResponse('response-receipt', error);
                showToast('æ¨¡æ¿åˆ›å»ºå¤±è´¥', 'error');
            }
        }

        async function testGetTemplates() {
            try {
                const url = document.getElementById('api-receipt').value;
                const response = await fetch(`${url}/api/receipt/templates`);
                const data = await response.json();
                showResponse('response-receipt', data, 'success');
            } catch (error) {
                showErrorResponse('response-receipt', error);
            }
        }

        async function testPrintReceipt() {
            try {
                const url = document.getElementById('api-receipt').value;
                const orderId = document.getElementById('receipt-order-id').value;
                const templateId = document.getElementById('receipt-template-id').value;

                const response = await fetch(`${url}/api/receipt/print`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        order_id: orderId,
                        template_id: templateId
                    })
                });
                const data = await response.json();
                showResponse('response-receipt', data, 'success');
                showToast('å°ç¥¨æ‰“å°æˆåŠŸ');
            } catch (error) {
                showErrorResponse('response-receipt', error);
                showToast('å°ç¥¨æ‰“å°å¤±è´¥', 'error');
            }
        }

        // ========== é¡¾å®¢ç«¯æµ‹è¯• ==========
        async function testCreateOrder() {
            try {
                const url = document.getElementById('api-customer').value;
                const storeId = document.getElementById('customer-store-id').value;
                const tableId = document.getElementById('customer-table-id').value;
                const items = document.getElementById('customer-items').value;

                const response = await fetch(`${url}/api/customer/order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        store_id: parseInt(storeId),
                        table_id: tableId,
                        items: JSON.parse(items)
                    })
                });
                const data = await response.json();
                showResponse('response-customer', data, 'success');
                showToast('è®¢å•åˆ›å»ºæˆåŠŸ');
            } catch (error) {
                showErrorResponse('response-customer', error);
                showToast('è®¢å•åˆ›å»ºå¤±è´¥', 'error');
            }
        }

        async function testGetMenu() {
            try {
                const url = document.getElementById('api-customer').value;
                const storeId = document.getElementById('menu-store-id').value;

                const response = await fetch(`${url}/api/customer/menu/${storeId}`);
                const data = await response.json();
                showResponse('response-customer', data, 'success');
            } catch (error) {
                showErrorResponse('response-customer', error);
            }
        }

        // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªç³»ç»Ÿ
        selectSystem('permission');
    </script>
</body>
</html>
