# 多店铺扫码点餐系统 - 完整测试手册

## 测试环境准备

### 前提条件
- 系统已部署到服务器并正常运行
- 服务地址：`http://your-server-ip:8080`
- 或本地测试地址：`http://127.0.0.1:8080`
- 数据库已初始化并包含测试数据

### 测试工具推荐
- **Postman**：[下载地址](https://www.postman.com/downloads/)
- **cURL**：命令行工具
- **浏览器**：用于 GET 请求

---

## 测试1：客户点餐流程

### 测试目标
验证顾客从扫码到下单的完整流程

---

### 步骤 1.1：获取店铺信息

**测试目的**：验证店铺信息接口

**请求信息**：
```
GET /api/store
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/store
```

**预期结果**：
```json
{
  "id": 2,
  "name": "示范餐厅",
  "address": "北京市朝阳区示范路1号",
  "phone": "010-12345678",
  "opening_hours": {
    "open": "09:00",
    "close": "22:00"
  }
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回店铺名称、地址、电话、营业时间
- ✅ 数据格式正确

---

### 步骤 1.2：获取桌号列表

**测试目的**：验证桌号查询接口

**请求信息**：
```
GET /api/tables/
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/tables/
```

**预期结果**：
```json
[
  {
    "id": 45,
    "table_number": "1",
    "seats": 2,
    "is_active": true,
    "is_occupied": false
  },
  {
    "id": 46,
    "table_number": "2",
    "seats": 4,
    "is_active": true,
    "is_occupied": false
  }
  ...
]
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回桌号列表
- ✅ 包含桌号、座位数、占用状态

**测试记录**：
- 选择一个桌号进行后续测试，例如：`table_id = 55`（桌号8）

---

### 步骤 1.3：获取菜品列表

**测试目的**：验证菜品查询接口

**请求信息**：
```
GET /api/menu-items/
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/menu-items/
```

**预期结果**：
```json
[
  {
    "id": 1,
    "name": "宫保鸡丁",
    "description": "经典川菜",
    "price": 38.0,
    "category_id": 1,
    "category_name": "热菜",
    "stock": 100,
    "is_available": true,
    "is_recommended": true,
    "sort_order": 1
  },
  {
    "id": 2,
    "name": "鱼香肉丝",
    "description": "酸甜可口",
    "price": 32.0,
    "category_id": 1,
    "category_name": "热菜",
    "stock": 100,
    "is_available": true,
    "is_recommended": true,
    "sort_order": 2
  }
  ...
]
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回菜品列表
- ✅ 包含菜品名称、价格、库存、分类

**测试记录**：
- 选择 2-3 个菜品进行下单：
  - 菜品ID: 2（鱼香肉丝，¥32）
  - 菜品ID: 3（麻婆豆腐，¥28）
  - 菜品ID: 4（回锅肉，¥35）

---

### 步骤 1.4：创建订单

**测试目的**：验证下单接口

**请求信息**：
```
POST /api/orders/
Content-Type: application/json
```

**请求体**：
```json
{
  "table_id": 55,
  "items": [
    {
      "menu_item_id": 2,
      "quantity": 1,
      "special_instructions": "少辣"
    },
    {
      "menu_item_id": 3,
      "quantity": 1,
      "special_instructions": ""
    }
  ]
}
```

**使用 cURL**：
```bash
curl -X POST http://127.0.0.1:8080/api/orders/ \
  -H "Content-Type: application/json" \
  -d '{
    "table_id": 55,
    "items": [
      {
        "menu_item_id": 2,
        "quantity": 1,
        "special_instructions": "少辣"
      },
      {
        "menu_item_id": 3,
        "quantity": 1,
        "special_instructions": ""
      }
    ]
  }'
```

**预期结果**：
```json
{
  "id": 77,
  "order_number": "ORD202602061932134940",
  "store_id": 2,
  "table_id": 55,
  "table_number": "8",
  "total_amount": 60.0,
  "payment_method": "",
  "payment_status": "unpaid",
  "status": "pending",
  "created_at": "2026-02-06T19:32:13.002902+08:00",
  "items": [
    {
      "id": 193,
      "menu_item_id": 2,
      "menu_item_name": "鱼香肉丝",
      "price": 32.0,
      "quantity": 1,
      "subtotal": 32.0,
      "special_instructions": "少辣",
      "item_status": "pending"
    },
    {
      "id": 194,
      "menu_item_id": 3,
      "menu_item_name": "麻婆豆腐",
      "price": 28.0,
      "quantity": 1,
      "subtotal": 28.0,
      "special_instructions": "",
      "item_status": "pending"
    }
  ]
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回订单ID和订单号
- ✅ 总金额计算正确（32 + 28 = 60）
- ✅ 订单状态为 `pending`
- ✅ 支付状态为 `unpaid`
- ✅ 特殊要求已记录

**测试记录**：
- 记录订单ID：`order_id = 77`
- 记录订单号：`ORD202602061932134940`

---

### 步骤 1.5：查看订单状态

**测试目的**：验证订单详情查询接口

**请求信息**：
```
GET /api/orders/{order_id}
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/orders/77
```

**预期结果**：
```json
{
  "id": 77,
  "order_number": "ORD202602061932134940",
  "status": "pending",
  "total_amount": 60.0,
  "payment_status": "unpaid",
  "items": [...]
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 订单信息完整
- ✅ 菜品状态为 `pending`

---

## 测试2：厨师做菜流程

### 测试目标
验证厨师接收订单、更新菜品状态的流程

---

### 步骤 2.1：获取待制作订单

**测试目的**：验证待处理订单查询接口

**请求信息**：
```
GET /api/orders/?status=pending
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/orders/?status=pending
```

**预期结果**：
```json
[
  {
    "id": 77,
    "order_number": "ORD202602061932134940",
    "table_number": "8",
    "total_amount": 60.0,
    "status": "pending",
    "items": [...]
  }
]
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回待制作订单列表
- ✅ 包含刚创建的订单

---

### 步骤 2.2：更新订单状态为制作中

**测试目的**：验证订单状态更新接口

**请求信息**：
```
PUT /api/orders/{order_id}/status
Content-Type: application/json
```

**请求体**：
```json
{
  "status": "preparing"
}
```

**使用 cURL**：
```bash
curl -X PUT http://127.0.0.1:8080/api/orders/77/status \
  -H "Content-Type: application/json" \
  -d '{"status": "preparing"}'
```

**预期结果**：
```json
{
  "message": "订单状态更新成功",
  "order_id": 77,
  "status": "preparing"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 订单状态更新为 `preparing`

---

### 步骤 2.3：更新菜品状态为制作中

**测试目的**：验证菜品状态更新接口

**请求信息**：
```
PUT /api/order-items/{item_id}/status
Content-Type: application/json
```

**请求体**：
```json
{
  "item_status": "preparing"
}
```

**使用 cURL**：
```bash
# 更新鱼香肉丝
curl -X PUT http://127.0.0.1:8080/api/order-items/193/status \
  -H "Content-Type: application/json" \
  -d '{"item_status": "preparing"}'

# 更新麻婆豆腐
curl -X PUT http://127.0.0.1:8080/api/order-items/194/status \
  -H "Content-Type: application/json" \
  -d '{"item_status": "preparing"}'
```

**预期结果**：
```json
{
  "message": "订单项状态更新成功",
  "item_id": 193,
  "status": "preparing"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 菜品状态更新为 `preparing`

---

### 步骤 2.4：更新菜品状态为完成

**测试目的**：验证菜品完成状态更新

**请求信息**：
```
PUT /api/order-items/{item_id}/status
Content-Type: application/json
```

**请求体**：
```json
{
  "item_status": "ready"
}
```

**使用 cURL**：
```bash
curl -X PUT http://127.0.0.1:8080/api/order-items/193/status \
  -H "Content-Type: application/json" \
  -d '{"item_status": "ready"}'

curl -X PUT http://127.0.0.1:8080/api/order-items/194/status \
  -H "Content-Type: application/json" \
  -d '{"item_status": "ready"}'
```

**预期结果**：
```json
{
  "message": "订单项状态更新成功",
  "item_id": 193,
  "status": "ready"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 菜品状态更新为 `ready`

---

### 步骤 2.5：更新订单状态为可传菜

**测试目的**：验证订单完成制作状态

**请求信息**：
```
PUT /api/orders/{order_id}/status
Content-Type: application/json
```

**请求体**：
```json
{
  "status": "ready"
}
```

**使用 cURL**：
```bash
curl -X PUT http://127.0.0.1:8080/api/orders/77/status \
  -H "Content-Type: application/json" \
  -d '{"status": "ready"}'
```

**预期结果**：
```json
{
  "message": "订单状态更新成功",
  "order_id": 77,
  "status": "ready"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 订单状态更新为 `ready`

---

## 测试3：传菜员流程

### 测试目标
验证传菜员接收订单、传菜完成的流程

---

### 步骤 3.1：获取待传菜订单

**测试目的**：验证待传菜订单查询接口

**请求信息**：
```
GET /api/orders/?status=ready
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/orders/?status=ready
```

**预期结果**：
```json
[
  {
    "id": 77,
    "order_number": "ORD202602061932134940",
    "table_number": "8",
    "total_amount": 60.0,
    "status": "ready",
    "items": [...]
  }
]
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回待传菜订单

---

### 步骤 3.2：确认传菜

**测试目的**：验证传菜员确认接口

**请求信息**：
```
PUT /api/orders/{order_id}/status
Content-Type: application/json
```

**请求体**：
```json
{
  "status": "serving"
}
```

**使用 cURL**：
```bash
curl -X PUT http://127.0.0.1:8080/api/orders/77/status \
  -H "Content-Type: application/json" \
  -d '{"status": "serving"}'
```

**预期结果**：
```json
{
  "message": "订单状态更新成功",
  "order_id": 77,
  "status": "serving"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 订单状态更新为 `serving`

---

### 步骤 3.3：传菜完成

**测试目的**：验证传菜完成接口

**请求信息**：
```
PUT /api/orders/{order_id}/status
Content-Type: application/json
```

**请求体**：
```json
{
  "status": "completed"
}
```

**使用 cURL**：
```bash
curl -X PUT http://127.0.0.1:8080/api/orders/77/status \
  -H "Content-Type: application/json" \
  -d '{"status": "completed"}'
```

**预期结果**：
```json
{
  "message": "订单状态更新成功",
  "order_id": 77,
  "status": "completed"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 订单状态更新为 `completed`

---

## 测试4：收款员流程

### 测试目标
验证收款员查询订单、确认收款的流程

---

### 步骤 4.1：获取待收款订单

**测试目的**：验证已完成订单查询接口

**请求信息**：
```
GET /api/orders/?status=completed
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/orders/?status=completed
```

**预期结果**：
```json
[
  {
    "id": 77,
    "order_number": "ORD202602061932134940",
    "table_number": "8",
    "total_amount": 60.0,
    "status": "completed",
    "payment_status": "unpaid",
    "items": [...]
  }
]
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回已完成但未付款的订单
- ✅ 显示 `payment_status: unpaid`

---

### 步骤 4.2：确认收款

**测试目的**：验证收款确认接口

**请求信息**：
```
POST /api/orders/{order_id}/confirm-payment
Content-Type: application/json
```

**请求体**：
```json
{
  "payment_method": "immediate"
}
```

**使用 cURL**：
```bash
curl -X POST http://127.0.0.1:8080/api/orders/77/confirm-payment \
  -H "Content-Type: application/json" \
  -d '{"payment_method": "immediate"}'
```

**预期结果**：
```json
{
  "message": "支付成功",
  "order_id": 77,
  "order_number": "ORD202602061932134940",
  "payment_status": "paid",
  "payment_method": "immediate",
  "paid_amount": 60.0
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 支付状态更新为 `paid`
- ✅ 支付金额正确

---

## 测试5：店铺设置流程

### 测试目标
验证管理员对菜品和桌号的管理功能

---

### 步骤 5.1：新增菜品

**测试目的**：验证菜品创建接口

**请求信息**：
```
POST /api/menu-items/
Content-Type: application/json
```

**请求体**：
```json
{
  "name": "测试菜品",
  "description": "这是一个测试菜品",
  "price": 99.0,
  "category_id": 1,
  "stock": 50,
  "is_available": true,
  "is_recommended": false
}
```

**使用 cURL**：
```bash
curl -X POST http://127.0.0.1:8080/api/menu-items/ \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试菜品",
    "description": "这是一个测试菜品",
    "price": 99.0,
    "category_id": 1,
    "stock": 50,
    "is_available": true,
    "is_recommended": false
  }'
```

**预期结果**：
```json
{
  "id": 97,
  "name": "测试菜品",
  "description": "这是一个测试菜品",
  "price": 99.0,
  "stock": 50,
  "is_available": true,
  "is_recommended": false,
  "category_id": 1,
  "category_name": "热菜",
  "sort_order": 12
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回菜品ID
- ✅ 菜品信息正确保存

**测试记录**：
- 记录新菜品ID：`new_item_id = 97`

---

### 步骤 5.2：修改菜品

**测试目的**：验证菜品更新接口

**请求信息**：
```
PATCH /api/menu-items/{item_id}
Content-Type: application/json
```

**请求体**：
```json
{
  "price": 88.0,
  "description": "更新后的菜品描述"
}
```

**使用 cURL**：
```bash
curl -X PATCH http://127.0.0.1:8080/api/menu-items/97 \
  -H "Content-Type: application/json" \
  -d '{
    "price": 88.0,
    "description": "更新后的菜品描述"
  }'
```

**预期结果**：
```json
{
  "id": 97,
  "name": "测试菜品",
  "description": "更新后的菜品描述",
  "price": 88.0,
  "stock": 50,
  "is_available": true
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 价格和描述已更新

---

### 步骤 5.3：删除菜品

**测试目的**：验证菜品删除接口

**请求信息**：
```
DELETE /api/menu-items/{item_id}
```

**使用 cURL**：
```bash
curl -X DELETE http://127.0.0.1:8080/api/menu-items/97
```

**预期结果**：
```json
{
  "message": "菜品删除成功"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 删除成功

---

### 步骤 5.4：新增桌号

**测试目的**：验证桌号创建接口

**请求信息**：
```
POST /api/tables/
Content-Type: application/json
```

**请求体**：
```json
{
  "table_number": "T99",
  "seats": 6,
  "is_active": true
}
```

**使用 cURL**：
```bash
curl -X POST http://127.0.0.1:8080/api/tables/ \
  -H "Content-Type: application/json" \
  -d '{
    "table_number": "T99",
    "seats": 6,
    "is_active": true
  }'
```

**预期结果**：
```json
{
  "id": 57,
  "table_number": "T99",
  "seats": 6,
  "is_active": true,
  "is_occupied": false
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回桌号ID
- ✅ 桌号信息正确保存

**测试记录**：
- 记录新桌号ID：`new_table_id = 57`

---

### 步骤 5.5：修改桌号

**测试目的**：验证桌号更新接口

**请求信息**：
```
PATCH /api/tables/{table_id}
Content-Type: application/json
```

**请求体**：
```json
{
  "seats": 8
}
```

**使用 cURL**：
```bash
curl -X PATCH http://127.0.0.1:8080/api/tables/57 \
  -H "Content-Type: application/json" \
  -d '{"seats": 8}'
```

**预期结果**：
```json
{
  "id": 57,
  "table_number": "T99",
  "seats": 8,
  "is_active": true,
  "is_occupied": false
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 座位数更新为8

---

### 步骤 5.6：删除桌号

**测试目的**：验证桌号删除接口

**请求信息**：
```
DELETE /api/tables/{table_id}
```

**使用 cURL**：
```bash
curl -X DELETE http://127.0.0.1:8080/api/tables/57
```

**预期结果**：
```json
{
  "message": "桌号删除成功"
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 删除成功

---

## 测试6：财务统计流程

### 测试目标
验证营业额、桌次、菜品销售等统计功能

---

### 步骤 6.1：今日营业额统计

**测试目的**：验证日营业额统计接口

**请求信息**：
```
GET /api/stats/daily
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/stats/daily
```

**预期结果**：
```json
{
  "date": "2026-02-06",
  "total_orders": 1,
  "total_amount": 60.0,
  "paid_orders": 1,
  "paid_amount": 60.0,
  "unpaid_orders": 0,
  "unpaid_amount": 0.0
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回今日订单数和金额
- ✅ 已支付/未支付金额分别统计

---

### 步骤 6.2：桌次统计

**测试目的**：验证桌次使用统计接口

**请求信息**：
```
GET /api/stats/tables
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/stats/tables
```

**预期结果**：
```json
{
  "date": "2026-02-06",
  "total_tables": 1,
  "table_stats": [
    {
      "table_number": "8",
      "order_count": 1,
      "total_amount": 60.0
    }
  ]
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回各桌号使用情况
- ✅ 统计订单数和金额

---

### 步骤 6.3：菜品销售统计

**测试目的**：验证菜品销售排行接口

**请求信息**：
```
GET /api/stats/menu-sales
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/stats/menu-sales
```

**预期结果**：
```json
{
  "date": "2026-02-06",
  "total_items": 2,
  "menu_stats": [
    {
      "menu_item_id": 2,
      "menu_item_name": "鱼香肉丝",
      "category_name": "热菜",
      "sold_quantity": 1,
      "total_revenue": 32.0
    },
    {
      "menu_item_id": 3,
      "menu_item_name": "麻婆豆腐",
      "category_name": "热菜",
      "sold_quantity": 1,
      "total_revenue": 28.0
    }
  ]
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回菜品销售排行
- ✅ 统计销量和营收

---

### 步骤 6.4：库存统计

**测试目的**：验证库存统计接口

**请求信息**：
```
GET /api/stats/inventory
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/stats/inventory
```

**预期结果**：
```json
{
  "total_items": 11,
  "inventory_stats": [
    {
      "menu_item_id": 1,
      "menu_item_name": "宫保鸡丁",
      "category_name": "热菜",
      "stock": 100,
      "sold_today": 0,
      "remaining": 100,
      "price": 38.0
    },
    {
      "menu_item_id": 2,
      "menu_item_name": "鱼香肉丝",
      "category_name": "热菜",
      "stock": 100,
      "sold_today": 1,
      "remaining": 99,
      "price": 32.0
    }
  ]
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回所有菜品库存
- ✅ 计算今日销量和剩余量

---

### 步骤 6.5：收入报表（最近7天）

**测试目的**：验证收入报表接口

**请求信息**：
```
GET /api/revenue/
```

**使用 cURL**：
```bash
curl -X GET http://127.0.0.1:8080/api/revenue/
```

**预期结果**：
```json
{
  "start_date": "2026-01-30",
  "end_date": "2026-02-06",
  "total_orders": 1,
  "total_revenue": 60.0,
  "total_paid": 60.0,
  "unpaid_amount": 0.0,
  "daily_revenue": [
    {
      "date": "2026-02-06",
      "orders": 1,
      "revenue": 60.0,
      "paid": 60.0,
      "unpaid": 0.0
    }
  ]
}
```

**验证点**：
- ✅ 状态码：200
- ✅ 返回最近7天收入明细
- ✅ 按日期统计

---

## 测试结果汇总表

| 测试项 | 测试步骤 | 状态 | 备注 |
|--------|----------|------|------|
| 测试1：客户点餐 | 5个子步骤 | □ 通过 □ 失败 |  |
| 测试2：厨师做菜 | 5个子步骤 | □ 通过 □ 失败 |  |
| 测试3：传菜员 | 3个子步骤 | □ 通过 □ 失败 |  |
| 测试4：收款员 | 2个子步骤 | □ 通过 □ 失败 |  |
| 测试5：店铺设置 | 6个子步骤 | □ 通过 □ 失败 |  |
| 测试6：财务统计 | 5个子步骤 | □ 通过 □ 失败 |  |

**总体评分**: ______ / 100%

---

## 常见问题排查

### 1. 连接超时
- **问题**: `Connection refused` 或 `Timeout`
- **解决**: 检查服务是否启动，防火墙是否开放端口

### 2. 404 错误
- **问题**: 返回 `404 Not Found`
- **解决**: 检查URL路径是否正确，确保服务正常运行

### 3. 500 错误
- **问题**: 返回 `500 Internal Server Error`
- **解决**: 查看服务器日志，检查数据库连接

### 4. 返回数据为空
- **问题**: 返回空数组 `[]`
- **解决**: 检查数据库是否有数据，是否需要初始化

---

## 下一步

测试通过后，可以进行：
1. **前端集成测试**：将API对接到Vue.js前端
2. **压力测试**：模拟多用户并发场景
3. **安全测试**：验证权限控制和数据加密
4. **性能优化**：根据测试结果优化系统

---

## 联系支持

如遇到问题，请提供：
- 测试步骤
- 请求URL和参数
- 返回的错误信息
- 服务器日志截图
