# 🎮 沙盒测试完整方案

## ✅ 系统已就绪！

所有服务运行正常，您可以直接在沙盒预览中测试完整的点餐流程！

---

## 📋 测试方案总览

### 核心理念
> **模拟真实餐厅场景**：顾客扫二维码 → 选择桌号 → 点餐 → 厨师制作 → 传菜员上菜 → 收银员结账 → 店长管理

### 主要改进

1. ✅ **生成桌号二维码** - 模拟真实扫码场景
2. ✅ **创建主入口页面** - 一键开始测试
3. ✅ **URL参数支持** - 自动选择桌号
4. ✅ **全流程测试页面** - 五角色无缝切换

---

## 🚀 三种测试方式

### 方式1：主入口（最推荐）⭐

**入口**：`assets/index.html`

**操作**：
1. 在沙盒预览中打开 `assets/index.html`
2. 点击大按钮：**⚡ 立即测试8号桌完整流程**
3. 开始全流程测试！

**优势**：
- 📱 显示所有桌号二维码
- 🎯 一键快速测试
- 📊 完整的测试指引

---

### 方式2：选择桌号

**入口**：`assets/index.html`

**操作**：
1. 打开 `assets/index.html`
2. 在桌号列表中点击任意桌号（如8号桌）
3. 自动进入点餐页面，桌号已选中

**适用场景**：
- 测试不同桌号
- 查看桌号二维码

---

### 方式3：直接URL访问

**入口**：`assets/restaurant_full_test.html?table=8`

**操作**：
1. 直接访问：`assets/restaurant_full_test.html?table=8`
2. 页面自动选择8号桌
3. 开始点餐

**适用场景**：
- 快速测试特定桌号
- 外部链接测试

---

## 🎯 完整测试流程（8号桌示例）

### 第1步：顾客扫码点餐 🛒

**页面**：`assets/index.html` → 点击8号桌或按钮

**角色**：👤 顾客（默认）

**操作流程**：
```
1. 页面自动识别8号桌（或点击"确认桌号"）
2. 浏览菜单（热菜、凉菜、主食、饮品）
3. 点击菜品添加到购物车
4. 底部点击购物车按钮
5. 查看订单详情
6. 选择支付方式（微信/支付宝/现金）
7. 点击"提交订单"
```

**预期结果**：
- ✅ 订单创建成功
- ✅ 显示订单号和金额
- ✅ 菜品库存正确扣减

---

### 第2步：厨师开始制作 👨‍🍳

**切换角色**：点击顶部 **👨‍🍳 厨师** 按钮

**操作流程**：
```
1. 查看"待制作"订单列表
2. 找到8号桌的订单
3. 点击菜品"开始制作"按钮
   - 状态变更为：制作中（橙色）
4. 制作完成后点击"完成制作"按钮
   - 状态变更为：已完成（绿色）
5. 或点击右下角 🎤 语音按钮
   - 说出"完成"或"做好"
   - 自动标记为已完成
```

**预期结果**：
- ✅ 菜品状态正确流转
- ✅ 传菜员收到通知（模拟）
- ✅ 可以打印制作单（控制台）

---

### 第3步：传菜员确认上菜 🤵

**切换角色**：点击顶部 **🤵 传菜员** 按钮

**操作流程**：
```
1. 查看"待传菜"订单列表
2. 找到8号桌的已完成菜品
3. 点击"确认上菜"按钮
4. 在弹出的确认框中点击"确认已上菜"
   - 模拟在顾客面前逐一确认
```

**预期结果**：
- ✅ 菜品状态变更为"已上菜"
- ✅ 顾客可以开始用餐
- ✅ 可以打印传菜单（控制台）

---

### 第4步：收银员处理支付 💰

**切换角色**：点击顶部 **💰 收银员** 按钮

**操作流程**：
```
1. 查看"待支付"订单列表
2. 找到8号桌的订单
3. 选择支付方式：
   - 微信支付
   - 支付宝
   - 现金
   - 银行卡
4. 点击"确认支付"按钮
5. 点击"打印小票"按钮
```

**预期结果**：
- ✅ 订单状态变更为"已支付"
- ✅ 显示支付成功提示
- ✅ 会员积分自动增加
- ✅ 控制台显示小票内容

---

### 第5步：店长查看数据 👔

**切换角色**：点击顶部 **👔 店长** 按钮

**操作流程**：
```
1. 查看运营统计数据
   - 今日订单数
   - 今日营业额
   - 平均消费
   - 热门菜品
2. 查看订单列表
3. 查看桌位状态
4. 查看营收趋势
```

**预期结果**：
- ✅ 数据实时更新
- ✅ 统计准确无误
- ✅ 可以导出数据（功能预留）

---

## 📊 测试数据说明

### 已初始化的测试数据

| 数据类型 | 数量 | 说明 |
|---------|------|------|
| 店铺 | 5个 | 示范餐厅等 |
| 菜品分类 | 5个 | 热菜、凉菜、主食、饮品、汤类 |
| 菜品 | 11道 | 宫保鸡丁、鱼香肉丝、可乐等 |
| 桌号 | 11个 | 1-11号桌，不同座位数 |
| 用户 | 18个 | 包含店长、厨师、收银员等 |

### 推荐测试桌号

- **8号桌**（推荐）：4座，测试完整流程
- **1-7号桌**：不同座位数测试
- **9-11号桌**：大桌测试

---

## 🔧 技术细节

### 服务状态

```
✅ API服务：http://9.128.251.82:8000（端口8000）
✅ 测试页面：http://9.128.251.82:8080/assets/（端口8080）
✅ 数据库：PostgreSQL（已初始化）
```

### 核心文件

| 文件 | 路径 | 说明 |
|------|------|------|
| 主入口 | `assets/index.html` | 桌号选择和测试入口 |
| 测试页面 | `assets/restaurant_full_test.html` | 全流程测试页面 |
| 二维码 | `assets/qrcodes/table_*.png` | 1-10号桌二维码 |
| 快速指南 | `assets/QUICK_TEST_GUIDE.md` | 详细测试指南 |

### API端点

```
GET  /api/tables/          # 获取桌号列表
GET  /api/menu-items/      # 获取菜品列表
POST /api/orders/          # 创建订单
GET  /api/orders/          # 获取订单列表
PATCH /api/orders/{id}/status  # 更新订单状态
PATCH /api/orders/{id}/items/{item_id}/status  # 更新菜品状态
```

---

## 💡 使用技巧

### 1. 快速角色切换

使用顶部导航栏快速切换角色，无需刷新页面：
- 👤 顾客
- 👨‍🍳 厨师
- 🤵 传菜员
- 💰 收银员
- 👔 店长

### 2. 语音确认（厨师端）

点击右下角 🎤 按钮，说出：
- "完成"
- "做好"
- "ok"

系统会自动标记菜品为已完成。

### 3. 实时数据同步

系统每3秒自动刷新数据，确保所有角色看到最新信息。

### 4. 打印功能

点击打印按钮后，打印内容会显示在浏览器控制台（F12 → Console）：
- 厨师制作单
- 传菜员传菜单
- 收银员小票

---

## ❓ 常见问题

### Q1: 页面打开没有数据？

**A**: 等待3秒，系统会自动加载数据。检查：
1. API服务是否运行（端口8000）
2. 浏览器控制台是否有错误（F12）
3. 网络连接是否正常

### Q2: 提交订单失败？

**A**: 确保：
1. 已选择桌号
2. 菜品有库存
3. 支付方式已选择

### Q3: 状态更新不生效？

**A**:
1. 切换角色时等待数据刷新（最多3秒）
2. 或手动刷新页面
3. 检查控制台是否有错误

### Q4: 如何查看API文档？

**A**: 访问 http://9.128.251.82:8000/docs

---

## 🎉 总结

### 现在您可以开始测试了！

**推荐流程**：

1. 打开 `assets/index.html`
2. 点击"⚡ 立即测试8号桌完整流程"
3. 按照5个角色顺序完成测试：
   - 👤 顾客：点餐
   - 👨‍🍳 厨师：制作
   - 🤵 传菜员：上菜
   - 💰 收银员：结账
   - 👔 店长：查看数据

### 测试要点

| 功能 | 状态 | 说明 |
|------|------|------|
| 扫码进入 | ✅ | URL参数自动选择桌号 |
| 菜单浏览 | ✅ | 分类浏览、添加购物车 |
| 订单创建 | ✅ | 支持多种支付方式 |
| 制作流程 | ✅ | 制作中→已完成，语音确认 |
| 上菜确认 | ✅ | 传菜员逐一确认 |
| 支付流程 | ✅ | 支付成功，小票打印 |
| 数据统计 | ✅ | 实时数据展示 |
| 角色切换 | ✅ | 5角色无缝切换 |

---

**🎮 开始测试吧！**

如有问题，请查看 `assets/QUICK_TEST_GUIDE.md` 获取详细指南。
