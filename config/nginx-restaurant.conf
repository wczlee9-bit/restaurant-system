# ========================================
# Nginx配置文件 - 餐饮点餐系统前端
# 服务器：115.191.1.219
# 端口：80 (HTTP) 和 443 (HTTPS)
# ========================================

server {
    listen 80;
    server_name 115.191.1.219;

    # 前端静态文件目录
    root /var/www/restaurant-frontend;
    index portal.html index.html;

    # 字符集
    charset utf-8;

    # 日志配置
    access_log /var/log/nginx/restaurant-frontend-access.log;
    error_log /var/log/nginx/restaurant-frontend-error.log;

    # Gzip压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|webp|svg|ico|css|js|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # HTML文件不缓存
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
    }

    # 主页重定向到门户页面
    location = / {
        return 302 /portal.html;
    }

    # 便捷路由（短链接）
    location = /login {
        return 302 /login_standalone.html;
    }

    location = /customer-order {
        return 302 /customer_order_v3.html;
    }

    location = /staff-workflow {
        return 302 /staff_workflow.html;
    }

    location = /shop-settings {
        return 302 /shop_settings.html;
    }

    location = /member-center {
        return 302 /member_center.html;
    }

    location = /headquarters {
        return 302 /headquarters_dashboard.html;
    }

    location = /menu-management {
        return 302 /menu_management.html;
    }

    location = /inventory-management {
        return 302 /inventory_management.html;
    }

    location = /settlement-management {
        return 302 /settlement_management.html;
    }

    location = /discount-management {
        return 302 /discount_management.html;
    }

    # 二维码文件访问
    location /qrcodes/ {
        alias /var/www/restaurant-frontend/qrcodes/;
        expires 30d;
    }

    # 默认静态文件服务
    location / {
        try_files $uri $uri/ =404;
    }

    # 404页面
    error_page 404 /index.html;
}

# HTTPS配置（可选，需要SSL证书）
# server {
#     listen 443 ssl http2;
#     server_name 115.191.1.219;
#
#     # SSL证书配置（需要提供证书文件）
#     ssl_certificate /etc/nginx/ssl/restaurant-frontend.crt;
#     ssl_certificate_key /etc/nginx/ssl/restaurant-frontend.key;
#
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
#
#     root /var/www/restaurant-frontend;
#     index portal.html index.html;
#
#     # 其他配置与HTTP相同...
# }
