# ğŸš€ é¤é¥®ç‚¹é¤ç³»ç»Ÿ - å®Œæ•´å•†ç”¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [éƒ¨ç½²å‰å‡†å¤‡](#éƒ¨ç½²å‰å‡†å¤‡)
- [åç«¯æœåŠ¡å™¨éƒ¨ç½²](#åç«¯æœåŠ¡å™¨éƒ¨ç½²)
- [å‰ç«¯Netlifyéƒ¨ç½²](#å‰ç«¯netlifyéƒ¨ç½²)
- [ç³»ç»ŸéªŒè¯ä¸æµ‹è¯•](#ç³»ç»ŸéªŒè¯ä¸æµ‹è¯•)
- [è¿ç»´ä¸ç»´æŠ¤](#è¿ç»´ä¸ç»´æŠ¤)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç»ˆç«¯                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é¡¾å®¢æ‰‹æœº  â”‚  â”‚ å‘˜å·¥å¹³æ¿  â”‚  â”‚ åº—é•¿ç”µè„‘  â”‚  â”‚ ç®¡ç†åå°  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Netlify (å‰ç«¯)                             â”‚
â”‚           é™æ€ç½‘ç«™æ‰˜ç®¡ + APIä»£ç† + HTTPS                      â”‚
â”‚   https://yourdomain.netlify.app (æˆ–è‡ªå®šä¹‰åŸŸå)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    API ä»£ç†è½¬å‘
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯APIæœåŠ¡å™¨ (9.128.251.82)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚é¡¾å®¢API  â”‚ â”‚åº—å‘˜API  â”‚ â”‚ä¼šå‘˜API  â”‚ â”‚æ€»å…¬å¸APIâ”‚             â”‚
â”‚  â”‚ :8000   â”‚ â”‚ :8001   â”‚ â”‚ :8004   â”‚ â”‚ :8006   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                      â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚ PostgreSQL DB  â”‚                                â”‚
â”‚              â”‚   (æ•°æ®åº“)      â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                      â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚   S3å­˜å‚¨      â”‚                                â”‚
â”‚              â”‚ (äºŒç»´ç /å›¾ç‰‡)  â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## éƒ¨ç½²å‰å‡†å¤‡

### 1. ç¡¬ä»¶è¦æ±‚

**åç«¯æœåŠ¡å™¨é…ç½®ï¼ˆæœ€ä½ï¼‰**
- CPU: 2æ ¸å¿ƒ
- å†…å­˜: 4GB
- ç¡¬ç›˜: 50GB SSD
- å¸¦å®½: 10Mbps
- æ“ä½œç³»ç»Ÿ: Ubuntu 20.04+ æˆ– CentOS 7+

**æ¨èé…ç½®**
- CPU: 4æ ¸å¿ƒ
- å†…å­˜: 8GB
- ç¡¬ç›˜: 100GB SSD
- å¸¦å®½: 20Mbps

### 2. è½¯ä»¶ä¾èµ–

**æœåŠ¡å™¨ç«¯**
- Python 3.8+
- PostgreSQL 13+
- Git
- Nginx (å¯é€‰ï¼Œç”¨äºåå‘ä»£ç†)
- Systemd (ç”¨äºæœåŠ¡ç®¡ç†)

**å®¢æˆ·ç«¯**
- ç°ä»£æµè§ˆå™¨ (Chrome 90+, Safari 14+, Firefox 88+, Edge 90+)
- iOS 12+ æˆ– Android 8+

### 3. ç¬¬ä¸‰æ–¹æœåŠ¡

| æœåŠ¡ | ç”¨é€” | å…è´¹é¢åº¦ | æ¨èæœåŠ¡å•† |
|------|------|---------|-----------|
| S3å¯¹è±¡å­˜å‚¨ | å­˜å‚¨äºŒç»´ç ã€å›¾ç‰‡ | 5GBå­˜å‚¨ | é˜¿é‡Œäº‘OSS / è…¾è®¯äº‘COS / AWS S3 |
| åŸŸåè§£æ | è‡ªå®šä¹‰åŸŸå | - | é˜¿é‡Œäº‘DNS / è…¾è®¯äº‘DNS |
| SSLè¯ä¹¦ | HTTPSåŠ å¯† | å…è´¹(Let's Encrypt) | Certbot / äº‘æœåŠ¡å•† |

### 4. è´¦å·å‡†å¤‡

- [ ] Netlifyè´¦å· (å…è´¹)
- [ ] GitHubè´¦å· (ç”¨äºä»£ç ç®¡ç†)
- [ ] S3å¯¹è±¡å­˜å‚¨è´¦å·
- [ ] æ•°æ®åº“ç®¡ç†å‘˜è´¦å· (PostgreSQL)

---

## åç«¯æœåŠ¡å™¨éƒ¨ç½²

### æ­¥éª¤ 1: è¿æ¥æœåŠ¡å™¨å¹¶æ›´æ–°ç³»ç»Ÿ

```bash
# è¿æ¥åˆ°æœåŠ¡å™¨ (å°†IPæ›¿æ¢ä¸ºå®é™…IP)
ssh root@9.128.251.82

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# è®¾ç½®æ—¶åŒº (å¯é€‰)
sudo timedatectl set-timezone Asia/Shanghai
```

### æ­¥éª¤ 2: å®‰è£…å¿…è¦è½¯ä»¶

```bash
# å®‰è£… Python 3.8+
sudo apt install python3.8 python3-pip python3-venv git -y

# éªŒè¯Pythonç‰ˆæœ¬
python3 --version

# å®‰è£… PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# å®‰è£… Nginx (æ¨èï¼Œç”¨äºåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡)
sudo apt install nginx -y

# å®‰è£… Supervisor (ç”¨äºè¿›ç¨‹ç®¡ç†)
sudo apt install supervisor -y

# å¯ç”¨å¹¶å¯åŠ¨Nginx
sudo systemctl enable nginx
sudo systemctl start nginx
```

### æ­¥éª¤ 3: é…ç½® PostgreSQL æ•°æ®åº“

```bash
# åˆ‡æ¢åˆ°postgresç”¨æˆ·
sudo -u postgres psql

# æ‰§è¡Œä»¥ä¸‹SQLå‘½ä»¤ (å¤åˆ¶ç²˜è´´)
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE restaurant_db;

-- åˆ›å»ºæ•°æ®åº“ç”¨æˆ·
CREATE USER restaurant_user WITH PASSWORD 'your_secure_password';

-- æˆäºˆæƒé™
GRANT ALL PRIVILEGES ON DATABASE restaurant_db TO restaurant_user;

-- é€€å‡º
\q

# æµ‹è¯•è¿æ¥
psql -h localhost -U restaurant_user -d restaurant_db -c "SELECT version();"
```

### æ­¥éª¤ 4: å…‹éš†ä»£ç åˆ°æœåŠ¡å™¨

```bash
# è¿›å…¥/optç›®å½•
cd /opt

# å…‹éš†ä»£ç ä»“åº“ (å°†YOUR_GITHUB_REPOæ›¿æ¢ä¸ºå®é™…åœ°å€)
# å¦‚æœæ²¡æœ‰Gitä»“åº“ï¼Œå¯ä»¥å…ˆè·³è¿‡ï¼Œåé¢æ‰‹åŠ¨ä¸Šä¼ ä»£ç 
git clone https://github.com/YOUR_USERNAME/restaurant-system.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd restaurant-system

# æˆ–æ‰‹åŠ¨ä¸Šä¼ ä»£ç 
# åœ¨æœ¬åœ°æ‰§è¡Œ: scp -r /path/to/restaurant-system root@9.128.251.82:/opt/
```

### æ­¥éª¤ 5: åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/restaurant-system

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å‡çº§pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```

### æ­¥éª¤ 6: é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
sudo nano /opt/restaurant-system/.env

# æ·»åŠ ä»¥ä¸‹å†…å®¹ (æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹)
DATABASE_URL=postgresql://restaurant_user:your_secure_password@localhost:5432/restaurant_db
S3_ACCESS_KEY=your_s3_access_key
S3_SECRET_KEY=your_s3_secret_key
S3_BUCKET_NAME=your_bucket_name
S3_REGION=us-east-1
S3_ENDPOINT=https://your_s3_endpoint
COZE_API_KEY=your_coze_api_key

# ä¿å­˜å¹¶é€€å‡º (Ctrl+X, Y, Enter)

# è®¾ç½®æ–‡ä»¶æƒé™
sudo chmod 600 /opt/restaurant-system/.env
```

### æ­¥éª¤ 7: åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd /opt/restaurant-system
source venv/bin/activate

# è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
python scripts/init_database.py

# æˆ–æ‰‹åŠ¨åˆ›å»ºè¡¨
python -c "
from storage.database.db import engine
from storage.database.shared.model import Base
Base.metadata.create_all(bind=engine)
print('æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ')
"

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```

### æ­¥éª¤ 8: åˆ›å»ºSystemdæœåŠ¡é…ç½®

ä¸ºæ¯ä¸ªAPIæœåŠ¡åˆ›å»ºç‹¬ç«‹çš„SystemdæœåŠ¡æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºé¡¾å®¢APIæœåŠ¡
sudo nano /etc/systemd/system/restaurant-customer-api.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Restaurant Customer API
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/restaurant-system
Environment="PATH=/opt/restaurant-system/venv/bin"
ExecStart=/opt/restaurant-system/venv/bin/python -m uvicorn api.customer_api:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# åˆ›å»ºåº—å‘˜APIæœåŠ¡
sudo nano /etc/systemd/system/restaurant-staff-api.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Restaurant Staff API
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/restaurant-system
Environment="PATH=/opt/restaurant-system/venv/bin"
ExecStart=/opt/restaurant-system/venv/bin/python -m uvicorn api.staff_api:app --host 0.0.0.0 --port 8001
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# åˆ›å»ºä¼šå‘˜APIæœåŠ¡
sudo nano /etc/systemd/system/restaurant-member-api.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Restaurant Member API
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/restaurant-system
Environment="PATH=/opt/restaurant-system/venv/bin"
ExecStart=/opt/restaurant-system/venv/bin/python -m uvicorn api.member_api:app --host 0.0.0.0 --port 8004
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# åˆ›å»ºæ€»å…¬å¸APIæœåŠ¡
sudo nano /etc/systemd/system/restaurant-hq-api.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Restaurant Headquarters API
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/restaurant-system
Environment="PATH=/opt/restaurant-system/venv/bin"
ExecStart=/opt/restaurant-system/venv/bin/python -m uvicorn api.headquarters_api:app --host 0.0.0.0.0 --port 8006
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### æ­¥éª¤ 9: å¯åŠ¨æ‰€æœ‰APIæœåŠ¡

```bash
# é‡è½½Systemdé…ç½®
sudo systemctl daemon-reload

# å¯ç”¨æ‰€æœ‰æœåŠ¡ (å¼€æœºè‡ªå¯)
sudo systemctl enable restaurant-customer-api
sudo systemctl enable restaurant-staff-api
sudo systemctl enable restaurant-member-api
sudo systemctl enable restaurant-hq-api

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
sudo systemctl start restaurant-customer-api
sudo systemctl start restaurant-staff-api
sudo systemctl start restaurant-member-api
sudo systemctl start restaurant-hq-api

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status restaurant-customer-api
sudo systemctl status restaurant-staff-api
sudo systemctl status restaurant-member-api
sudo systemctl status restaurant-hq-api

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u restaurant-customer-api -f
```

### æ­¥éª¤ 10: é…ç½®é˜²ç«å¢™

```bash
# å¦‚æœä½¿ç”¨ufwé˜²ç«å¢™
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 8000/tcp
sudo ufw allow 8001/tcp
sudo ufw allow 8004/tcp
sudo ufw allow 8006/tcp
sudo ufw enable

# å¦‚æœä½¿ç”¨iptables
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8000 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8001 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8004 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8006 -j ACCEPT
```

### æ­¥éª¤ 11: é…ç½®Nginxåå‘ä»£ç† (å¯é€‰ä½†æ¨è)

```bash
# åˆ›å»ºNginxé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/restaurant-api
```

å†…å®¹ï¼š
```nginx
upstream customer_api {
    server 127.0.0.1:8000;
}

upstream staff_api {
    server 127.0.0.1:8001;
}

upstream member_api {
    server 127.0.0.1:8004;
}

upstream hq_api {
    server 127.0.0.1:8006;
}

server {
    listen 80;
    server_name api.yourdomain.com;

    # æ—¥å¿—
    access_log /var/log/nginx/restaurant-api-access.log;
    error_log /var/log/nginx/restaurant-api-error.log;

    # APIè·¯ç”±
    location /api/orders {
        proxy_pass http://customer_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/member {
        proxy_pass http://member_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/headquarters {
        proxy_pass http://hq_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://staff_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocketæ”¯æŒ
    location /ws {
        proxy_pass http://staff_api;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

```bash
# å¯ç”¨ç«™ç‚¹é…ç½®
sudo ln -s /etc/nginx/sites-available/restaurant-api /etc/nginx/sites-enabled/

# æµ‹è¯•Nginxé…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

### æ­¥éª¤ 12: éªŒè¯åç«¯æœåŠ¡

```bash
# æµ‹è¯•é¡¾å®¢API
curl http://localhost:8000/docs

# æµ‹è¯•åº—å‘˜API
curl http://localhost:8001/docs

# æµ‹è¯•ä¼šå‘˜API
curl http://localhost:8004/docs

# æµ‹è¯•æ€»å…¬å¸API
curl http://localhost:8006/docs

# æµ‹è¯•å¤–éƒ¨è®¿é—® (æ›¿æ¢ä¸ºå®é™…IP)
curl http://9.128.251.82:8000/health
```

---

## å‰ç«¯Netlifyéƒ¨ç½²

### æ­¥éª¤ 1: å‡†å¤‡å‰ç«¯æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œç¡®è®¤ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š

```
restaurant-system/
â”œâ”€â”€ assets/              # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ portal.html
â”‚   â”œâ”€â”€ member_center.html
â”‚   â”œâ”€â”€ headquarters_dashboard.html
â”‚   â”œâ”€â”€ customer_order_v3.html
â”‚   â”œâ”€â”€ staff_workflow.html
â”‚   â””â”€â”€ ...
â”œâ”€â”€ netlify.toml         # Netlifyé…ç½®æ–‡ä»¶
â””â”€â”€ ...
```

### æ­¥éª¤ 2: æ›´æ–°Netlifyé…ç½®

ç¼–è¾‘ `netlify.toml`ï¼Œå°†åç«¯IPåœ°å€æ›¿æ¢ä¸ºå®é™…çš„æœåŠ¡å™¨IPï¼š

```toml
# æ‰¾åˆ°è¿™ä¸€è¡Œ
to = "http://YOUR_BACKEND_IP:8000/api/:splat"

# æ›¿æ¢ä¸ºå®é™…IP
to = "http://9.128.251.82:8000/api/:splat"

# å¯¹æ‰€æœ‰APIè·¯ç”±åšç›¸åŒæ›¿æ¢
```

### æ­¥éª¤ 3: æ¨é€ä»£ç åˆ°GitHub

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
git add .
git commit -m "Update for production deployment"
git push origin main
```

### æ­¥éª¤ 4: åœ¨Netlifyåˆ›å»ºæ–°ç«™ç‚¹

#### æ–¹æ³•A: é€šè¿‡GitHubé›†æˆ (æ¨è)

1. ç™»å½• Netlify: https://app.netlify.com
2. ç‚¹å‡» "Add new site" â†’ "Import an existing project"
3. é€‰æ‹© "GitHub"ï¼Œæˆæƒè®¿é—®
4. é€‰æ‹©ä»£ç ä»“åº“ `restaurant-system`
5. é…ç½®æ„å»ºè®¾ç½®ï¼š
   - Build command: (ç•™ç©º)
   - Publish directory: `assets`
6. ç‚¹å‡» "Deploy site"

#### æ–¹æ³•B: æ‹–æ‹½éƒ¨ç½²

1. æ‰“å¼€ Netlify: https://app.netlify.com/drop
2. å°†æ•´ä¸ª `assets/` æ–‡ä»¶å¤¹æ‹–æ‹½åˆ°é¡µé¢
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ
4. å°† `netlify.toml` ä¸Šä¼ åˆ°ç«™ç‚¹æ ¹ç›®å½•

### æ­¥éª¤ 5: é…ç½®è‡ªå®šä¹‰åŸŸå (å¯é€‰)

1. åœ¨Netlify Dashboardä¸­ï¼Œç‚¹å‡» "Domain settings"
2. ç‚¹å‡» "Add custom domain"
3. è¾“å…¥åŸŸå (å¦‚: `restaurant.example.com`)
4. é…ç½®DNSè§£æï¼š
   ```
   Type: CNAME
   Name: restaurant
   Value: your-site-name.netlify.app
   ```
5. ç­‰å¾…DNSç”Ÿæ•ˆ (é€šå¸¸5-15åˆ†é’Ÿ)

### æ­¥éª¤ 6: éªŒè¯éƒ¨ç½²

```bash
# è®¿é—®ä¸»é¡µ
https://your-site-name.netlify.app

# æµ‹è¯•APIä»£ç† (åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­)
fetch('/api/health')
  .then(r => r.text())
  .then(console.log)
```

---

## ç³»ç»ŸéªŒè¯ä¸æµ‹è¯•

### 1. åç«¯æœåŠ¡éªŒè¯

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
sudo systemctl status restaurant-customer-api
sudo systemctl status restaurant-staff-api
sudo systemctl status restaurant-member-api
sudo systemctl status restaurant-hq-api

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -U restaurant_user -d restaurant_db -c "SELECT COUNT(*) FROM stores;"

# æ£€æŸ¥æ—¥å¿—
sudo journalctl -u restaurant-customer-api -n 50 --no-pager
```

### 2. å‰ç«¯åŠŸèƒ½æµ‹è¯•

ä½¿ç”¨æµè§ˆå™¨è®¿é—®å‰ç«¯é¡µé¢ï¼Œä¾æ¬¡æµ‹è¯•ï¼š

#### é¡¾å®¢ç«¯æµ‹è¯•
- [ ] è®¿é—®é—¨æˆ·é¡µé¢ (`/portal.html`)
- [ ] é€‰æ‹©æ¡Œå·å¹¶ç‚¹é¤
- [ ] æŸ¥çœ‹èœå•å’Œä»·æ ¼
- [ ] æäº¤è®¢å•
- [ ] é€‰æ‹©æ”¯ä»˜æ–¹å¼
- [ ] æŸ¥çœ‹è®¢å•çŠ¶æ€

#### å·¥ä½œäººå‘˜ç«¯æµ‹è¯•
- [ ] ç™»å½• (åº—é•¿/å¨å¸ˆ/ä¼ èœå‘˜/æ”¶é“¶å‘˜)
- [ ] æŸ¥çœ‹è®¢å•åˆ—è¡¨
- [ ] æ›´æ–°è®¢å•çŠ¶æ€
- [ ] æ‰“å°å°ç¥¨
- [ ] ç®¡ç†åº“å­˜

#### ä¼šå‘˜ä¸­å¿ƒæµ‹è¯•
- [ ] æ‰‹æœºå·ç™»å½•
- [ ] æŸ¥çœ‹ç§¯åˆ†
- [ ] æŸ¥çœ‹æ¶ˆè´¹è®°å½•
- [ ] æŸ¥çœ‹ç§¯åˆ†æ—¥å¿—
- [ ] æµ‹è¯•è·¨åº—é“ºç§¯åˆ†

#### æ€»å…¬å¸åå°æµ‹è¯•
- [ ] ç™»å½•æ€»å…¬å¸åå°
- [ ] æŸ¥çœ‹æ€»ä½“ç»Ÿè®¡
- [ ] æŸ¥çœ‹è¥æ”¶è¶‹åŠ¿å›¾è¡¨
- [ ] æŸ¥çœ‹åº—é“ºæ’å
- [ ] æŸ¥çœ‹å‘˜å·¥åˆ—è¡¨
- [ ] æŸ¥çœ‹ä¼šå‘˜ç»Ÿè®¡

### 3. é›†æˆæµ‹è¯•

#### è®¢å•å®Œæ•´æµç¨‹æµ‹è¯•

```
1. é¡¾å®¢æ‰«ç  â†’ ç‚¹é¤ â†’ æäº¤è®¢å•
2. åº—å‘˜æ¥å• â†’ ç¡®è®¤è®¢å•
3. å¨å¸ˆåˆ¶ä½œä¸­
4. ä¼ èœå‘˜ä¸Šèœ
5. æ”¶é“¶å‘˜ç»“ç®— â†’ æ”¯ä»˜å®Œæˆ
6. ç§¯åˆ†è‡ªåŠ¨å¢åŠ 
7. ä¼šå‘˜ä¸­å¿ƒæŸ¥çœ‹è®°å½•
8. æ€»å…¬å¸æŸ¥çœ‹è¥æ”¶æ•°æ®
```

### 4. æ€§èƒ½æµ‹è¯•

```bash
# ä½¿ç”¨Apache Benchè¿›è¡Œå‹åŠ›æµ‹è¯•
ab -n 1000 -c 100 https://your-site-name.netlify.app/

# æˆ–ä½¿ç”¨wrk
wrk -t4 -c100 -d30s https://your-site-name.netlify.app/
```

### 5. å®‰å…¨æµ‹è¯•

- [ ] æ£€æŸ¥SQLæ³¨å…¥æ¼æ´
- [ ] æ£€æŸ¥XSSè·¨ç«™è„šæœ¬æ¼æ´
- [ ] æ£€æŸ¥CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ 
- [ ] éªŒè¯APIæƒé™æ§åˆ¶
- [ ] æ£€æŸ¥æ•æ„Ÿæ•°æ®åŠ å¯†

---

## è¿ç»´ä¸ç»´æŠ¤

### æ—¥å¸¸ç›‘æ§

#### 1. ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# æŸ¥çœ‹CPUå’Œå†…å­˜ä½¿ç”¨
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tunlp

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep uvicorn
```

#### 2. æœåŠ¡ç›‘æ§

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status restaurant-*

# è®¾ç½®è‡ªåŠ¨é‡å¯ (å·²åœ¨systemdé…ç½®ä¸­)
sudo systemctl restart restaurant-customer-api
```

#### 3. æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u restaurant-customer-api -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
sudo journalctl -u restaurant-customer-api -n 100

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u restaurant-customer-api -p err -n 50
```

### æ•°æ®å¤‡ä»½

#### æ•°æ®åº“å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo nano /opt/restaurant-system/scripts/backup_db.sh
```

å†…å®¹ï¼š
```bash
#!/bin/bash
BACKUP_DIR="/opt/restaurant-system/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/restaurant_db_$DATE.sql"

mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
pg_dump -h localhost -U restaurant_user restaurant_db > $BACKUP_FILE

# å‹ç¼©å¤‡ä»½
gzip $BACKUP_FILE

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete

echo "Backup completed: $BACKUP_FILE.gz"
```

```bash
# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x /opt/restaurant-system/scripts/backup_db.sh

# æ·»åŠ åˆ°crontab (æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½)
sudo crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
0 2 * * * /opt/restaurant-system/scripts/backup_db.sh >> /var/log/restaurant_backup.log 2>&1
```

#### æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶å’Œä¸Šä¼ çš„æ–‡ä»¶
tar -czf /opt/restaurant-system/backups/config_$(date +%Y%m%d).tar.gz \
  /opt/restaurant-system/.env \
  /opt/restaurant-system/config/
```

### å®šæœŸæ›´æ–°

#### 1. ç³»ç»Ÿæ›´æ–°

```bash
# æ¯æœˆæ›´æ–°ä¸€æ¬¡ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y
```

#### 2. ä¾èµ–æ›´æ–°

```bash
cd /opt/restaurant-system
source venv/bin/activate
pip list --outdated
pip install --upgrade package-name
deactivate
```

#### 3. ä»£ç æ›´æ–°

```bash
cd /opt/restaurant-system
git pull origin main

# é‡å¯æœåŠ¡
sudo systemctl restart restaurant-customer-api
sudo systemctl restart restaurant-staff-api
sudo systemctl restart restaurant-member-api
sudo systemctl restart restaurant-hq-api
```

### æ‰©å®¹æ–¹æ¡ˆ

#### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_orders_store_id ON orders(store_id);
CREATE INDEX idx_orders_member_id ON orders(member_id);

-- å®šæœŸæ¸…ç†å†å²æ•°æ®
DELETE FROM orders WHERE created_at < NOW() - INTERVAL '6 months';
```

#### 2. å¢åŠ æœåŠ¡å™¨

```bash
# ä½¿ç”¨è´Ÿè½½å‡è¡¡ (Nginx)
upstream customer_api {
    server 192.168.1.10:8000;
    server 192.168.1.11:8000;
    server 192.168.1.12:8000;
}
```

#### 3. ä½¿ç”¨Redisç¼“å­˜

```bash
# å®‰è£…Redis
sudo apt install redis-server -y

# å¯åŠ¨Redis
sudo systemctl start redis
sudo systemctl enable redis

# åœ¨ä»£ç ä¸­ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
```

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. APIæ— æ³•è®¿é—®

**ç—‡çŠ¶**: å‰ç«¯æç¤ºAPIè¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status restaurant-customer-api

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tunlp | grep 8000

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥æ—¥å¿—
sudo journalctl -u restaurant-customer-api -n 50
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åç«¯æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -h localhost -U restaurant_user -d restaurant_db

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat /opt/restaurant-system/.env

# æ£€æŸ¥æ•°æ®åº“æƒé™
sudo -u postgres psql -c "\l"
```

#### 3. WebSocketè¿æ¥å¤±è´¥

**ç—‡çŠ¶**: è®¢å•çŠ¶æ€ä¸å®æ—¶æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥WebSocketç«¯å£
sudo netstat -tunlp | grep 8001

# æ£€æŸ¥Nginxé…ç½® (å¦‚æœä½¿ç”¨)
sudo nginx -t
sudo systemctl reload nginx

# æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
# ç¡®ä¿å‰ç«¯WebSocket URLæ­£ç¡®
```

#### 4. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**: äºŒç»´ç ç”Ÿæˆå¤±è´¥æˆ–å›¾ç‰‡æ— æ³•æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥S3é…ç½®
cat /opt/restaurant-system/.env | grep S3

# æµ‹è¯•S3è¿æ¥
aws s3 ls s3://your-bucket-name

# æ£€æŸ¥æƒé™
ls -la /opt/restaurant-system/assets/uploads/
```

#### 5. Netlifyéƒ¨ç½²å¤±è´¥

**ç—‡çŠ¶**: Netlifyæ˜¾ç¤ºæ„å»ºé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `netlify.toml` é…ç½®
2. ç¡®è®¤ `assets/` ç›®å½•å­˜åœ¨
3. æ£€æŸ¥æ„å»ºæ—¥å¿—
4. å°è¯•æ‰‹åŠ¨æ‹–æ‹½éƒ¨ç½²

#### 6. è·¨åŸŸé—®é¢˜

**ç—‡çŠ¶**: æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºCORSé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ£€æŸ¥APIä¸­çš„CORSé…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### 7. æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**: é¡µé¢åŠ è½½æ…¢ï¼ŒAPIå“åº”æ…¢

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. å¯ç”¨Nginx gzipå‹ç¼©
sudo nano /etc/nginx/nginx.conf
# æ·»åŠ :
gzip on;
gzip_types text/plain text/css application/json application/javascript;

# 2. ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
# 3. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
# 4. å¯ç”¨Redisç¼“å­˜
```

### ç´§æ€¥æ¢å¤

#### æ•°æ®åº“æ¢å¤

```bash
# ä»å¤‡ä»½æ¢å¤
gunzip /opt/restaurant-system/backups/restaurant_db_20240101_020000.sql.gz

psql -h localhost -U restaurant_user -d restaurant_db < \
  /opt/restaurant-system/backups/restaurant_db_20240101_020000.sql
```

#### æœåŠ¡å¿«é€Ÿé‡å¯

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
sudo systemctl restart restaurant-customer-api
sudo systemctl restart restaurant-staff-api
sudo systemctl restart restaurant-member-api
sudo systemctl restart restaurant-hq-api

# æˆ–ä½¿ç”¨è„šæœ¬
for service in restaurant-customer-api restaurant-staff-api restaurant-member-api restaurant-hq-api; do
    sudo systemctl restart $service
done
```

---

## æ€»ç»“

æœ¬éƒ¨ç½²æŒ‡å—æ¶µç›–äº†ä»é›¶å¼€å§‹åˆ°ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚æŒ‰ç…§æœ¬æŒ‡å—æ“ä½œï¼Œä½ åº”è¯¥èƒ½å¤ŸæˆåŠŸéƒ¨ç½²ä¸€ä¸ªç¨³å®šã€å¯æ‰©å±•çš„å•†ç”¨é¤é¥®ç‚¹é¤ç³»ç»Ÿã€‚

### å…³é”®æ£€æŸ¥æ¸…å•

- [ ] åç«¯æœåŠ¡å™¨é…ç½®å®Œæˆ (Python, PostgreSQL, Nginx)
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- [ ] æ‰€æœ‰APIæœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] SystemdæœåŠ¡é…ç½®å®Œæˆ
- [ ] é˜²ç«å¢™é…ç½®å®Œæˆ
- [ ] å‰ç«¯éƒ¨ç½²åˆ°Netlify
- [ ] APIä»£ç†é…ç½®æ­£ç¡®
- [ ] è‡ªå®šä¹‰åŸŸåé…ç½®å®Œæˆ (å¯é€‰)
- [ ] æ•°æ®å¤‡ä»½è„šæœ¬é…ç½®å®Œæˆ
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®å®Œæˆ
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•å®Œæˆ
- [ ] å®‰å…¨æµ‹è¯•å®Œæˆ

### ä¸‹ä¸€æ­¥

1. é…ç½®æ”¯ä»˜æ¥å£ (å¾®ä¿¡æ”¯ä»˜/æ”¯ä»˜å®)
2. é…ç½®çŸ­ä¿¡é€šçŸ¥æœåŠ¡
3. é…ç½®é‚®ä»¶é€šçŸ¥æœåŠ¡
4. å®Œå–„ç”¨æˆ·æ–‡æ¡£
5. åŸ¹è®­å‘˜å·¥ä½¿ç”¨ç³»ç»Ÿ
6. åˆ¶å®šè¿ç»´æ‰‹å†Œ

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤ç« èŠ‚æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚**
